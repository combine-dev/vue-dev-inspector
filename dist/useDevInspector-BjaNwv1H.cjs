"use strict";const l=require("vue"),Le=require("pinia");var J=typeof document<"u"?document.currentScript:null;const Re={},ke="devInspector:elementConfigs",te=Le.defineStore("devInspector",()=>{const N=l.ref({}),T=l.ref(!1),E=l.ref(!1),P=l.ref(!1),F=l.ref(!1),R=l.ref(null),$=l.ref(!1),r=l.ref({}),C=l.ref(null),z=l.ref(null),H=l.computed(()=>N.value.storageKey||ke),g=l.ref(null),ne=l.ref("all"),I=l.ref(new Set),B="devInspector:hiddenAnalysisSelectors",k=l.computed(()=>N.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:J&&J.tagName.toUpperCase()==="SCRIPT"&&J.src||new URL("useDevInspector-BjaNwv1H.cjs",document.baseURI).href}<"u"&&Re?!1:process.env.NODE_ENV==="development"),W=l.ref(!1);function oe(e={}){N.value=e,le(),Te(),e.analysisData&&(g.value=e.analysisData);const n=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&k.value&&X(n)}async function X(e){var n;try{const t=await fetch(e);if(t.ok)return g.value=await t.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=g.value)==null?void 0:n.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function ae(e){if(!g.value)return null;for(const n of Object.values(g.value.components)){const t=n.elements.find(o=>o.selector===e);if(t)return t}return null}function se(e){if(!g.value)return[];const n=[];for(const[t,o]of Object.entries(g.value.components))(!e||t.includes(e))&&n.push(...o.elements);return n}function le(){try{const e=N.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(H.value),t=n?JSON.parse(n):{};r.value={...e,...t}}else r.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function _(){try{if(typeof window<"u"){const e=JSON.stringify(r.value);localStorage.setItem(H.value,e),console.log("[DevInspector] Saved configs:",Object.keys(r.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}l.watch(r,()=>{l.nextTick(()=>{_()})},{deep:!0});async function re(){k.value&&(T.value?(T.value=!1,E.value=!1,C.value=null):await M())}async function M(){if(!k.value)return;if(g.value&&!W.value&&N.value.autoApplyAnalysis!==!1){F.value=!0,T.value=!0;try{await new Promise(n=>setTimeout(n,300)),Q(),W.value=!0}finally{F.value=!1}}else T.value=!0}function ce(){T.value=!1,E.value=!1,C.value=null}function ie(){E.value=!E.value,E.value||(C.value=null),E.value&&(P.value=!1)}function ue(){P.value=!P.value,P.value&&(E.value=!1),z.value=null}function fe(e){z.value=e}function D(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const a=Array.from(t.classList).filter(c=>!c.startsWith("hover:")&&!c.startsWith("focus:")).slice(0,2);a.length>0&&(o+="."+a.join("."));const s=t.parentElement;if(s){const c=Array.from(s.children).filter(f=>f.tagName===t.tagName);if(c.length>1){const f=c.indexOf(t)+1;o+=`:nth-child(${f})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function de(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(r.value).filter(n=>{const t=r.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function pe(e){R.value=e}function ve(){R.value=null}function he(){$.value=!$.value}function ge(){$.value=!0}function me(){$.value=!1}function ye(e){return r.value[e]}function Z(e,n){var s;const t=new Date().toISOString(),o=r.value[e],a={...o,...n,id:e,componentPath:n.componentPath||((s=R.value)==null?void 0:s.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};r.value={...r.value,[e]:a},l.nextTick(()=>_())}function Se(e){const{[e]:n,...t}=r.value;r.value=t,l.nextTick(()=>_())}function K(e){var j;const n=((j=e.textContent)==null?void 0:j.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const d=o.props||{},v=o.attrs||{};if("modelValue"in d||"model-value"in v)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const d=e.type||"text",v=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${d}]${v?` placeholder="${v}"`:""}`,isStatic:!1}}const a=e.dataset.source||e.dataset.field||e.dataset.bind;if(a)return{type:"prop",source:a,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const s=e.closest('ul, ol, [role="list"]');if(s&&s.children.length>1)return{type:"api",source:"list item",isStatic:!1};const c=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const d of c){const v=e.closest(d);if(v){const m=v.parentElement;if(m&&Array.from(m.children).filter(b=>b!==v&&b.className===v.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const d=e.parentElement,m=Array.from(d.children).filter(S=>S.tagName===e.tagName);if(m.length>=2&&m.filter(b=>b.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const h=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const d of h)if(d.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const u=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const d of u)if(d.test(n))return{type:"api",source:"name pattern",isStatic:!1};const p=["LABEL","TH","LEGEND","FIGCAPTION"].includes(t),y=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(d=>d.test(n)),L=t==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return p||y||L&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function G(e,n){var a,s,c,f,h;const t=K(e),o={};if(t){o.sourceBinding=t;const u=((a=e.textContent)==null?void 0:a.trim())||"";if(t.isStatic)o.note={type:"info",text:`【固定文言】${u}`};else if(t.type==="v-model"){const i=e.tagName.toUpperCase();if(i==="INPUT"||i==="SELECT"||i==="TEXTAREA"){const p=e.placeholder||"",w=((c=(s=e.closest("label"))==null?void 0:s.textContent)==null?void 0:c.trim())||e.getAttribute("aria-label")||((h=(f=document.querySelector(`label[for="${e.id}"]`))==null?void 0:f.textContent)==null?void 0:h.trim())||"";o.note={type:"todo",text:`【フォーム要素】${w||p||i.toLowerCase()}`}}}else t.type==="api"&&(o.note={type:"question",text:`【動的データ】${u.substring(0,100)}${u.length>100?"...":""}`})}return o}const x=l.ref(!1),O=l.ref(0),U=l.ref([]);async function V(e={}){x.value=!0,O.value=0,U.value=[];const{rescan:n=!1}=e;if(n){const t=typeof window<"u"?window.location.pathname:"/",o=Object.keys(r.value).filter(a=>{const s=r.value[a];return!s.componentPath||s.componentPath.includes(t)});for(const a of o)delete r.value[a];l.nextTick(()=>_())}try{const t=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),o=document.querySelectorAll(t),a=[];o.forEach(u=>{var v;const i=u;if(i.closest("[data-dev-inspector]"))return;const p=window.getComputedStyle(i);if(p.display==="none"||p.visibility==="hidden"||p.opacity==="0")return;const w=D(i);if(r.value[w])return;const y=i.tagName.toUpperCase(),L=((v=i.textContent)==null?void 0:v.trim())||"";if(y==="INPUT"||y==="SELECT"||y==="TEXTAREA"){a.push(i);return}if(L.length>300||L.length===0||y==="DIV"&&(Array.from(i.childNodes).filter(S=>S.nodeType===Node.TEXT_NODE).map(S=>{var b;return((b=S.textContent)==null?void 0:b.trim())||""}).join("").trim().length===0||i.children.length>3))return;const j=Array.from(i.childNodes).some(m=>{var S;return m.nodeType===Node.TEXT_NODE&&(((S=m.textContent)==null?void 0:S.trim())||"").length>0}),d=!Array.from(i.children).some(m=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(m.tagName));(j||i.children.length===0&&L.length>0||d)&&a.push(i)});const s=a.length;let c=0,f=0;const h=20;for(let u=0;u<a.length;u+=h){const i=a.slice(u,u+h);for(const p of i){const w=D(p),y=G(p,w);y.sourceBinding&&(U.value.push({selector:w,element:p,detected:y}),Z(w,y),f++),c++,O.value=Math.round(c/s*100)}await new Promise(p=>setTimeout(p,10))}return f}finally{x.value=!1,O.value=100}}const Y=l.ref([]),q=l.ref("");async function Ae(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];x.value=!0;const n=[];try{const o=e.getRoutes(),a=[];for(const s of o)s.path.includes(":")&&!s.path.includes("?")||s.redirect||s.path!=="/:pathMatch(.*)*"&&((t=s.meta)!=null&&t.devInspectorSkip||a.push(s.path));Y.value=a;for(const s of a){q.value=s;try{await e.push(s),await new Promise(f=>setTimeout(f,500));const c=await V();n.push({page:s,count:c})}catch(c){console.warn(`[DevInspector] Failed to scan page ${s}:`,c),n.push({page:s,count:0})}}return n}finally{x.value=!1,q.value=""}}function Ee(){U.value=[],O.value=0}const A=l.ref([]);async function Q(){var t;if(!g.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;A.value=[];const e=typeof window<"u"?window.location.pathname:"/",n=[];for(const[o,a]of Object.entries(g.value.components)){const s=o.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");e==="/"&&o.includes("index")?n.push(...a.elements):o.includes("pages/")&&e.match(new RegExp(`^${s}$`))?n.push(...a.elements):o.includes("components/")&&n.push(...a.elements)}for(const o of n){if(I.value.has(o.selector))continue;let a=!1,s=o.selector;try{document.querySelector(o.selector)&&(a=!0)}catch{}if(!a&&o.type==="static"&&o.text){const c=o.text.replace(/\[コメント\]\s*/,""),f=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;f.nextNode();){const h=f.currentNode;if((t=h.textContent)!=null&&t.includes(c)){const u=h.parentElement;if(u){a=!0,s=D(u);break}}}}if(!a&&o.selector.includes(".")){const c=o.selector.match(/^(\w+)\.(.+)$/);if(c){const[,f,h]=c,u=document.querySelectorAll(`${f}.${h.split(".")[0]}`);u.length>0&&(a=!0,s=D(u[0]))}}A.value.push({selector:s,element:o,matched:a})}return console.log(`[DevInspector] Applied analysis: ${A.value.filter(o=>o.matched).length}/${A.value.length} elements matched`),A.value.filter(o=>o.matched).length}function we(){A.value=[]}function be(e){A.value=A.value.filter(n=>n.selector!==e),I.value.add(e),Ce()}function Te(){try{const e=localStorage.getItem(B);e&&(I.value=new Set(JSON.parse(e)))}catch{}}function Ce(){try{localStorage.setItem(B,JSON.stringify([...I.value]))}catch{}}function Ie(){I.value.clear(),localStorage.removeItem(B)}function Ne(e){C.value=e}function Pe(){C.value=null}function $e(){return JSON.stringify(r.value,null,2)}function ee(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:r.value};return JSON.stringify(e,null,2)}function De(e="dev-annotations.json"){const n=ee(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function xe(e){try{const n=JSON.parse(e),t=n.annotations||n;r.value={...r.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function Oe(){r.value={}}return{isEnabled:T,isAvailable:k,isEditMode:E,isPickMode:P,isInitializing:F,hoveredSelector:z,currentScreenSpec:R,isPanelOpen:$,elementConfigs:r,editingElementId:C,init:oe,toggle:re,enable:M,disable:ce,toggleEditMode:ie,togglePickMode:ue,setHoveredSelector:fe,generateSelector:D,getConfiguredSelectors:de,setScreenSpec:pe,clearScreenSpec:ve,togglePanel:he,openPanel:ge,closePanel:me,getElementConfig:ye,setElementConfig:Z,deleteElementConfig:Se,startEditing:Ne,stopEditing:Pe,exportConfigs:$e,exportAsFile:ee,downloadAnnotations:De,importConfigs:xe,clearAllConfigs:Oe,detectSourceBinding:K,autoDetectElementInfo:G,isScanning:x,scanProgress:O,scanResults:U,scanCurrentPage:V,scanAllPages:Ae,allPagesRoutes:Y,currentScanPage:q,clearScanResults:Ee,analysisData:g,loadAnalysisData:X,getAnalyzedElement:ae,getAnalyzedElementsForPage:se,analysisResults:A,applyAnalysisToPage:Q,clearAnalysisResults:we,removeAnalysisResult:be,clearHiddenSelectors:Ie,hiddenAnalysisSelectors:I,analysisFilter:ne}});function _e(){return te()}exports.useDevInspector=_e;exports.useDevInspectorStore=te;
