"use strict";const l=require("vue"),Zt=require("pinia");var me=typeof document<"u"?document.currentScript:null;const Yt={},Vt="devInspector:elementConfigs",Le="devInspector:screenConfigs",De="devInspector:masterDefinitions",ke=Zt.defineStore("devInspector",()=>{const E=l.ref({}),U=l.ref(!1),O=l.ref(!1),F=l.ref(!1),ne=l.ref(!1),X=l.ref(null),M=l.ref(!1),p=l.ref({}),_=l.ref(null),oe=l.ref(null),b=l.ref({}),_e=l.ref(!1),A=l.ref({}),ge=l.computed(()=>E.value.storageKey||Vt),ae=l.computed(()=>E.value.storageKey||"shared"),S=l.ref(null),je=l.ref("all"),se=l.ref(!0),Re=l.ref("all"),Ue=l.ref(!1),ve=l.ref(""),he=l.ref("column"),Fe=l.ref(!1),Z=l.ref([]),Me=l.ref(!1),j=l.ref(new Set),ie="devInspector:hiddenAnalysisSelectors",K=l.computed(()=>E.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:me&&me.tagName.toUpperCase()==="SCRIPT"&&me.src||new URL("useDevInspector-C5NdkUAb.cjs",document.baseURI).href}<"u"&&Yt?!1:process.env.NODE_ENV==="development"),ye=l.ref(!1);function Be(e={}){E.value=e,He(),Xe(),Qe(),$t(),e.analysisData&&(S.value=e.analysisData);const n=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&K.value&&be(n),R()!=="none"&&K.value&&(Se().then(o=>{o&&console.log(`[DevInspector] ${R()} sync active`)}),it(),Ge())}async function be(e){var n;try{const t=await fetch(e);if(t.ok)return S.value=await t.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=S.value)==null?void 0:n.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function Je(e){if(!S.value)return null;for(const n of Object.values(S.value.components)){const t=n.elements.find(o=>o.selector===e);if(t)return t}return null}function qe(e){if(!S.value)return[];const n=[];for(const[t,o]of Object.entries(S.value.components))(!e||t.includes(e))&&n.push(...o.elements);return n}function He(){try{const e=E.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(ge.value),t=n?JSON.parse(n):{};p.value={...e,...t}}else p.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function x(){try{if(typeof window<"u"){const e=JSON.stringify(p.value);localStorage.setItem(ge.value,e),console.log("[DevInspector] Saved configs:",Object.keys(p.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}const D=l.ref(Math.random().toString(36).slice(2,10)),P=l.ref(!1);let B=null,J=null,Y=null,k="";function R(){var e;return(e=E.value.supabase)!=null&&e.url?"supabase":E.value.serverSync!==!1?"vite":"none"}function re(){const e=E.value.supabase;return{apikey:e.anonKey,Authorization:`Bearer ${e.anonKey}`,"Content-Type":"application/json",Prefer:"return=representation"}}function ce(){const e=E.value.supabase,n=e.table||"dev_inspector";return`${e.url}/rest/v1/${n}`}function V(){return typeof window<"u"?window.location.pathname:"/"}function Ke(e){const n={};for(const[t,o]of Object.entries(p.value))(o.pagePath===e||!o.pagePath&&e==="/")&&(n[t]=o);return n}function ze(e){return b.value[e]||null}async function Se(e){var o;const n=R();if(n==="none")return!1;const t=e||V();try{let s=null;if(n==="supabase"){const a=await fetch(`${ce()}?id=eq.${encodeURIComponent(ae.value)}&select=annotations,screen_configs,updated_at`,{headers:re()});if(!a.ok)return!1;const i=await a.json();i.length>0?s={annotations:i[0].annotations||{},screenConfig:((o=i[0].screen_configs)==null?void 0:o[t])||null}:s={annotations:{},screenConfig:null}}else{const a=await fetch(`/__dev-inspector/annotations?page=${encodeURIComponent(t)}`);if(!a.ok)return!1;s=await a.json()}if(s){const a=JSON.stringify(s);if(a===k)return!0;if(k=a,P.value=!0,n==="supabase")s.annotations&&(p.value={...s.annotations});else if(s.annotations){const i={...p.value};for(const r of Object.keys(i))i[r].pagePath===t&&delete i[r];p.value={...i,...s.annotations}}return s.screenConfig&&(b.value={...b.value,[t]:s.screenConfig}),l.nextTick(()=>{x(),q(),P.value=!1}),console.log("[DevInspector] Loaded from server:",Object.keys(s.annotations||{}).length,"annotations for",t),!0}}catch{}return!1}function le(){if(P.value)return;J&&clearTimeout(J);const e=R();e!=="none"&&(J=setTimeout(()=>{const n=V();if(e==="supabase"){const t=p.value,o=b.value,s=JSON.stringify({annotations:t,screenConfigs:o});if(s===k)return;k=s;const a={id:ae.value,annotations:t,screen_configs:o,updated_at:new Date().toISOString(),updated_by:D.value};fetch(ce(),{method:"POST",headers:{...re(),Prefer:"resolution=merge-duplicates"},body:JSON.stringify(a)}).catch(()=>{})}else{const t=Ke(n),o=ze(n),s=JSON.stringify({annotations:t,screenConfig:o});if(s===k)return;k=s;const a={clientId:D.value,page:n,annotations:t,screenConfig:o,_meta:{lastUpdated:new Date().toISOString(),updatedBy:D.value}};fetch("/__dev-inspector/annotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(()=>{})}},500))}function Ge(){var n;if(typeof window>"u")return;const e=R();if(e!=="none")if(e==="supabase"){const t=((n=E.value.supabase)==null?void 0:n.pollInterval)||3e3;Y=setInterval(async()=>{try{const o=await fetch(`${ce()}?id=eq.${encodeURIComponent(ae.value)}&select=annotations,screen_configs,updated_by`,{headers:re()});if(!o.ok)return;const s=await o.json();if(s.length===0)return;const a=s[0];if(a.updated_by===D.value)return;const i=JSON.stringify({annotations:a.annotations,screenConfigs:a.screen_configs});if(i===k)return;k=i,P.value=!0,a.annotations&&(p.value={...a.annotations}),a.screen_configs&&(b.value={...a.screen_configs}),l.nextTick(()=>{x(),q(),P.value=!1}),console.log("[DevInspector] Synced from Supabase")}catch{}},t),console.log(`[DevInspector] Supabase polling started (${t}ms)`)}else{if(typeof EventSource>"u")return;B=new EventSource("/__dev-inspector/events"),B.onmessage=t=>{try{const o=JSON.parse(t.data);if(o.type==="connected"){console.log("[DevInspector] SSE connected");return}if(o.type==="update"&&o.clientId!==D.value){const s=V();if(o.page&&o.page!==s)return;if(P.value=!0,o.annotations){const a={...p.value};for(const i of Object.keys(a))a[i].pagePath===s&&delete a[i];p.value={...a,...o.annotations}}o.screenConfig&&(b.value={...b.value,[s]:o.screenConfig}),l.nextTick(()=>{x(),q(),P.value=!1}),console.log("[DevInspector] Synced from another client (page:",s+")")}o.type==="masters"&&o.clientId!==D.value&&(P.value=!0,o.masters&&(A.value={...o.masters}),l.nextTick(()=>{z(),P.value=!1}),console.log("[DevInspector] Masters synced from another client"))}catch{}},B.onerror=()=>{}}}function We(){B&&(B.close(),B=null),Y&&(clearInterval(Y),Y=null),J&&(clearTimeout(J),J=null)}l.watch(p,()=>{l.nextTick(()=>{x(),le()})},{deep:!0});function Xe(){try{if(typeof window<"u"){const e=localStorage.getItem(Le);e&&(b.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load screen configs:",e)}}function q(){try{if(typeof window<"u"){const e=JSON.stringify(b.value);localStorage.setItem(Le,e)}}catch(e){console.error("[DevInspector] Failed to save screen configs:",e)}}l.watch(b,()=>{l.nextTick(()=>{q(),le()})},{deep:!0});function Ze(e){const n=e||(typeof window<"u"?window.location.pathname:"/");return b.value[n]}function Ye(e){b.value={...b.value,[e.path]:e},l.nextTick(()=>q())}function Ve(e){const{[e]:n,...t}=b.value;b.value=t,l.nextTick(()=>q())}function Qe(){try{if(typeof window<"u"){const e=localStorage.getItem(De);e&&(A.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load master definitions:",e)}}function z(){try{typeof window<"u"&&localStorage.setItem(De,JSON.stringify(A.value))}catch(e){console.error("[DevInspector] Failed to save master definitions:",e)}}l.watch(A,()=>{l.nextTick(()=>{z(),st()})},{deep:!0});function et(e){return A.value[e]}function tt(e){A.value={...A.value,[e.id]:{...e,updatedAt:new Date().toISOString()}},l.nextTick(()=>z())}function nt(e){const{[e]:n,...t}=A.value;A.value=t,l.nextTick(()=>z())}function ot(e){return Object.values(A.value).filter(n=>n.table===e)}function at(e){var n;return((n=A.value[e])==null?void 0:n.entries)||[]}function st(){if(P.value)return;const e=R();e!=="none"&&e==="vite"&&fetch("/__dev-inspector/masters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:D.value,masters:A.value})}).catch(()=>{})}async function it(){if(R()!=="vite")return!1;try{const n=await fetch("/__dev-inspector/masters");if(!n.ok)return!1;const t=await n.json();return t.masters&&(A.value={...t.masters},l.nextTick(()=>z())),!0}catch{return!1}}function rt(){var o,s,a,i,r;const e=[],n=new Set,t={};for(const c of Object.values(p.value)){const d=c.fieldInfoList||(c.fieldInfo?[c.fieldInfo]:[]),u=((o=c.sourceBinding)==null?void 0:o.type)==="v-model";for(const f of d)f.table&&(t[f.table]||(t[f.table]={read:!1,write:!1,isList:!1}),t[f.table].read=!0,u&&(t[f.table].write=!0));if(((s=c.note)==null?void 0:s.displayType)==="db_direct"||((a=c.note)==null?void 0:a.displayType)==="db_formatted")for(const f of d)f.table&&t[f.table]&&(c.id.includes("tbody")||c.id.includes(" tr")||c.id.includes(" td"))&&(t[f.table].isList=!0);if(((i=c.actionInfo)==null?void 0:i.type)==="api"&&c.actionInfo.target){const f=`${c.actionInfo.method||"GET"}:${c.actionInfo.target}`;n.has(f)||(n.add(f),e.push({method:c.actionInfo.method||"GET",endpoint:c.actionInfo.target,description:c.actionInfo.description||"",loadTiming:"action"}))}}for(const[c,d]of Object.entries(t)){if(d.read){const u=d.isList?`/api/${c}`:`/api/${c}/:id`,f=`GET:${u}`;n.has(f)||(n.add(f),e.push({method:"GET",endpoint:u,description:d.isList?`${c} 一覧取得`:`${c} 詳細取得`,loadTiming:"onMount"}))}if(d.write){const u=`/api/${c}/:id`,f=`PUT:${u}`;n.has(f)||(n.add(f),e.push({method:"PUT",endpoint:u,description:`${c} 更新`,loadTiming:"action"}))}}if((r=S.value)!=null&&r.components){const c=typeof window<"u"?window.location.pathname:"/";for(const[d,u]of Object.entries(S.value.components)){const f=d.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let v=!1;if(c==="/"&&d.includes("index"))v=!0;else if(d.includes("pages/"))try{v=!!c.match(new RegExp(`^${f}$`))}catch{}if(v&&u.apis)for(const g of u.apis){if(!g.endpoint)continue;const I=`${g.method}:${g.endpoint}`;n.has(I)||(n.add(I),e.push({method:g.method,endpoint:g.endpoint,description:g.variable?`→ ${g.variable}`:"",loadTiming:["onMount","useFetch","useAsyncData"].includes(g.loadTrigger)?"onMount":"action"}))}}}return e}const ct=l.computed(()=>{var o,s,a,i,r,c,d,u,f,v,g,I,C,h,y;const e=ve.value.trim().toLowerCase();if(!e)return[];const n=he.value,t=[];for(const[w,m]of Object.entries(p.value)){const T=m.pagePath||"/",de=b.value[T],ee=(de==null?void 0:de.name)||T;if(n==="column"){const pe=(o=m.fieldInfoList)!=null&&o.length?m.fieldInfoList:m.fieldInfo?[m.fieldInfo]:[];for(const N of pe)(`${N.table}.${N.column}`.toLowerCase().includes(e)||N.table.toLowerCase().includes(e)||N.column.toLowerCase().includes(e))&&t.push({pagePath:T,pageName:ee,selector:w,elementType:m.elementType,matchedField:`${N.table}.${N.column}`,matchContext:`${N.type||""} ${N.description||""}`.trim()});const te=((s=m.note)==null?void 0:s.calcSources)||[],Xt=((a=m.note)==null?void 0:a.storedCalcSources)||[];for(const N of[...te,...Xt])N.toLowerCase().includes(e)&&t.push({pagePath:T,pageName:ee,selector:w,elementType:m.elementType,matchedField:N,matchContext:((i=m.note)==null?void 0:i.calcDescription)||((r=m.note)==null?void 0:r.storedCalcLogic)||"参照元"})}else if(n==="api")(d=(c=m.actionInfo)==null?void 0:c.target)!=null&&d.toLowerCase().includes(e)&&t.push({pagePath:T,pageName:ee,selector:w,elementType:m.elementType,matchedField:`${m.actionInfo.method||""} ${m.actionInfo.target}`.trim(),matchContext:m.actionInfo.description||m.actionInfo.type});else if(n==="text"){const pe=[(u=m.note)==null?void 0:u.text,(f=m.note)==null?void 0:f.calcDescription,(v=m.note)==null?void 0:v.formatDescription,(g=m.note)==null?void 0:g.condition,(I=m.actionInfo)==null?void 0:I.description,(C=m.formInfo)==null?void 0:C.description,w].filter(Boolean);for(const te of pe)if(te.toLowerCase().includes(e)){t.push({pagePath:T,pageName:ee,selector:w,elementType:m.elementType,matchedField:te.substring(0,60),matchContext:((y=(h=m.note)==null?void 0:h.text)==null?void 0:y.substring(0,40))||""});break}}}if(n==="api")for(const[w,m]of Object.entries(b.value))for(const T of m.apis||[])T.endpoint.toLowerCase().includes(e)&&t.push({pagePath:w,pageName:m.name||w,selector:"",elementType:void 0,matchedField:`${T.method} ${T.endpoint}`,matchContext:T.description||"画面API"});return t});function lt(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",n=new Set;for(const[s,a]of Object.entries(p.value))(!a.pagePath||a.pagePath===e)&&n.add(s);const t=[],o=new Set;return document.querySelectorAll("[data-di-binding]").forEach(s=>{var r;const a=s;if(a.closest("[data-dev-inspector]"))return;const i=L(a);n.has(i)||o.has(i)||(o.add(i),t.push({selector:i,tagName:a.tagName.toLowerCase(),category:"binding",text:(((r=a.textContent)==null?void 0:r.trim())||"").substring(0,50),suggestedType:"datasource"}))}),document.querySelectorAll("input, select, textarea").forEach(s=>{var d,u;const a=s;if(a.closest("[data-dev-inspector]")||a.type==="hidden")return;const i=window.getComputedStyle(a);if(i.display==="none"||i.visibility==="hidden")return;const r=L(a);if(n.has(r)||o.has(r))return;o.add(r);const c=((u=(d=a.closest("label"))==null?void 0:d.textContent)==null?void 0:u.trim())||a.getAttribute("aria-label")||a.placeholder||a.name||a.tagName.toLowerCase();t.push({selector:r,tagName:a.tagName.toLowerCase(),category:"form",text:(c||"").substring(0,50),suggestedType:"form"})}),document.querySelectorAll('button, a[href], [role="button"]').forEach(s=>{var d;const a=s;if(a.closest("[data-dev-inspector]"))return;const i=((d=a.textContent)==null?void 0:d.trim())||"";if(!i)return;const r=window.getComputedStyle(a);if(r.display==="none"||r.visibility==="hidden")return;const c=L(a);n.has(c)||o.has(c)||(o.add(c),t.push({selector:c,tagName:a.tagName.toLowerCase(),category:"action",text:i.substring(0,50),suggestedType:"action"}))}),Z.value=t,t}function ut(e,n){const t={elementType:n,pagePath:V(),note:{text:"",type:"todo"}};n==="action"?t.actionInfo={type:"function",description:""}:n==="form"&&(t.formInfo={inputType:"text"}),ue(e,t),_.value=e,Z.value=Z.value.filter(o=>o.selector!==e)}const ft=l.computed(()=>{var i,r,c,d;const e=new Map,n=[],t=new Set;for(const[u,f]of Object.entries(b.value))e.set(u,{path:u,name:f.name||u,annotationCount:Object.values(p.value).filter(v=>v.pagePath===u).length});for(const[u,f]of Object.entries(p.value))if(((i=f.actionInfo)==null?void 0:i.type)==="navigate"&&f.actionInfo.target){const v=f.pagePath||"/",g=f.actionInfo.target,I=`${v}→${g}`;if(!e.has(v)){const C=b.value[v];e.set(v,{path:v,name:(C==null?void 0:C.name)||v,annotationCount:Object.values(p.value).filter(h=>h.pagePath===v).length})}if(!e.has(g)){const C=b.value[g];e.set(g,{path:g,name:(C==null?void 0:C.name)||g,annotationCount:Object.values(p.value).filter(h=>h.pagePath===g).length})}if(!t.has(I)){t.add(I);let C=f.actionInfo.description||((r=f.note)==null?void 0:r.text)||"";if(!C&&typeof document<"u")try{const h=document.querySelector(u);h&&(C=((d=(c=h.textContent)==null?void 0:c.trim())==null?void 0:d.substring(0,20))||"")}catch{}n.push({from:v,to:g,label:C,selector:u})}}const o=Array.from(e.values()),s=new Set;for(const u of n)s.add(u.from),s.add(u.to);const a=o.filter(u=>!s.has(u.path));return{nodes:o,edges:n,orphanPages:a}});async function dt(){K.value&&(U.value?(U.value=!1,O.value=!1,_.value=null):await we())}async function we(){if(!K.value)return;if(S.value&&!ye.value&&E.value.autoApplyAnalysis!==!1){ne.value=!0,U.value=!0;try{await new Promise(n=>setTimeout(n,300)),Ee(),ye.value=!0}finally{ne.value=!1}}else U.value=!0}function pt(){U.value=!1,O.value=!1,_.value=null}function mt(){O.value=!O.value,O.value||(_.value=null),O.value&&(F.value=!1)}function gt(){F.value=!F.value,F.value&&(O.value=!1),oe.value=null}function vt(e){oe.value=e}function L(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const s=Array.from(t.classList).filter(i=>!i.startsWith("hover:")&&!i.startsWith("focus:")&&!/[/\[\]()!@#$%^&*=+{}|\\:'"<>,?]/.test(i)).slice(0,2);s.length>0&&(o+="."+s.join("."));const a=t.parentElement;if(a){const i=Array.from(a.children).filter(r=>r.tagName===t.tagName);if(i.length>1){const r=i.indexOf(t)+1;o+=`:nth-child(${r})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function ht(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(p.value).filter(n=>{const t=p.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function yt(e){X.value=e}function bt(){X.value=null}function St(){M.value=!M.value}function wt(){M.value=!0}function Ct(){M.value=!1}function Tt(e){return p.value[e]}function ue(e,n){var i;const t=new Date().toISOString(),o=p.value[e],s=typeof window<"u"?window.location.pathname:"/",a={...o,...n,id:e,pagePath:n.pagePath||(o==null?void 0:o.pagePath)||s,componentPath:n.componentPath||((i=X.value)==null?void 0:i.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};p.value={...p.value,[e]:a},l.nextTick(()=>x())}function It(e){const{[e]:n,...t}=p.value;p.value=t,l.nextTick(()=>x())}function Ce(e){var C;const n=((C=e.textContent)==null?void 0:C.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const h=o.props||{},y=o.attrs||{};if("modelValue"in h||"model-value"in y)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const h=e.type||"text",y=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${h}]${y?` placeholder="${y}"`:""}`,isStatic:!1}}const s=e.dataset.source||e.dataset.field||e.dataset.bind;if(s)return{type:"prop",source:s,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const a=e.closest('ul, ol, [role="list"]');if(a&&a.children.length>1)return{type:"api",source:"list item",isStatic:!1};const i=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const h of i){const y=e.closest(h);if(y){const w=y.parentElement;if(w&&Array.from(w.children).filter(T=>T!==y&&T.className===y.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const h=e.parentElement,w=Array.from(h.children).filter(m=>m.tagName===e.tagName);if(w.length>=2&&w.filter(T=>T.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const c=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const h of c)if(h.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const d=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const h of d)if(h.test(n))return{type:"api",source:"name pattern",isStatic:!1};const f=["LABEL","TH","LEGEND","FIGCAPTION"].includes(t),g=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(h=>h.test(n)),I=t==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return f||g||I&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function Te(e,n){var v,g,I,C,h;const t={},o=((v=e.textContent)==null?void 0:v.trim())||"",s=e.getAttribute("data-di-binding");e.getAttribute("data-di-db"),e.getAttribute("data-di-component"),e.getAttribute("data-di-db-comment");let a=e;if(!s){const y=e.closest("[data-di-binding]");y&&(a=y)}const i=a.getAttribute("data-di-binding"),r=a.getAttribute("data-di-db"),c=a.getAttribute("data-di-component"),d=a.getAttribute("data-di-db-type"),u=a.getAttribute("data-di-db-comment");if(i||r){if(t.sourceBinding={type:"api",source:i||void 0,isStatic:!1},r){const[y,w]=r.split(".");y&&w&&(t.fieldInfo={table:y,column:w,type:d||void 0,description:u||void 0})}return c&&(t.devMeta={usedComponents:[c]}),t.note={type:"info",text:`【データバインディング】${i}${r?` → ${r}`:""}`},t}const f=Ce(e);if(f)if(t.sourceBinding=f,f.isStatic)t.note={type:"info",text:`【固定文言】${o}`};else if(f.type==="v-model"){const y=e.tagName.toUpperCase();if(y==="INPUT"||y==="SELECT"||y==="TEXTAREA"){const w=e.placeholder||"",m=((I=(g=e.closest("label"))==null?void 0:g.textContent)==null?void 0:I.trim())||e.getAttribute("aria-label")||((h=(C=document.querySelector(`label[for="${e.id}"]`))==null?void 0:C.textContent)==null?void 0:h.trim())||"";t.note={type:"todo",text:`【フォーム要素】${m||w||y.toLowerCase()}`}}}else f.type==="api"&&(t.note={type:"question",text:`【動的データ】${o.substring(0,100)}${o.length>100?"...":""}`});return t}const G=l.ref(!1),W=l.ref(0),Q=l.ref([]);async function Ie(e={}){G.value=!0,W.value=0,Q.value=[];const{rescan:n=!1}=e;if(n){const t=typeof window<"u"?window.location.pathname:"/",o=Object.keys(p.value).filter(s=>{const a=p.value[s];return!a.componentPath||a.componentPath.includes(t)});for(const s of o)delete p.value[s];l.nextTick(()=>x())}try{const t=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),o=document.querySelectorAll(t),s=[];o.forEach(d=>{var y;const u=d;if(u.closest("[data-dev-inspector]"))return;const f=window.getComputedStyle(u);if(f.display==="none"||f.visibility==="hidden"||f.opacity==="0")return;const v=L(u);if(p.value[v])return;const g=u.tagName.toUpperCase(),I=((y=u.textContent)==null?void 0:y.trim())||"";if(g==="INPUT"||g==="SELECT"||g==="TEXTAREA"){s.push(u);return}if(I.length>300||I.length===0||g==="DIV"&&(Array.from(u.childNodes).filter(m=>m.nodeType===Node.TEXT_NODE).map(m=>{var T;return((T=m.textContent)==null?void 0:T.trim())||""}).join("").trim().length===0||u.children.length>3))return;const C=Array.from(u.childNodes).some(w=>{var m;return w.nodeType===Node.TEXT_NODE&&(((m=w.textContent)==null?void 0:m.trim())||"").length>0}),h=!Array.from(u.children).some(w=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(w.tagName));(C||u.children.length===0&&I.length>0||h)&&s.push(u)});const a=s.length;let i=0,r=0;const c=20;for(let d=0;d<s.length;d+=c){const u=s.slice(d,d+c);for(const f of u){const v=L(f),g=Te(f,v);g.sourceBinding&&(Q.value.push({selector:v,element:f,detected:g}),ue(v,g),r++),i++,W.value=Math.round(i/a*100)}await new Promise(f=>setTimeout(f,10))}return r}finally{G.value=!1,W.value=100}}const Ae=l.ref([]),fe=l.ref("");async function At(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];G.value=!0;const n=[];try{const o=e.getRoutes(),s=[];for(const a of o)a.path.includes(":")&&!a.path.includes("?")||a.redirect||a.path!=="/:pathMatch(.*)*"&&((t=a.meta)!=null&&t.devInspectorSkip||s.push(a.path));Ae.value=s;for(const a of s){fe.value=a;try{await e.push(a),await new Promise(r=>setTimeout(r,500));const i=await Ie();n.push({page:a,count:i})}catch(i){console.warn(`[DevInspector] Failed to scan page ${a}:`,i),n.push({page:a,count:0})}}return n}finally{G.value=!1,fe.value=""}}function Et(){Q.value=[],W.value=0}const $=l.ref([]);async function Ee(){var a;if(!S.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;$.value=[];const e=typeof window<"u"?window.location.pathname:"/",n=i=>{if(!S.value)return null;for(const[r,c]of Object.entries(S.value.components))if(c.componentName===i||c.componentName.toLowerCase()===i.toLowerCase()||r.toLowerCase().includes(`/${i.toLowerCase()}.vue`))return c;return null},t=(i,r=new Set)=>{const c=[];if(r.has(i.componentName))return c;if(r.add(i.componentName),c.push(...i.elements),i.usedComponents)for(const d of i.usedComponents){const u=n(d);u&&c.push(...t(u,r))}return c},o=[],s=new Set;for(const[i,r]of Object.entries(S.value.components)){const c=i.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let d=!1;if((e==="/"&&i.includes("index")||i.includes("pages/")&&e.match(new RegExp(`^${c}$`)))&&(d=!0),d){const u=t(r);o.push(...u),s.add(r.componentName),r.usedComponents&&r.usedComponents.forEach(f=>s.add(f))}}for(const[i,r]of Object.entries(S.value.components))i.includes("components/")&&!s.has(r.componentName)&&o.push(...r.elements);for(const i of o){if(j.value.has(i.selector))continue;let r=!1,c=i.selector;try{document.querySelector(i.selector)&&(r=!0)}catch{}if(!r&&i.text&&!i.binding){const d=i.text.replace(/\[コメント\]\s*/,""),u=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;u.nextNode();){const f=u.currentNode;if((a=f.textContent)!=null&&a.includes(d)){const v=f.parentElement;if(v){r=!0,c=L(v);break}}}}if(!r&&i.selector.includes(".")){const d=i.selector.match(/^(\w+)\.(.+)$/);if(d){const[,u,f]=d;try{const v=document.querySelector(i.selector);v&&(r=!0,c=L(v))}catch{}}}if(!r&&i.binding){const d=`[data-bind="${i.binding}"]`;try{const u=document.querySelector(d);u&&(r=!0,c=L(u))}catch{}}$.value.push({selector:c,element:i,matched:r})}return console.log(`[DevInspector] Applied analysis: ${$.value.filter(i=>i.matched).length}/${$.value.length} elements matched`),$.value.filter(i=>i.matched).length}function Nt(){$.value=[]}function Pt(e){$.value=$.value.filter(n=>n.selector!==e),j.value.add(e),Ot()}function $t(){try{const e=localStorage.getItem(ie);e&&(j.value=new Set(JSON.parse(e)))}catch{}}function Ot(){try{localStorage.setItem(ie,JSON.stringify([...j.value]))}catch{}}function xt(){j.value.clear(),localStorage.removeItem(ie)}function Ne(){const e={removed:[...j.value],exportedAt:new Date().toISOString()};return JSON.stringify(e,null,2)}function Lt(e="dev-inspector-changes.json"){const n=Ne(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Pe(){if(!S.value)return[];const e=[],n=new Set;for(const t of Object.values(S.value.components))for(const o of t.elements)o.binding&&!n.has(o.binding)&&(n.add(o.binding),e.push({binding:o.binding,db:o.db,api:o.api,component:t.componentName}));return e.sort((t,o)=>t.db&&!o.db?-1:!t.db&&o.db?1:t.binding.localeCompare(o.binding))}function Dt(e){const n=Pe();if(!e)return n;const t=e.toLowerCase();return n.filter(o=>{var s,a;return o.binding.toLowerCase().includes(t)||((s=o.db)==null?void 0:s.table.toLowerCase().includes(t))||((a=o.db)==null?void 0:a.column.toLowerCase().includes(t))||o.component.toLowerCase().includes(t)})}function $e(){var n,t;if(!((t=(n=S.value)==null?void 0:n.dbSchema)!=null&&t.tables))return[];const e=[];for(const[o,s]of Object.entries(S.value.dbSchema.tables))for(const[a,i]of Object.entries(s.columns))e.push({table:o,column:a,type:i.type,comment:i.comment,fullName:`${o}.${a}`});return e.sort((o,s)=>o.table!==s.table?o.table.localeCompare(s.table):o.column.localeCompare(s.column))}function kt(e){const n=$e();if(!e)return n;const t=e.toLowerCase();return n.filter(o=>{var s;return o.table.toLowerCase().includes(t)||o.column.toLowerCase().includes(t)||o.fullName.toLowerCase().includes(t)||((s=o.comment)==null?void 0:s.toLowerCase().includes(t))})}function _t(){var t,o;const e=[],n=[];if(!((t=S.value)!=null&&t.components))return{pageLoad:e,action:n};for(const s of $.value){if(!s.matched)continue;const a=s.element.component;if(a&&((o=S.value.components[a])!=null&&o.apis))for(const i of S.value.components[a].apis)["onMount","useFetch","useAsyncData"].includes(i.loadTrigger)?e.some(r=>r.endpoint===i.endpoint&&r.method===i.method)||e.push(i):i.loadTrigger==="action"&&(n.some(r=>r.endpoint===i.endpoint&&r.method===i.method)||n.push(i))}return{pageLoad:e,action:n}}function jt(e){var n;if(!((n=S.value)!=null&&n.components))return null;for(const t of Object.values(S.value.components))if(t.apis){for(const o of t.apis)if(o.variable&&e.startsWith(o.variable))return o}return null}function Rt(e){const n=e.tagName.toUpperCase();return n==="INPUT"||n==="SELECT"||n==="TEXTAREA"?"form":n==="BUTTON"||n==="A"&&e.hasAttribute("href")||e.getAttribute("role")==="button"||e.closest("button")||e.closest("a[href]")?"action":"datasource"}const H=l.ref([]),Oe=l.ref(null);function Ut(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",n=[];for(const[t,o]of Object.entries(p.value))if(!(o.componentPath&&!o.componentPath.includes(e)&&e!=="/"))try{document.querySelector(t)||n.push(t)}catch{n.push(t)}return H.value=n,n}function Ft(e,n){const t=p.value[e];if(!t)return;const{[e]:o,...s}=p.value;p.value={...s,[n]:{...t,id:n,updatedAt:new Date().toISOString()}},H.value=H.value.filter(a=>a!==e),l.nextTick(()=>x())}function Mt(e){Oe.value=e,F.value=!0,O.value=!1,M.value=!1}function Bt(){const e=H.value;if(e.length===0)return;const n={...p.value};for(const t of e)delete n[t];p.value=n,H.value=[],l.nextTick(()=>x())}function Jt(){se.value=!se.value}function qt(e){_.value=e}function Ht(){_.value=null}function Kt(){return JSON.stringify({elementConfigs:p.value,screenConfigs:b.value},null,2)}function xe(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:p.value,screenConfigs:b.value};return JSON.stringify(e,null,2)}function zt(e="dev-annotations.json"){const n=xe(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Gt(e){try{const n=JSON.parse(e),t=n.annotations||n.elementConfigs||n;p.value={...p.value,...t},n.screenConfigs&&(b.value={...b.value,...n.screenConfigs})}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function Wt(){p.value={}}return{isEnabled:U,isAvailable:K,isEditMode:O,isPickMode:F,isInitializing:ne,hoveredSelector:oe,currentScreenSpec:X,isPanelOpen:M,elementConfigs:p,editingElementId:_,screenConfigs:b,editingScreen:_e,getScreenConfig:Ze,setScreenConfig:Ye,deleteScreenConfig:Ve,suggestScreenApis:rt,init:Be,toggle:dt,enable:we,disable:pt,toggleEditMode:mt,togglePickMode:gt,setHoveredSelector:vt,generateSelector:L,getConfiguredSelectors:ht,setScreenSpec:yt,clearScreenSpec:bt,togglePanel:St,openPanel:wt,closePanel:Ct,getElementConfig:Tt,setElementConfig:ue,deleteElementConfig:It,startEditing:qt,stopEditing:Ht,exportConfigs:Kt,exportAsFile:xe,downloadAnnotations:zt,importConfigs:Gt,clearAllConfigs:Wt,detectSourceBinding:Ce,autoDetectElementInfo:Te,isScanning:G,scanProgress:W,scanResults:Q,scanCurrentPage:Ie,scanAllPages:At,allPagesRoutes:Ae,currentScanPage:fe,clearScanResults:Et,analysisData:S,loadAnalysisData:be,getAnalyzedElement:Je,getAnalyzedElementsForPage:qe,analysisResults:$,applyAnalysisToPage:Ee,clearAnalysisResults:Nt,removeAnalysisResult:Pt,clearHiddenSelectors:xt,hiddenAnalysisSelectors:j,analysisFilter:je,exportChangesForCli:Ne,downloadChanges:Lt,getAvailableBindings:Pe,searchBindings:Dt,getSchemaColumns:$e,searchSchemaColumns:kt,getCurrentPageApis:_t,getApiSourceForBinding:jt,showNoteHighlights:se,toggleNoteHighlights:Jt,noteHighlightFilter:Re,detectElementType:Rt,masterDefinitions:A,getMasterDefinition:et,setMasterDefinition:tt,deleteMasterDefinition:nt,getMastersForTable:ot,getMasterEntries:at,brokenAnnotations:H,remapTargetId:Oe,detectBrokenAnnotations:Ut,remapAnnotation:Ft,startRemap:Mt,deleteBrokenAnnotations:Bt,showCrossSearch:Ue,crossSearchQuery:ve,crossSearchMode:he,crossSearchResults:ct,showUnannotatedDetection:Fe,unannotatedElements:Z,detectUnannotatedElements:lt,quickAnnotate:ut,showScreenFlow:Me,screenFlowData:ft,syncClientId:D,loadFromServer:Se,saveToServer:le,teardownServerSync:We}});function Qt(){return ke()}exports.useDevInspector=Qt;exports.useDevInspectorStore=ke;
