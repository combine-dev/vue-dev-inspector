"use strict";const u=require("vue"),Oe=require("pinia");var J=typeof document<"u"?document.currentScript:null;const Re={},ke="devInspector:elementConfigs",te=Oe.defineStore("devInspector",()=>{const $=u.ref({}),N=u.ref(!1),A=u.ref(!1),P=u.ref(!1),F=u.ref(!1),R=u.ref(null),D=u.ref(!1),p=u.ref({}),T=u.ref(null),q=u.ref(null),H=u.computed(()=>$.value.storageKey||ke),h=u.ref(null),ne=u.ref("all"),I=u.ref(new Set),B="devInspector:hiddenAnalysisSelectors",k=u.computed(()=>$.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:J&&J.tagName.toUpperCase()==="SCRIPT"&&J.src||new URL("useDevInspector-5j-Qrqyu.cjs",document.baseURI).href}<"u"&&Re?!1:process.env.NODE_ENV==="development"),M=u.ref(!1);function oe(e={}){$.value=e,le(),we(),e.analysisData&&(h.value=e.analysisData);const n=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&k.value&&W(n)}async function W(e){var n;try{const t=await fetch(e);if(t.ok)return h.value=await t.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=h.value)==null?void 0:n.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function se(e){if(!h.value)return null;for(const n of Object.values(h.value.components)){const t=n.elements.find(s=>s.selector===e);if(t)return t}return null}function ae(e){if(!h.value)return[];const n=[];for(const[t,s]of Object.entries(h.value.components))(!e||t.includes(e))&&n.push(...s.elements);return n}function le(){try{const e=$.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(H.value),t=n?JSON.parse(n):{};p.value={...e,...t}}else p.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function _(){try{if(typeof window<"u"){const e=JSON.stringify(p.value);localStorage.setItem(H.value,e),console.log("[DevInspector] Saved configs:",Object.keys(p.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}u.watch(p,()=>{u.nextTick(()=>{_()})},{deep:!0});async function ce(){k.value&&(N.value?(N.value=!1,A.value=!1,T.value=null):await X())}async function X(){if(!k.value)return;if(h.value&&!M.value&&$.value.autoApplyAnalysis!==!1){F.value=!0,N.value=!0;try{await new Promise(n=>setTimeout(n,300)),Q(),M.value=!0}finally{F.value=!1}}else N.value=!0}function re(){N.value=!1,A.value=!1,T.value=null}function ie(){A.value=!A.value,A.value||(T.value=null),A.value&&(P.value=!1)}function ue(){P.value=!P.value,P.value&&(A.value=!1),q.value=null}function fe(e){q.value=e}function E(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let s=t.tagName.toLowerCase();if(t.id){s=`#${t.id}`,n.unshift(s);break}const l=Array.from(t.classList).filter(o=>!o.startsWith("hover:")&&!o.startsWith("focus:")).slice(0,2);l.length>0&&(s+="."+l.join("."));const r=t.parentElement;if(r){const o=Array.from(r.children).filter(a=>a.tagName===t.tagName);if(o.length>1){const a=o.indexOf(t)+1;s+=`:nth-child(${a})`}}n.unshift(s),t=t.parentElement}return n.join(" > ")}function de(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(p.value).filter(n=>{const t=p.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function pe(e){R.value=e}function me(){R.value=null}function ve(){D.value=!D.value}function he(){D.value=!0}function ge(){D.value=!1}function ye(e){return p.value[e]}function Z(e,n){var r;const t=new Date().toISOString(),s=p.value[e],l={...s,...n,id:e,componentPath:n.componentPath||((r=R.value)==null?void 0:r.componentPath)||"",createdAt:(s==null?void 0:s.createdAt)||t,updatedAt:t};p.value={...p.value,[e]:l},u.nextTick(()=>_())}function Se(e){const{[e]:n,...t}=p.value;p.value=t,u.nextTick(()=>_())}function K(e){var j;const n=((j=e.textContent)==null?void 0:j.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const s=e.__vueParentComponent;if(s){const v=s.props||{},y=s.attrs||{};if("modelValue"in v||"model-value"in y)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const v=e.type||"text",y=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${v}]${y?` placeholder="${y}"`:""}`,isStatic:!1}}const l=e.dataset.source||e.dataset.field||e.dataset.bind;if(l)return{type:"prop",source:l,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const r=e.closest('ul, ol, [role="list"]');if(r&&r.children.length>1)return{type:"api",source:"list item",isStatic:!1};const o=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const v of o){const y=e.closest(v);if(y){const S=y.parentElement;if(S&&Array.from(S.children).filter(w=>w!==y&&w.className===y.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const v=e.parentElement,S=Array.from(v.children).filter(b=>b.tagName===e.tagName);if(S.length>=2&&S.filter(w=>w.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const f=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const v of f)if(v.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const i=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const v of i)if(v.test(n))return{type:"api",source:"name pattern",isStatic:!1};const d=["LABEL","TH","LEGEND","FIGCAPTION"].includes(t),g=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(v=>v.test(n)),O=t==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return d||g||O&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function G(e,n){var l,r,o,a,f;const t=K(e),s={};if(t){s.sourceBinding=t;const i=((l=e.textContent)==null?void 0:l.trim())||"";if(t.isStatic)s.note={type:"info",text:`【固定文言】${i}`};else if(t.type==="v-model"){const c=e.tagName.toUpperCase();if(c==="INPUT"||c==="SELECT"||c==="TEXTAREA"){const d=e.placeholder||"",m=((o=(r=e.closest("label"))==null?void 0:r.textContent)==null?void 0:o.trim())||e.getAttribute("aria-label")||((f=(a=document.querySelector(`label[for="${e.id}"]`))==null?void 0:a.textContent)==null?void 0:f.trim())||"";s.note={type:"todo",text:`【フォーム要素】${m||d||c.toLowerCase()}`}}}else t.type==="api"&&(s.note={type:"question",text:`【動的データ】${i.substring(0,100)}${i.length>100?"...":""}`})}return s}const L=u.ref(!1),x=u.ref(0),U=u.ref([]);async function V(e={}){L.value=!0,x.value=0,U.value=[];const{rescan:n=!1}=e;if(n){const t=typeof window<"u"?window.location.pathname:"/",s=Object.keys(p.value).filter(l=>{const r=p.value[l];return!r.componentPath||r.componentPath.includes(t)});for(const l of s)delete p.value[l];u.nextTick(()=>_())}try{const t=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),s=document.querySelectorAll(t),l=[];s.forEach(i=>{var y;const c=i;if(c.closest("[data-dev-inspector]"))return;const d=window.getComputedStyle(c);if(d.display==="none"||d.visibility==="hidden"||d.opacity==="0")return;const m=E(c);if(p.value[m])return;const g=c.tagName.toUpperCase(),O=((y=c.textContent)==null?void 0:y.trim())||"";if(g==="INPUT"||g==="SELECT"||g==="TEXTAREA"){l.push(c);return}if(O.length>300||O.length===0||g==="DIV"&&(Array.from(c.childNodes).filter(b=>b.nodeType===Node.TEXT_NODE).map(b=>{var w;return((w=b.textContent)==null?void 0:w.trim())||""}).join("").trim().length===0||c.children.length>3))return;const j=Array.from(c.childNodes).some(S=>{var b;return S.nodeType===Node.TEXT_NODE&&(((b=S.textContent)==null?void 0:b.trim())||"").length>0}),v=!Array.from(c.children).some(S=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(S.tagName));(j||c.children.length===0&&O.length>0||v)&&l.push(c)});const r=l.length;let o=0,a=0;const f=20;for(let i=0;i<l.length;i+=f){const c=l.slice(i,i+f);for(const d of c){const m=E(d),g=G(d,m);g.sourceBinding&&(U.value.push({selector:m,element:d,detected:g}),Z(m,g),a++),o++,x.value=Math.round(o/r*100)}await new Promise(d=>setTimeout(d,10))}return a}finally{L.value=!1,x.value=100}}const Y=u.ref([]),z=u.ref("");async function be(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];L.value=!0;const n=[];try{const s=e.getRoutes(),l=[];for(const r of s)r.path.includes(":")&&!r.path.includes("?")||r.redirect||r.path!=="/:pathMatch(.*)*"&&((t=r.meta)!=null&&t.devInspectorSkip||l.push(r.path));Y.value=l;for(const r of l){z.value=r;try{await e.push(r),await new Promise(a=>setTimeout(a,500));const o=await V();n.push({page:r,count:o})}catch(o){console.warn(`[DevInspector] Failed to scan page ${r}:`,o),n.push({page:r,count:0})}}return n}finally{L.value=!1,z.value=""}}function Ce(){U.value=[],x.value=0}const C=u.ref([]);async function Q(){var r;if(!h.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;C.value=[];const e=typeof window<"u"?window.location.pathname:"/",n=o=>{if(!h.value)return null;for(const[a,f]of Object.entries(h.value.components))if(f.componentName===o||f.componentName.toLowerCase()===o.toLowerCase()||a.toLowerCase().includes(`/${o.toLowerCase()}.vue`))return f;return null},t=(o,a=new Set)=>{const f=[];if(a.has(o.componentName))return f;if(a.add(o.componentName),f.push(...o.elements),o.usedComponents)for(const i of o.usedComponents){const c=n(i);c&&f.push(...t(c,a))}return f},s=[],l=new Set;for(const[o,a]of Object.entries(h.value.components)){const f=o.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let i=!1;if((e==="/"&&o.includes("index")||o.includes("pages/")&&e.match(new RegExp(`^${f}$`)))&&(i=!0),i){const c=t(a);s.push(...c),l.add(a.componentName),a.usedComponents&&a.usedComponents.forEach(d=>l.add(d))}}for(const[o,a]of Object.entries(h.value.components))o.includes("components/")&&!l.has(a.componentName)&&s.push(...a.elements);for(const o of s){if(I.value.has(o.selector))continue;let a=!1,f=o.selector;try{document.querySelector(o.selector)&&(a=!0)}catch{}if(!a&&o.type==="static"&&o.text){const i=o.text.replace(/\[コメント\]\s*/,""),c=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;c.nextNode();){const d=c.currentNode;if((r=d.textContent)!=null&&r.includes(i)){const m=d.parentElement;if(m){a=!0,f=E(m);break}}}}if(!a&&o.selector.includes(".")){const i=o.selector.match(/^(\w+)\.(.+)$/);if(i){const[,c,d]=i,m=document.querySelectorAll(`${c}.${d.split(".")[0]}`);m.length>0&&(a=!0,f=E(m[0]))}}if(!a&&o.type==="data"&&o.binding){const i=o.binding.split("."),d=`[data-field="${i[i.length-1]}"], [data-bind="${o.binding}"]`;try{const m=document.querySelector(d);m&&(a=!0,f=E(m))}catch{}}if(!a&&o.db){const i=o.db.column,c=o.db.table,d=[`[class*="${i}"]`,`[class*="${c.replace(/s$/,"")}"]`,`[data-testid*="${i}"]`];for(const m of d)try{const g=document.querySelector(m);if(g){a=!0,f=E(g);break}}catch{}}C.value.push({selector:f,element:o,matched:a})}return console.log(`[DevInspector] Applied analysis: ${C.value.filter(o=>o.matched).length}/${C.value.length} elements matched`),C.value.filter(o=>o.matched).length}function Ae(){C.value=[]}function Ee(e){C.value=C.value.filter(n=>n.selector!==e),I.value.add(e),Ne()}function we(){try{const e=localStorage.getItem(B);e&&(I.value=new Set(JSON.parse(e)))}catch{}}function Ne(){try{localStorage.setItem(B,JSON.stringify([...I.value]))}catch{}}function Te(){I.value.clear(),localStorage.removeItem(B)}function Ie(e){T.value=e}function $e(){T.value=null}function Pe(){return JSON.stringify(p.value,null,2)}function ee(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:p.value};return JSON.stringify(e,null,2)}function De(e="dev-annotations.json"){const n=ee(),t=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}function Le(e){try{const n=JSON.parse(e),t=n.annotations||n;p.value={...p.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function xe(){p.value={}}return{isEnabled:N,isAvailable:k,isEditMode:A,isPickMode:P,isInitializing:F,hoveredSelector:q,currentScreenSpec:R,isPanelOpen:D,elementConfigs:p,editingElementId:T,init:oe,toggle:ce,enable:X,disable:re,toggleEditMode:ie,togglePickMode:ue,setHoveredSelector:fe,generateSelector:E,getConfiguredSelectors:de,setScreenSpec:pe,clearScreenSpec:me,togglePanel:ve,openPanel:he,closePanel:ge,getElementConfig:ye,setElementConfig:Z,deleteElementConfig:Se,startEditing:Ie,stopEditing:$e,exportConfigs:Pe,exportAsFile:ee,downloadAnnotations:De,importConfigs:Le,clearAllConfigs:xe,detectSourceBinding:K,autoDetectElementInfo:G,isScanning:L,scanProgress:x,scanResults:U,scanCurrentPage:V,scanAllPages:be,allPagesRoutes:Y,currentScanPage:z,clearScanResults:Ce,analysisData:h,loadAnalysisData:W,getAnalyzedElement:se,getAnalyzedElementsForPage:ae,analysisResults:C,applyAnalysisToPage:Q,clearAnalysisResults:Ae,removeAnalysisResult:Ee,clearHiddenSelectors:Te,hiddenAnalysisSelectors:I,analysisFilter:ne}});function _e(){return te()}exports.useDevInspector=_e;exports.useDevInspectorStore=te;
