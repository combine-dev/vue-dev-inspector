"use strict";const i=require("vue"),z=require("pinia");var I=typeof document<"u"?document.currentScript:null;const Q={},X="devInspector:elementConfigs",w=z.defineStore("devInspector",()=>{const g=i.ref({}),l=i.ref(!1),c=i.ref(!1),d=i.ref(!1),h=i.ref(null),v=i.ref(!1),a=i.ref({}),f=i.ref(null),m=i.ref(null),C=i.computed(()=>g.value.storageKey||X),S=i.computed(()=>g.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:I&&I.tagName.toUpperCase()==="SCRIPT"&&I.src||new URL("useDevInspector-BKie6h6Y.cjs",document.baseURI).href}<"u"&&Q?!1:process.env.NODE_ENV==="development");function E(e={}){g.value=e,O()}function O(){try{const e=g.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(C.value),t=n?JSON.parse(n):{};a.value={...e,...t}}else a.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function y(){try{if(typeof window<"u"){const e=JSON.stringify(a.value);localStorage.setItem(C.value,e),console.log("[DevInspector] Saved configs:",Object.keys(a.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}i.watch(a,()=>{i.nextTick(()=>{y()})},{deep:!0});function P(){S.value&&(l.value=!l.value,l.value||(c.value=!1,f.value=null))}function _(){S.value&&(l.value=!0)}function A(){l.value=!1,c.value=!1,f.value=null}function D(){c.value=!c.value,c.value||(f.value=null),c.value&&(d.value=!1)}function L(){d.value=!d.value,d.value&&(c.value=!1),m.value=null}function k(e){m.value=e}function U(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const r=Array.from(t.classList).filter(u=>!u.startsWith("hover:")&&!u.startsWith("focus:")).slice(0,2);r.length>0&&(o+="."+r.join("."));const s=t.parentElement;if(s){const u=Array.from(s.children).filter(p=>p.tagName===t.tagName);if(u.length>1){const p=u.indexOf(t)+1;o+=`:nth-child(${p})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function T(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(a.value).filter(n=>{const t=a.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function j(e){h.value=e}function x(){h.value=null}function R(){v.value=!v.value}function F(){v.value=!0}function J(){v.value=!1}function $(e){return a.value[e]}function B(e,n){var s;const t=new Date().toISOString(),o=a.value[e],r={...o,...n,id:e,componentPath:n.componentPath||((s=h.value)==null?void 0:s.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};a.value={...a.value,[e]:r},i.nextTick(()=>y())}function H(e){const{[e]:n,...t}=a.value;a.value=t,i.nextTick(()=>y())}function b(e){var s;const n=((s=e.textContent)==null?void 0:s.trim())||"",t=e.__vueParentComponent;if(t){const u=t.props||{},p=t.attrs||{};if("modelValue"in u||"model-value"in p)return{type:"v-model",source:"form binding detected",isStatic:!1}}const o=e.dataset.source||e.dataset.field||e.dataset.bind;return o?{type:"prop",source:o,isStatic:!1}:n.length>0&&n.length<100&&!n.includes("{{")&&!n.match(/^\d+$/)&&!n.match(/^\d{4}[-/]\d{2}[-/]\d{2}/)&&e.children.length===0&&!e.closest("[v-for]")&&!e.hasAttribute(":")&&(e.tagName==="SPAN"||e.tagName==="LABEL"||e.tagName==="P"||e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="TH"||e.tagName==="BUTTON")?{type:"static",isStatic:!0}:n.match(/^\d+$/)||n.match(/^\d{4}[-/]\d{2}[-/]\d{2}/)?{type:"api",isStatic:!1}:null}function W(e,n){const t=b(e),o={};return t&&(o.sourceBinding=t,t.isStatic&&(o.note={type:"info",text:"固定文言"})),o}function M(e){f.value=e}function q(){f.value=null}function K(){return JSON.stringify(a.value,null,2)}function N(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:a.value};return JSON.stringify(e,null,2)}function V(e="dev-annotations.json"){const n=N(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function G(e){try{const n=JSON.parse(e),t=n.annotations||n;a.value={...a.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function Y(){a.value={}}return{isEnabled:l,isAvailable:S,isEditMode:c,isPickMode:d,hoveredSelector:m,currentScreenSpec:h,isPanelOpen:v,elementConfigs:a,editingElementId:f,init:E,toggle:P,enable:_,disable:A,toggleEditMode:D,togglePickMode:L,setHoveredSelector:k,generateSelector:U,getConfiguredSelectors:T,setScreenSpec:j,clearScreenSpec:x,togglePanel:R,openPanel:F,closePanel:J,getElementConfig:$,setElementConfig:B,deleteElementConfig:H,startEditing:M,stopEditing:q,exportConfigs:K,exportAsFile:N,downloadAnnotations:V,importConfigs:G,clearAllConfigs:Y,detectSourceBinding:b,autoDetectElementInfo:W}});function Z(){return w()}exports.useDevInspector=Z;exports.useDevInspectorStore=w;
