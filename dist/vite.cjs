"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const P=require("fs"),x=require("path");function h(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const b=h(P),f=h(x);function w(e){const n=new Map;try{if(!b.existsSync(e))return console.warn(`[vue-dev-inspector] Analysis file not found: ${e}`),n;const t=JSON.parse(b.readFileSync(e,"utf-8"));for(const[,r]of Object.entries(t.components))for(const i of r.elements)if(i.binding&&i.db){const c=i.binding.replace(/^\./,"");n.has(c)||n.set(c,i.db)}console.log(`[vue-dev-inspector] Loaded ${n.size} binding->DB mappings from analysis`)}catch(t){console.warn("[vue-dev-inspector] Failed to load analysis file:",t)}return n}function M(e,n,t){let r=e;const i=/\{\{\s*([^{}]+?)\s*\}\}/g,c=[];let s;for(;(s=i.exec(e))!==null;){const a=s[0],u=s[1].trim();if(e.slice(Math.max(0,s.index-100),s.index).includes("data-di-binding")||u.includes("?")||u.includes("|")||/\([^)]*\)/.test(u))continue;const d=u.replace(/\?\.?/g,".").replace(/\s+/g,"").replace(/^\(|\)$/g,"");let l=`data-di-binding="${d}"`;l+=` data-di-component="${t}"`;let o=n.get(d);if(!o&&d.includes(".")){const p=d.split(".").pop();for(const[v,y]of n.entries())if(v.endsWith("."+p)||v===p){o=y;break}}o&&(l+=` data-di-db="${o.table}.${o.column}"`,o.type&&(l+=` data-di-db-type="${o.type}"`),o.comment&&(l+=` data-di-db-comment="${o.comment.replace(/"/g,"&quot;")}"`));const g=`<span ${l}>${a}</span>`;c.push({original:a,replacement:g})}for(const{original:a,replacement:u}of c.reverse())r=r.replace(a,u);return r}function _(e){return f.basename(e,".vue")}function $(e={}){const{enabled:n=process.env.NODE_ENV!=="production",analysisPath:t,exclude:r=["node_modules/**","**/node_modules/**"]}=e;let i=new Map;return{name:"vite-plugin-dev-inspector",enforce:"pre",configResolved(){if(!n){console.log("[vue-dev-inspector] Plugin disabled");return}if(console.log("[vue-dev-inspector] Plugin enabled"),t){const c=f.isAbsolute(t)?t:f.resolve(process.cwd(),t);i=w(c)}},transform(c,s){if(!n||!s.endsWith(".vue"))return null;console.log(`[vue-dev-inspector] transform called: ${s}`);const a=f.relative(process.cwd(),s);if(r.some(p=>p.includes("**")?a.includes(p.replace("**/","").replace("/**","")):a.startsWith(p)))return null;const m=c.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(!m)return console.log(`[vue-dev-inspector] No template found in: ${s}`),null;const d=m[1],l=_(s);console.log(`[vue-dev-inspector] Processing template for: ${l}`);const o=M(d,i,l);return o===d?(console.log(`[vue-dev-inspector] No changes for: ${l}`),null):(console.log(`[vue-dev-inspector] Transformed: ${l}`),{code:c.replace(/<template([^>]*)>([\s\S]*?)<\/template>/i,`<template$1>${o}</template>`),map:null})}}}exports.default=$;exports.vitePluginDevInspector=$;
