"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const y=require("fs"),P=require("path");function h(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,o.get?o:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const v=h(y),f=h(P);function w(e){const n=new Map;try{if(!v.existsSync(e))return console.warn(`[vue-dev-inspector] Analysis file not found: ${e}`),n;const t=JSON.parse(v.readFileSync(e,"utf-8"));for(const[,o]of Object.entries(t.components))for(const r of o.elements)if(r.binding&&r.db){const s=r.binding.replace(/^\./,"");n.has(s)||n.set(s,r.db)}console.log(`[vue-dev-inspector] Loaded ${n.size} binding->DB mappings from analysis`)}catch(t){console.warn("[vue-dev-inspector] Failed to load analysis file:",t)}return n}function M(e,n,t){let o=e;const r=/\{\{\s*([^{}]+?)\s*\}\}/g,s=[];let c;for(;(c=r.exec(e))!==null;){const l=c[0],a=c[1].trim();if(e.slice(Math.max(0,c.index-100),c.index).includes("data-di-binding")||a.includes("?")||a.includes("|")||/\([^)]*\)/.test(a))continue;const u=a.replace(/\?\.?/g,".").replace(/\s+/g,"").replace(/^\(|\)$/g,"");let d=`data-di-binding="${u}"`;d+=` data-di-component="${t}"`;let i=n.get(u);if(!i&&u.includes(".")){const p=u.split(".").pop();for(const[b,x]of n.entries())if(b.endsWith("."+p)||b===p){i=x;break}}i&&(d+=` data-di-db="${i.table}.${i.column}"`,i.comment&&(d+=` data-di-db-comment="${i.comment.replace(/"/g,"&quot;")}"`));const g=`<span ${d}>${l}</span>`;s.push({original:l,replacement:g})}for(const{original:l,replacement:a}of s.reverse())o=o.replace(l,a);return o}function _(e){return f.basename(e,".vue")}function $(e={}){const{enabled:n=process.env.NODE_ENV!=="production",analysisPath:t,exclude:o=["node_modules/**","**/node_modules/**"]}=e;let r=new Map;return{name:"vite-plugin-dev-inspector",configResolved(){if(!n){console.log("[vue-dev-inspector] Plugin disabled");return}if(console.log("[vue-dev-inspector] Plugin enabled"),t){const s=f.isAbsolute(t)?t:f.resolve(process.cwd(),t);r=w(s)}},transform(s,c){if(!n||!c.endsWith(".vue"))return null;const l=f.relative(process.cwd(),c);if(o.some(p=>p.includes("**")?l.includes(p.replace("**/","").replace("/**","")):l.startsWith(p)))return null;const m=s.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(!m)return null;const u=m[1],d=_(c),i=M(u,r,d);return i===u?null:{code:s.replace(/<template([^>]*)>([\s\S]*?)<\/template>/i,`<template$1>${i}</template>`),map:null}}}}exports.default=$;exports.vitePluginDevInspector=$;
