"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const x=require("fs"),y=require("path");function h(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,s.get?s:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const b=h(x),f=h(y);function w(e){const n=new Map;try{if(!b.existsSync(e))return console.warn(`[vue-dev-inspector] Analysis file not found: ${e}`),n;const t=JSON.parse(b.readFileSync(e,"utf-8"));for(const[,s]of Object.entries(t.components))for(const l of s.elements)if(l.binding&&l.db){const r=l.binding.replace(/^\./,"");n.has(r)||n.set(r,l.db)}console.log(`[vue-dev-inspector] Loaded ${n.size} binding->DB mappings from analysis`)}catch(t){console.warn("[vue-dev-inspector] Failed to load analysis file:",t)}return n}function M(e,n,t){let s=e;const l=/\{\{\s*([^{}]+?)\s*\}\}/g,r=[];let o;for(;(o=l.exec(e))!==null;){const a=o[0],u=o[1].trim();if(e.slice(Math.max(0,o.index-100),o.index).includes("data-di-binding")||u.includes("?")||u.includes("|")||/\([^)]*\)/.test(u))continue;const d=u.replace(/\?\.?/g,".").replace(/\s+/g,"").replace(/^\(|\)$/g,"");let i=`data-di-binding="${d}"`;i+=` data-di-component="${t}"`;let c=n.get(d);if(!c&&d.includes(".")){const p=d.split(".").pop();for(const[v,P]of n.entries())if(v.endsWith("."+p)||v===p){c=P;break}}c&&(i+=` data-di-db="${c.table}.${c.column}"`,c.comment&&(i+=` data-di-db-comment="${c.comment.replace(/"/g,"&quot;")}"`));const g=`<span ${i}>${a}</span>`;r.push({original:a,replacement:g})}for(const{original:a,replacement:u}of r.reverse())s=s.replace(a,u);return s}function _(e){return f.basename(e,".vue")}function $(e={}){const{enabled:n=process.env.NODE_ENV!=="production",analysisPath:t,exclude:s=["node_modules/**","**/node_modules/**"]}=e;let l=new Map;return{name:"vite-plugin-dev-inspector",enforce:"pre",configResolved(){if(!n){console.log("[vue-dev-inspector] Plugin disabled");return}if(console.log("[vue-dev-inspector] Plugin enabled"),t){const r=f.isAbsolute(t)?t:f.resolve(process.cwd(),t);l=w(r)}},transform(r,o){if(!n||!o.endsWith(".vue"))return null;console.log(`[vue-dev-inspector] transform called: ${o}`);const a=f.relative(process.cwd(),o);if(s.some(p=>p.includes("**")?a.includes(p.replace("**/","").replace("/**","")):a.startsWith(p)))return null;const m=r.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(!m)return console.log(`[vue-dev-inspector] No template found in: ${o}`),null;const d=m[1],i=_(o);console.log(`[vue-dev-inspector] Processing template for: ${i}`);const c=M(d,l,i);return c===d?(console.log(`[vue-dev-inspector] No changes for: ${i}`),null):(console.log(`[vue-dev-inspector] Transformed: ${i}`),{code:r.replace(/<template([^>]*)>([\s\S]*?)<\/template>/i,`<template$1>${c}</template>`),map:null})}}}exports.default=$;exports.vitePluginDevInspector=$;
