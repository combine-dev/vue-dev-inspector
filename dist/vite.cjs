"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const w=require("fs"),x=require("path");function $(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,s.get?s:{enumerable:!0,get:()=>e[t]})}}return n.default=e,Object.freeze(n)}const h=$(w),m=$(x);function M(e){const n=new Map;try{if(!h.existsSync(e))return console.warn(`[vue-dev-inspector] Analysis file not found: ${e}`),n;const t=JSON.parse(h.readFileSync(e,"utf-8"));for(const[,s]of Object.entries(t.components))for(const r of s.elements)if(r.binding&&r.db){const c=r.binding.replace(/^\./,"");n.has(c)||n.set(c,r.db)}console.log(`[vue-dev-inspector] Loaded ${n.size} binding->DB mappings from analysis`)}catch(t){console.warn("[vue-dev-inspector] Failed to load analysis file:",t)}return n}function _(e,n,t){let s=e;const r=/\{\{\s*([^{}]+?)\s*\}\}/g,c=[];let o;for(;(o=r.exec(e))!==null;){const u=o[0],d=o[1].trim();if(e.slice(Math.max(0,o.index-100),o.index).includes("data-di-binding")||d.includes("?")&&d.includes(":")||d.includes("|"))continue;let i=d.replace(/\?\.?/g,".").replace(/\s+/g,"").replace(/^\(|\)$/g,"");const p=i.match(/^\w+\(([^)]+)\)$/);p&&(i=p[1]);let a=`data-di-binding="${i}"`;a+=` data-di-component="${t}"`;let l=n.get(i);if(!l&&i.includes(".")){const v=i.split(".").pop();for(const[b,P]of n.entries())if(b.endsWith("."+v)||b===v){l=P;break}}l&&(a+=` data-di-db="${l.table}.${l.column}"`,l.type&&(a+=` data-di-db-type="${l.type}"`),l.comment&&(a+=` data-di-db-comment="${l.comment.replace(/"/g,"&quot;")}"`));const f=`<span ${a}>${u}</span>`;c.push({original:u,replacement:f})}for(const{original:u,replacement:d}of c.reverse())s=s.replace(u,d);return s}function O(e){return m.basename(e,".vue")}function y(e={}){const{enabled:n=process.env.NODE_ENV!=="production",analysisPath:t,exclude:s=["node_modules/**","**/node_modules/**"]}=e;let r=new Map;return{name:"vite-plugin-dev-inspector",enforce:"pre",configResolved(){if(!n){console.log("[vue-dev-inspector] Plugin disabled");return}if(console.log("[vue-dev-inspector] Plugin enabled"),t){const c=m.isAbsolute(t)?t:m.resolve(process.cwd(),t);r=M(c)}},transform(c,o){if(!n||!o.endsWith(".vue"))return null;console.log(`[vue-dev-inspector] transform called: ${o}`);const u=m.relative(process.cwd(),o);if(s.some(f=>f.includes("**")?u.includes(f.replace("**/","").replace("/**","")):u.startsWith(f)))return null;const g=c.match(/<template[^>]*>([\s\S]*?)<\/template>/i);if(!g)return console.log(`[vue-dev-inspector] No template found in: ${o}`),null;const i=g[1],p=O(o);console.log(`[vue-dev-inspector] Processing template for: ${p}`);const a=_(i,r,p);return a===i?(console.log(`[vue-dev-inspector] No changes for: ${p}`),null):(console.log(`[vue-dev-inspector] Transformed: ${p}`),{code:c.replace(/<template([^>]*)>([\s\S]*?)<\/template>/i,`<template$1>${a}</template>`),map:null})}}}exports.default=y;exports.vitePluginDevInspector=y;
