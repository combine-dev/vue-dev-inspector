"use strict";const i=require("vue"),be=require("pinia");var F=typeof document<"u"?document.currentScript:null;const Ce={},Te="devInspector:elementConfigs",W=be.defineStore("devInspector",()=>{const $=i.ref({}),T=i.ref(!1),y=i.ref(!1),w=i.ref(!1),x=i.ref(null),I=i.ref(!1),r=i.ref({}),A=i.ref(null),R=i.ref(null),B=i.computed(()=>$.value.storageKey||Te),S=i.ref(null),_=i.computed(()=>$.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:F&&F.tagName.toUpperCase()==="SCRIPT"&&F.src||new URL("useDevInspector-Dv9oGpxu.cjs",document.baseURI).href}<"u"&&Ce?!1:process.env.NODE_ENV==="development");function G(e={}){$.value=e,Y(),e.analysisData&&(S.value=e.analysisData)}async function K(e){var n;try{const t=await fetch(e);t.ok&&(S.value=await t.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=S.value)==null?void 0:n.components)||{}).length,"components"))}catch(t){console.warn("[DevInspector] Failed to load analysis data:",t)}}function V(e){if(!S.value)return null;for(const n of Object.values(S.value.components)){const t=n.elements.find(o=>o.selector===e);if(t)return t}return null}function H(e){if(!S.value)return[];const n=[];for(const[t,o]of Object.entries(S.value.components))(!e||t.includes(e))&&n.push(...o.elements);return n}function Y(){try{const e=$.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(B.value),t=n?JSON.parse(n):{};r.value={...e,...t}}else r.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function L(){try{if(typeof window<"u"){const e=JSON.stringify(r.value);localStorage.setItem(B.value,e),console.log("[DevInspector] Saved configs:",Object.keys(r.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}i.watch(r,()=>{i.nextTick(()=>{L()})},{deep:!0});function Q(){_.value&&(T.value=!T.value,T.value||(y.value=!1,A.value=null))}function ee(){_.value&&(T.value=!0)}function te(){T.value=!1,y.value=!1,A.value=null}function ne(){y.value=!y.value,y.value||(A.value=null),y.value&&(w.value=!1)}function oe(){w.value=!w.value,w.value&&(y.value=!1),R.value=null}function ae(e){R.value=e}function U(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const a=Array.from(t.classList).filter(l=>!l.startsWith("hover:")&&!l.startsWith("focus:")).slice(0,2);a.length>0&&(o+="."+a.join("."));const s=t.parentElement;if(s){const l=Array.from(s.children).filter(p=>p.tagName===t.tagName);if(l.length>1){const p=l.indexOf(t)+1;o+=`:nth-child(${p})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function se(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(r.value).filter(n=>{const t=r.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function re(e){x.value=e}function ie(){x.value=null}function ce(){I.value=!I.value}function le(){I.value=!0}function ue(){I.value=!1}function fe(e){return r.value[e]}function z(e,n){var s;const t=new Date().toISOString(),o=r.value[e],a={...o,...n,id:e,componentPath:n.componentPath||((s=x.value)==null?void 0:s.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};r.value={...r.value,[e]:a},i.nextTick(()=>L())}function de(e){const{[e]:n,...t}=r.value;r.value=t,i.nextTick(()=>L())}function q(e){var k;const n=((k=e.textContent)==null?void 0:k.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const u=o.props||{},d=o.attrs||{};if("modelValue"in u||"model-value"in d)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const u=e.type||"text",d=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${u}]${d?` placeholder="${d}"`:""}`,isStatic:!1}}const a=e.dataset.source||e.dataset.field||e.dataset.bind;if(a)return{type:"prop",source:a,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const s=e.closest('ul, ol, [role="list"]');if(s&&s.children.length>1)return{type:"api",source:"list item",isStatic:!1};const l=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const u of l){const d=e.closest(u);if(d){const g=d.parentElement;if(g&&Array.from(g.children).filter(C=>C!==d&&C.className===d.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const u=e.parentElement,g=Array.from(u.children).filter(m=>m.tagName===e.tagName);if(g.length>=2&&g.filter(C=>C.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const b=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const u of b)if(u.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const v=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const u of v)if(u.test(n))return{type:"api",source:"name pattern",isStatic:!1};const f=["LABEL","TH","LEGEND","FIGCAPTION"].includes(t),h=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(u=>u.test(n)),D=t==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return f||h||D&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function J(e,n){var a,s,l,p,b;const t=q(e),o={};if(t){o.sourceBinding=t;const v=((a=e.textContent)==null?void 0:a.trim())||"";if(t.isStatic)o.note={type:"info",text:`【固定文言】${v}`};else if(t.type==="v-model"){const c=e.tagName.toUpperCase();if(c==="INPUT"||c==="SELECT"||c==="TEXTAREA"){const f=e.placeholder||"",E=((l=(s=e.closest("label"))==null?void 0:s.textContent)==null?void 0:l.trim())||e.getAttribute("aria-label")||((b=(p=document.querySelector(`label[for="${e.id}"]`))==null?void 0:p.textContent)==null?void 0:b.trim())||"";o.note={type:"todo",text:`【フォーム要素】${E||f||c.toLowerCase()}`}}}else t.type==="api"&&(o.note={type:"question",text:`【動的データ】${v.substring(0,100)}${v.length>100?"...":""}`})}return o}const N=i.ref(!1),P=i.ref(0),O=i.ref([]);async function M(e={}){N.value=!0,P.value=0,O.value=[];const{rescan:n=!1}=e;if(n){const t=typeof window<"u"?window.location.pathname:"/",o=Object.keys(r.value).filter(a=>{const s=r.value[a];return!s.componentPath||s.componentPath.includes(t)});for(const a of o)delete r.value[a];i.nextTick(()=>L())}try{const t=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),o=document.querySelectorAll(t),a=[];o.forEach(v=>{var d;const c=v;if(c.closest("[data-dev-inspector]"))return;const f=window.getComputedStyle(c);if(f.display==="none"||f.visibility==="hidden"||f.opacity==="0")return;const E=U(c);if(r.value[E])return;const h=c.tagName.toUpperCase(),D=((d=c.textContent)==null?void 0:d.trim())||"";if(h==="INPUT"||h==="SELECT"||h==="TEXTAREA"){a.push(c);return}if(D.length>300||D.length===0||h==="DIV"&&(Array.from(c.childNodes).filter(m=>m.nodeType===Node.TEXT_NODE).map(m=>{var C;return((C=m.textContent)==null?void 0:C.trim())||""}).join("").trim().length===0||c.children.length>3))return;const k=Array.from(c.childNodes).some(g=>{var m;return g.nodeType===Node.TEXT_NODE&&(((m=g.textContent)==null?void 0:m.trim())||"").length>0}),u=!Array.from(c.children).some(g=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(g.tagName));(k||c.children.length===0&&D.length>0||u)&&a.push(c)});const s=a.length;let l=0,p=0;const b=20;for(let v=0;v<a.length;v+=b){const c=a.slice(v,v+b);for(const f of c){const E=U(f),h=J(f,E);h.sourceBinding&&(O.value.push({selector:E,element:f,detected:h}),z(E,h),p++),l++,P.value=Math.round(l/s*100)}await new Promise(f=>setTimeout(f,10))}return p}finally{N.value=!1,P.value=100}}const X=i.ref([]),j=i.ref("");async function pe(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];N.value=!0;const n=[];try{const o=e.getRoutes(),a=[];for(const s of o)s.path.includes(":")&&!s.path.includes("?")||s.redirect||s.path!=="/:pathMatch(.*)*"&&((t=s.meta)!=null&&t.devInspectorSkip||a.push(s.path));X.value=a;for(const s of a){j.value=s;try{await e.push(s),await new Promise(p=>setTimeout(p,500));const l=await M();n.push({page:s,count:l})}catch(l){console.warn(`[DevInspector] Failed to scan page ${s}:`,l),n.push({page:s,count:0})}}return n}finally{N.value=!1,j.value=""}}function ve(){O.value=[],P.value=0}function ge(e){A.value=e}function he(){A.value=null}function me(){return JSON.stringify(r.value,null,2)}function Z(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:r.value};return JSON.stringify(e,null,2)}function ye(e="dev-annotations.json"){const n=Z(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function Se(e){try{const n=JSON.parse(e),t=n.annotations||n;r.value={...r.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function Ee(){r.value={}}return{isEnabled:T,isAvailable:_,isEditMode:y,isPickMode:w,hoveredSelector:R,currentScreenSpec:x,isPanelOpen:I,elementConfigs:r,editingElementId:A,init:G,toggle:Q,enable:ee,disable:te,toggleEditMode:ne,togglePickMode:oe,setHoveredSelector:ae,generateSelector:U,getConfiguredSelectors:se,setScreenSpec:re,clearScreenSpec:ie,togglePanel:ce,openPanel:le,closePanel:ue,getElementConfig:fe,setElementConfig:z,deleteElementConfig:de,startEditing:ge,stopEditing:he,exportConfigs:me,exportAsFile:Z,downloadAnnotations:ye,importConfigs:Se,clearAllConfigs:Ee,detectSourceBinding:q,autoDetectElementInfo:J,isScanning:N,scanProgress:P,scanResults:O,scanCurrentPage:M,scanAllPages:pe,allPagesRoutes:X,currentScanPage:j,clearScanResults:ve,analysisData:S,loadAnalysisData:K,getAnalyzedElement:V,getAnalyzedElementsForPage:H}});function Ae(){return W()}exports.useDevInspector=Ae;exports.useDevInspectorStore=W;
