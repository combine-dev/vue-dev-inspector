"use strict";const g=require("vue"),Jt=require("pinia");var De=typeof document<"u"?document.currentScript:null;function u(b){return b.replace(/\|/g,"\\|").replace(/\n/g," ")}function We(b){const I={};for(const[B,U]of Object.entries(b)){const t=U.pagePath||"/";I[t]||(I[t]=[]),I[t].push({selector:B,config:U})}return I}function Gt(b){var I,B,U,t,W,X;return b.elementType==="form"?"入力":b.elementType==="action"?((I=b.actionInfo)==null?void 0:I.type)==="navigate"?"リンク":(((B=b.actionInfo)==null?void 0:B.type)==="modal","ボタン"):b.fieldInfo||((U=b.note)==null?void 0:U.displayType)==="db_direct"||((t=b.note)==null?void 0:t.displayType)==="db_formatted"?"表示":((W=b.note)==null?void 0:W.displayType)==="calculated"?"表示(計算)":((X=b.note)==null?void 0:X.displayType)==="static"?"表示(固定)":"表示"}function Wt(b){var I,B,U,t;return(I=b.note)!=null&&I.text?b.note.text:(B=b.fieldInfo)!=null&&B.description?b.fieldInfo.description:b.fieldInfo?`${b.fieldInfo.table}.${b.fieldInfo.column}`:(U=b.actionInfo)!=null&&U.description?b.actionInfo.description:(t=b.formInfo)!=null&&t.description?b.formInfo.description:b.id}function zt(b){var B,U;const I=[];if(b.fieldInfo&&I.push(`DBの${b.fieldInfo.table}.${b.fieldInfo.column}を表示`),((B=b.note)==null?void 0:B.displayType)==="calculated"&&b.note.calcDescription&&I.push(b.note.calcDescription),b.actionInfo){const W={navigate:"画面遷移",api:"API呼び出し",modal:"モーダル表示",emit:"イベント発火",function:"関数実行",csv_export:"CSV出力",csv_import:"CSV取込",email:"メール送信"}[b.actionInfo.type]||b.actionInfo.type;I.push(`${W}${b.actionInfo.target?`: ${b.actionInfo.target}`:""}`)}return(U=b.formInfo)!=null&&U.description&&I.push(b.formInfo.description),I.join(" / ")}function ze(b){var X,$,z;const I=[],B=new Set;for(const J of Object.values(b))if((X=J.auth)!=null&&X.roles)for(const N of J.auth.roles)B.add(N);const U=[...B].sort();if(U.length===0&&!Object.values(b).some(J=>J.auth))return I;I.push("## 権限マトリクス");const t=U.map(J=>` ${J} `).join("|");I.push(`| 画面 | パス | 認証 |${t?t+"|":""}`);const W=U.map(()=>"------").join("|");I.push(`|------|------|------|${W?W+"|":""}`);for(const[J,N]of Object.entries(b)){const se=N.name||J,H=($=N.auth)!=null&&$.required?"必須":"不要";if((z=N.auth)!=null&&z.required){const A=N.auth.roles||[],D=U.map(E=>A.length===0||A.includes(E)?" ○ ":" × ").join("|");I.push(`| ${u(se)} | ${u(J)} | ${H} |${D?D+"|":""}`)}else{const A=U.map(()=>" - ").join("|");I.push(`| ${u(se)} | ${u(J)} | ${H} |${A?A+"|":""}`)}}return I.push(""),I}function Kt(b,I,B,U={}){var se,H,A,D,E,ie,Z,ce,P,M,R,ae,Q,ee,Y,q;const t=[];t.push("# 画面仕様（SDD）"),t.push("");const W=We(b),X=new Set([...Object.keys(I),...Object.keys(W)]);for(const f of X){const y=I[f],G=W[f]||[];if(t.push(`## ${f} — ${(y==null?void 0:y.name)||f}`),t.push(""),t.push("### 画面情報"),y!=null&&y.auth){const S=(se=y.auth.roles)!=null&&se.length?` (${y.auth.roles.join(", ")})`:"";t.push(`- 認証: ${y.auth.required?"必須":"不要"}${S}`)}y!=null&&y.componentPath&&t.push(`- コンポーネント: ${y.componentPath}`),y!=null&&y.description&&t.push(`- 概要: ${y.description}`),t.push("");const pe=(y==null?void 0:y.apis)||[];if(pe.length>0){t.push("### API"),t.push("| メソッド | エンドポイント | タイミング | 説明 |"),t.push("|---------|-------------|----------|------|");for(const S of pe){const x=S.loadTiming||"";t.push(`| ${S.method} | ${u(S.endpoint)} | ${x} | ${u(S.description||"")} |`)}t.push("")}const fe=G.filter(S=>S.config.elementType==="datasource"||!S.config.elementType&&S.config.fieldInfo),he=G.filter(S=>S.config.elementType==="action"||!S.config.elementType&&S.config.actionInfo&&!S.config.fieldInfo),le=G.filter(S=>S.config.elementType==="form"||!S.config.elementType&&S.config.formInfo&&!S.config.fieldInfo&&!S.config.actionInfo),$e=G.filter(S=>!fe.includes(S)&&!he.includes(S)&&!le.includes(S));if(fe.length>0||$e.length>0){t.push("### データソース"),t.push("| セレクタ | DB | 型 | NULL時 | 表示形式 | 計算ロジック |"),t.push("|---------|-----|-----|--------|---------|------------|");for(const{selector:S,config:x}of[...fe,...$e]){const i=x.fieldInfo,te=i?`${i.table}.${i.column}`:"",ne=(i==null?void 0:i.type)||"",K=((H=x.note)==null?void 0:H.nullDisplay)||"-",F=((A=x.note)==null?void 0:A.displayFormat)||"";let k="";((D=x.note)==null?void 0:D.displayType)==="calculated"&&x.note.calcDescription&&(k=x.note.calcDescription),(E=x.note)!=null&&E.storedCalc&&x.note.storedCalcLogic&&(k=x.note.storedCalcLogic),t.push(`| ${u(S)} | ${u(te)} | ${u(ne)} | ${u(K)} | ${u(F)} | ${u(k)} |`)}t.push("")}if(he.length>0){t.push("### アクション"),t.push("| セレクタ | タイプ | 遷移先/API | 説明 |"),t.push("|---------|--------|-----------|------|");for(const{selector:S,config:x}of he){const i=x.actionInfo,te=(i==null?void 0:i.type)||"";let ne=(i==null?void 0:i.target)||"";i!=null&&i.method&&(ne=`${i.method} ${ne}`);const K=(i==null?void 0:i.description)||((ie=x.note)==null?void 0:ie.text)||"";t.push(`| ${u(S)} | ${u(te)} | ${u(ne)} | ${u(K)} |`)}t.push("")}if(le.length>0){t.push("### フォーム"),t.push("| セレクタ | DB | 入力タイプ | 必須 | バリデーション | 初期値 |"),t.push("|---------|-----|----------|------|--------------|--------|");for(const{selector:S,config:x}of le){const i=x.fieldInfo,te=i?`${i.table}.${i.column}`:"",ne=((Z=x.formInfo)==null?void 0:Z.inputType)||"",K=(ce=x.formInfo)!=null&&ce.required?"Yes":"",F=[...((P=x.formInfo)==null?void 0:P.validation)||[],...(i==null?void 0:i.validation)||[]].join(", "),k=((M=x.formInfo)==null?void 0:M.defaultValue)||"";t.push(`| ${u(S)} | ${u(te)} | ${u(ne)} | ${K} | ${u(F)} | ${u(k)} |`)}t.push("")}const ue=G.filter(S=>{var x,i;return((x=S.config.actionInfo)==null?void 0:x.type)==="csv_export"||((i=S.config.actionInfo)==null?void 0:i.type)==="csv_import"});if(ue.length>0){t.push("### CSV仕様");for(const{config:S}of ue){const x=S.actionInfo,i=x.csvSpec,te=x.type==="csv_export"?"CSV出力":"CSV取込",ne=x.description||((R=S.note)==null?void 0:R.text)||"";if(t.push(`#### ${te}: ${ne}`),t.push(""),i){const K=[];if(i.encoding&&K.push(`- エンコーディング: ${i.encoding}`),i.delimiter){const F={",":"カンマ","	":"タブ","|":"パイプ"};K.push(`- 区切り文字: ${F[i.delimiter]||i.delimiter}`)}if(i.hasHeaderRow!==void 0&&K.push(`- ヘッダー行: ${i.hasHeaderRow?"あり":"なし"}`),i.filenamePattern&&K.push(`- ファイル名: ${i.filenamePattern}`),K.length>0&&(t.push("**ファイル設定**"),t.push(...K),t.push("")),i.columns.length>0&&(i.columns.some(k=>k.processing)?(t.push("| No | 項目名 | DBマッピング | 加工ロジック | 型 | 必須 | バリデーション | フォーマット | 説明 |"),t.push("|----|--------|-------------|------------|-----|------|--------------|------------|------|"),i.columns.forEach((k,me)=>{t.push(`| ${me+1} | ${u(k.name)} | ${u(k.dbMapping||"")} | ${u(k.processing||"")} | ${u(k.type||"")} | ${k.required?"Yes":""} | ${u(k.validation||"")} | ${u(k.format||"")} | ${u(k.description||"")} |`)})):(t.push("| No | 項目名 | DBマッピング | 型 | 必須 | バリデーション | フォーマット | 説明 |"),t.push("|----|--------|-------------|-----|------|--------------|------------|------|"),i.columns.forEach((k,me)=>{t.push(`| ${me+1} | ${u(k.name)} | ${u(k.dbMapping||"")} | ${u(k.type||"")} | ${k.required?"Yes":""} | ${u(k.validation||"")} | ${u(k.format||"")} | ${u(k.description||"")} |`)})),t.push("")),x.type==="csv_export"){const F=[];i.sortOrder&&F.push(`- ソート: ${i.sortOrder}`),i.filterCondition&&F.push(`- 抽出条件: ${i.filterCondition}`),i.maxRows&&F.push(`- 最大行数: ${i.maxRows}`),F.length>0&&(t.push("**出力オプション**"),t.push(...F),t.push(""))}if(x.type==="csv_import"){const F=[],k={stop_on_first:"最初のエラーで停止",skip_and_continue:"スキップして続行",collect_all:"全エラー収集"},me={skip:"スキップ",overwrite:"上書き",error:"エラー"};i.errorHandling&&F.push(`- エラー処理: ${k[i.errorHandling]||i.errorHandling}`),i.duplicateHandling&&F.push(`- 重複処理: ${me[i.duplicateHandling]||i.duplicateHandling}`),i.preValidation&&F.push(`- 事前バリデーション: ${i.preValidation}`),F.length>0&&(t.push("**取込オプション**"),t.push(...F),t.push(""))}if(i.errorDefs&&i.errorDefs.length>0){t.push("**エラー定義**"),t.push("| 対象列 | エラー条件 | エラーメッセージ | 種別 |"),t.push("|--------|----------|----------------|------|");for(const F of i.errorDefs){const k=F.severity==="warning"?"警告":"エラー";t.push(`| ${u(F.column||"（全体）")} | ${u(F.condition)} | ${u(F.message)} | ${k} |`)}t.push("")}}}}const Se=G.filter(S=>{var x;return((x=S.config.actionInfo)==null?void 0:x.type)==="email"});if(Se.length>0){t.push("### メール送信仕様");for(const{config:S}of Se){const x=S.actionInfo,i=x.emailSpec,te=x.description||((ae=S.note)==null?void 0:ae.text)||"";t.push(`#### メール送信: ${te}`),i&&(i.trigger&&t.push(`- トリガー: ${i.trigger}`),i.to&&t.push(`- 宛先: ${i.to}`),i.cc&&t.push(`- CC: ${i.cc}`),i.bcc&&t.push(`- BCC: ${i.bcc}`),i.subject&&t.push(`- 件名: ${i.subject}`),i.bodyTemplate&&t.push(`- 本文概要: ${i.bodyTemplate}`),i.templatePath&&t.push(`- テンプレート: ${i.templatePath}`),i.variables&&i.variables.length>0&&t.push(`- 差し込み変数: ${i.variables.join(", ")}`),i.attachments&&t.push(`- 添付ファイル: ${i.attachments}`),i.conditions&&t.push(`- 送信条件: ${i.conditions}`),i.errorHandling&&t.push(`- エラー処理: ${i.errorHandling}`)),t.push("")}}t.push("---"),t.push("")}const $=ze(I);$.length>0&&t.push(...$);const z=[];for(const[f,y]of Object.entries(b))if(((Q=y.actionInfo)==null?void 0:Q.type)==="navigate"&&y.actionInfo.target){const G=y.pagePath||"/";z.push({from:G,to:y.actionInfo.target,trigger:y.actionInfo.description||((ee=y.note)==null?void 0:ee.text)||f})}if(z.length>0){t.push("## 画面フロー"),t.push("| 遷移元 | 遷移先 | トリガー |"),t.push("|--------|--------|---------|");for(const f of z){const y=((Y=I[f.from])==null?void 0:Y.name)||f.from,G=((q=I[f.to])==null?void 0:q.name)||f.to;t.push(`| ${u(y)} (${u(f.from)}) | ${u(G)} (${u(f.to)}) | ${u(f.trigger)} |`)}t.push("")}const J=Object.values(B);if(J.length>0){t.push("## マスタ定義"),t.push("");for(const f of J){t.push(`### ${f.id} — ${f.name} (${f.columnType||""})`),f.description&&(t.push(f.description),t.push("")),t.push("| 値 | ラベル | 説明 |"),t.push("|----|--------|------|");for(const y of f.entries)t.push(`| ${u(y.value)} | ${u(y.label)} | ${u(y.description||"")} |`);if(t.push(""),f.transitions&&f.transitions.length>0){t.push("**状態遷移**"),t.push("| 遷移元 | 遷移先 | トリガー | 条件 |"),t.push("|--------|--------|---------|------|");for(const y of f.transitions){const G=f.entries.find(le=>le.value===y.from),pe=f.entries.find(le=>le.value===y.to),fe=G?`${G.label} (${y.from})`:y.from,he=pe?`${pe.label} (${y.to})`:y.to;t.push(`| ${u(fe)} | ${u(he)} | ${u(y.trigger)} | ${u(y.condition||"")} |`)}t.push("")}}}const N=Object.values(U);if(N.length>0){t.push("## バッチ処理定義"),t.push("");for(const f of N){if(t.push(`### ${f.name}`),f.schedule&&t.push(`- スケジュール: ${f.schedule}`),f.trigger&&t.push(`- トリガー: ${f.trigger}`),f.description&&t.push(`- 概要: ${f.description}`),f.timeout&&t.push(`- タイムアウト: ${f.timeout}`),f.retryPolicy&&t.push(`- リトライ: ${f.retryPolicy}`),f.inputTables&&f.inputTables.length>0&&t.push(`- 入力: ${f.inputTables.join(", ")}`),f.outputTables&&f.outputTables.length>0&&t.push(`- 出力: ${f.outputTables.join(", ")}`),t.push(""),f.steps.length>0){t.push("**処理ステップ**"),t.push("| No | 処理内容 | 対象 | 種別 | エラー時 |"),t.push("|----|---------|------|------|---------|");for(const y of f.steps)t.push(`| ${y.order} | ${u(y.description)} | ${u(y.target||"-")} | ${u(y.type||"")} | ${u(y.errorHandling||"")} |`);t.push("")}f.notifyOnError&&t.push(`- エラー通知: ${f.notifyOnError}`),f.notifyOnComplete&&t.push(`- 完了通知: ${f.notifyOnComplete}`),(f.notifyOnError||f.notifyOnComplete)&&t.push("")}}return t.join(`
`)}function Yt(b,I,B,U={}){var N,se,H;const t=[];t.push("# 画面仕様書"),t.push("");const W=We(b),X=new Set([...Object.keys(I),...Object.keys(W)]);for(const A of X){const D=I[A],E=W[A]||[];if(t.push(`## ${(D==null?void 0:D.name)||A}`),t.push(`**URL:** ${A}`),t.push(""),D!=null&&D.description&&(t.push("### 概要"),t.push(D.description),t.push("")),D!=null&&D.auth){if(t.push("### 認証"),t.push(`- ${D.auth.required?"ログイン必須":"ログイン不要"}`),(N=D.auth.roles)!=null&&N.length){const P=D.auth.roles.map(M=>({admin:"管理者",manager:"マネージャー",user:"ユーザー"})[M]||M);t.push(`- 権限: ${P.join("、")}`)}t.push("")}E.length>0&&(t.push("### 画面項目"),t.push("| No | 項目名 | 種別 | 説明 | 必須 | 備考 |"),t.push("|----|--------|------|------|------|------|"),E.forEach(({config:P},M)=>{var q,f,y,G;const R=Wt(P),ae=Gt(P),Q=zt(P),ee=(q=P.formInfo)!=null&&q.required?"必須":"",Y=[];(f=P.note)!=null&&f.condition&&Y.push(P.note.condition),(y=P.note)!=null&&y.unit&&Y.push(`単位: ${P.note.unit}`),(G=P.note)!=null&&G.nullDisplay&&P.note.nullDisplay!=="-"&&Y.push(`空欄時: ${P.note.nullDisplay}`),t.push(`| ${M+1} | ${u(R)} | ${ae} | ${u(Q)} | ${ee} | ${u(Y.join(" / "))} |`)}),t.push(""));const ie=(D==null?void 0:D.apis)||[];if(ie.length>0){t.push("### 使用API"),t.push("| メソッド | エンドポイント | 説明 |"),t.push("|---------|-------------|------|");for(const P of ie)t.push(`| ${P.method} | ${u(P.endpoint)} | ${u(P.description||"")} |`);t.push("")}const Z=E.filter(P=>{var M,R;return((M=P.config.actionInfo)==null?void 0:M.type)==="csv_export"||((R=P.config.actionInfo)==null?void 0:R.type)==="csv_import"});if(Z.length>0){t.push("### CSV入出力仕様");for(const{config:P}of Z){const M=P.actionInfo,R=M.csvSpec,ae=M.type==="csv_export"?"CSV出力":"CSV取込",Q=M.description||((se=P.note)==null?void 0:se.text)||"";if(t.push(`#### ${ae}: ${Q}`),t.push(""),R){const ee=[];if(R.encoding&&ee.push(`- エンコーディング: ${R.encoding}`),R.filenamePattern&&ee.push(`- ファイル名: ${R.filenamePattern}`),ee.length>0&&(t.push(...ee),t.push("")),R.columns.length>0&&(R.columns.some(q=>q.processing)?(t.push("| No | 項目名 | 加工 | 型 | 必須 | 説明 |"),t.push("|----|--------|------|-----|------|------|"),R.columns.forEach((q,f)=>{t.push(`| ${f+1} | ${u(q.name)} | ${u(q.processing||"")} | ${u(q.type||"")} | ${q.required?"必須":""} | ${u(q.description||"")} |`)})):(t.push("| No | 項目名 | 型 | 必須 | 説明 |"),t.push("|----|--------|-----|------|------|"),R.columns.forEach((q,f)=>{t.push(`| ${f+1} | ${u(q.name)} | ${u(q.type||"")} | ${q.required?"必須":""} | ${u(q.description||"")} |`)})),t.push("")),R.errorDefs&&R.errorDefs.length>0){t.push("**エラー時の動作**"),t.push("| エラー条件 | メッセージ |"),t.push("|----------|----------|");for(const Y of R.errorDefs){const q=Y.column?`[${Y.column}] `:"";t.push(`| ${u(q+Y.condition)} | ${u(Y.message)} |`)}t.push("")}}}}const ce=E.filter(P=>{var M;return((M=P.config.actionInfo)==null?void 0:M.type)==="email"});if(ce.length>0){t.push("### メール送信");for(const{config:P}of ce){const M=P.actionInfo,R=M.emailSpec,ae=M.description||((H=P.note)==null?void 0:H.text)||"";t.push(`#### ${ae}`),R&&(R.trigger&&t.push(`- タイミング: ${R.trigger}`),R.to&&t.push(`- 宛先: ${R.to}`),R.subject&&t.push(`- 件名: ${R.subject}`)),t.push("")}}D!=null&&D.notes&&(t.push("### 備考"),t.push(D.notes),t.push("")),t.push("---"),t.push("")}const $=Object.values(B).filter(A=>A.transitions&&A.transitions.length>0);if($.length>0){t.push("## 状態遷移");for(const A of $){t.push(`### ${A.name}`),t.push("| 遷移元 | 遷移先 | 操作 | 条件 |"),t.push("|--------|--------|------|------|");for(const D of A.transitions){const E=A.entries.find(P=>P.value===D.from),ie=A.entries.find(P=>P.value===D.to),Z=E?E.label:D.from,ce=ie?ie.label:D.to;t.push(`| ${u(Z)} | ${u(ce)} | ${u(D.trigger)} | ${u(D.condition||"")} |`)}t.push("")}}const z=Object.values(U);if(z.length>0){t.push("## バッチ処理"),t.push("");for(const A of z)t.push(`### ${A.name}`),A.schedule&&t.push(`- 実行タイミング: ${A.schedule}`),A.description&&t.push(`- 概要: ${A.description}`),t.push("")}const J=ze(I);return J.length>0&&t.push(...J),t.join(`
`)}const Xt={},Zt="devInspector:elementConfigs",Ve="devInspector:screenConfigs",Je="devInspector:masterDefinitions",Ge="devInspector:batchDefinitions",Ke=Jt.defineStore("devInspector",()=>{const b=g.ref({}),I=g.ref(!1),B=g.ref(!1),U=g.ref(!1),t=g.ref(!1),W=g.ref(null),X=g.ref(!1),$=g.ref({}),z=g.ref(null),J=g.ref(null),N=g.ref({}),se=g.ref(!1),H=g.ref({}),A=g.ref({}),D=g.computed(()=>b.value.storageKey||Zt),E=g.ref(null),ie=g.ref("all"),Z=g.ref(!0),ce=g.ref("all"),P=g.ref(!1),M=g.ref(""),R=g.ref("column"),ae=g.ref(!1),Q=g.ref([]),ee=g.ref(null),Y=g.ref(!1),q=g.ref(new Set),f="devInspector:hiddenAnalysisSelectors",y=g.computed(()=>b.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:De&&De.tagName.toUpperCase()==="SCRIPT"&&De.src||new URL("useDevInspector-CvbgduVJ.cjs",document.baseURI).href}<"u"&&Xt?!1:process.env.NODE_ENV==="development"),G=g.ref(!1);function pe(e={}){b.value=e,$e(),Se(),ne(),Ze(),wt(),e.analysisData&&(E.value=e.analysisData);const n=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&y.value&&fe(n)}async function fe(e){var n;try{const o=await fetch(e);if(o.ok)return E.value=await o.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=E.value)==null?void 0:n.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function he(e){if(!E.value)return null;for(const n of Object.values(E.value.components)){const o=n.elements.find(s=>s.selector===e);if(o)return o}return null}function le(e){if(!E.value)return[];const n=[];for(const[o,s]of Object.entries(E.value.components))(!e||o.includes(e))&&n.push(...s.elements);return n}function $e(){try{const e=b.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(D.value),o=n?JSON.parse(n):{};$.value={...e,...o}}else $.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function ue(){try{if(typeof window<"u"){const e=JSON.stringify($.value);localStorage.setItem(D.value,e),console.log("[DevInspector] Saved configs:",Object.keys($.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}g.watch($,()=>{g.nextTick(()=>{ue()})},{deep:!0});function Se(){try{if(typeof window<"u"){const e=localStorage.getItem(Ve);e&&(N.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load screen configs:",e)}}function S(){try{if(typeof window<"u"){const e=JSON.stringify(N.value);localStorage.setItem(Ve,e)}}catch(e){console.error("[DevInspector] Failed to save screen configs:",e)}}g.watch(N,()=>{g.nextTick(()=>{S()})},{deep:!0});function x(e){const n=e||(typeof window<"u"?window.location.pathname:"/");return N.value[n]}function i(e){N.value={...N.value,[e.path]:e},g.nextTick(()=>S())}function te(e){const{[e]:n,...o}=N.value;N.value=o,g.nextTick(()=>S())}function ne(){try{if(typeof window<"u"){const e=localStorage.getItem(Je);e&&(H.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load master definitions:",e)}}function K(){try{typeof window<"u"&&localStorage.setItem(Je,JSON.stringify(H.value))}catch(e){console.error("[DevInspector] Failed to save master definitions:",e)}}g.watch(H,()=>{g.nextTick(()=>{K()})},{deep:!0});function F(e){return H.value[e]}function k(e){H.value={...H.value,[e.id]:{...e,updatedAt:new Date().toISOString()}},g.nextTick(()=>K())}function me(e){const{[e]:n,...o}=H.value;H.value=o,g.nextTick(()=>K())}function Ye(e){return Object.values(H.value).filter(n=>n.table===e)}function Xe(e){var n;return((n=H.value[e])==null?void 0:n.entries)||[]}function Ze(){try{if(typeof window<"u"){const e=localStorage.getItem(Ge);e&&(A.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load batch definitions:",e)}}function Te(){try{typeof window<"u"&&localStorage.setItem(Ge,JSON.stringify(A.value))}catch(e){console.error("[DevInspector] Failed to save batch definitions:",e)}}g.watch(A,()=>{g.nextTick(()=>{Te()})},{deep:!0});function Qe(e){return A.value[e]}function et(e){A.value={...A.value,[e.id]:{...e,updatedAt:new Date().toISOString()}},g.nextTick(()=>Te())}function tt(e){const{[e]:n,...o}=A.value;A.value=o,g.nextTick(()=>Te())}function nt(){var s,r,h,c,m;const e=[],n=new Set,o={};for(const d of Object.values($.value)){const w=d.fieldInfoList||(d.fieldInfo?[d.fieldInfo]:[]),p=((s=d.sourceBinding)==null?void 0:s.type)==="v-model";for(const a of w)a.table&&(o[a.table]||(o[a.table]={read:!1,write:!1,isList:!1}),o[a.table].read=!0,p&&(o[a.table].write=!0));if(((r=d.note)==null?void 0:r.displayType)==="db_direct"||((h=d.note)==null?void 0:h.displayType)==="db_formatted")for(const a of w)a.table&&o[a.table]&&(d.id.includes("tbody")||d.id.includes(" tr")||d.id.includes(" td"))&&(o[a.table].isList=!0);if(((c=d.actionInfo)==null?void 0:c.type)==="api"&&d.actionInfo.target){const a=`${d.actionInfo.method||"GET"}:${d.actionInfo.target}`;n.has(a)||(n.add(a),e.push({method:d.actionInfo.method||"GET",endpoint:d.actionInfo.target,description:d.actionInfo.description||"",loadTiming:"action"}))}}for(const[d,w]of Object.entries(o)){if(w.read){const p=w.isList?`/api/${d}`:`/api/${d}/:id`,a=`GET:${p}`;n.has(a)||(n.add(a),e.push({method:"GET",endpoint:p,description:w.isList?`${d} 一覧取得`:`${d} 詳細取得`,loadTiming:"onMount"}))}if(w.write){const p=`/api/${d}/:id`,a=`PUT:${p}`;n.has(a)||(n.add(a),e.push({method:"PUT",endpoint:p,description:`${d} 更新`,loadTiming:"action"}))}}if((m=E.value)!=null&&m.components){const d=typeof window<"u"?window.location.pathname:"/";for(const[w,p]of Object.entries(E.value.components)){const a=w.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let l=!1;if(d==="/"&&w.includes("index"))l=!0;else if(w.includes("pages/"))try{l=!!d.match(new RegExp(`^${a}$`))}catch{}if(l&&p.apis)for(const v of p.apis){if(!v.endpoint)continue;const _=`${v.method}:${v.endpoint}`;n.has(_)||(n.add(_),e.push({method:v.method,endpoint:v.endpoint,description:v.variable?`→ ${v.variable}`:"",loadTiming:["onMount","useFetch","useAsyncData"].includes(v.loadTrigger)?"onMount":"action"}))}}}return e}const ot=g.computed(()=>{var s,r,h,c,m,d,w,p,a,l,v,_,j,T,L;const e=M.value.trim().toLowerCase();if(!e)return[];const n=R.value,o=[];for(const[O,C]of Object.entries($.value)){const V=C.pagePath||"/",ve=N.value[V],Ce=(ve==null?void 0:ve.name)||V;if(n==="column"){const xe=(s=C.fieldInfoList)!=null&&s.length?C.fieldInfoList:C.fieldInfo?[C.fieldInfo]:[];for(const oe of xe)(`${oe.table}.${oe.column}`.toLowerCase().includes(e)||oe.table.toLowerCase().includes(e)||oe.column.toLowerCase().includes(e))&&o.push({pagePath:V,pageName:Ce,selector:O,elementType:C.elementType,matchedField:`${oe.table}.${oe.column}`,matchContext:`${oe.type||""} ${oe.description||""}`.trim()});const Ie=((r=C.note)==null?void 0:r.calcSources)||[],Vt=((h=C.note)==null?void 0:h.storedCalcSources)||[];for(const oe of[...Ie,...Vt])oe.toLowerCase().includes(e)&&o.push({pagePath:V,pageName:Ce,selector:O,elementType:C.elementType,matchedField:oe,matchContext:((c=C.note)==null?void 0:c.calcDescription)||((m=C.note)==null?void 0:m.storedCalcLogic)||"参照元"})}else if(n==="api")(w=(d=C.actionInfo)==null?void 0:d.target)!=null&&w.toLowerCase().includes(e)&&o.push({pagePath:V,pageName:Ce,selector:O,elementType:C.elementType,matchedField:`${C.actionInfo.method||""} ${C.actionInfo.target}`.trim(),matchContext:C.actionInfo.description||C.actionInfo.type});else if(n==="text"){const xe=[(p=C.note)==null?void 0:p.text,(a=C.note)==null?void 0:a.calcDescription,(l=C.note)==null?void 0:l.formatDescription,(v=C.note)==null?void 0:v.condition,(_=C.actionInfo)==null?void 0:_.description,(j=C.formInfo)==null?void 0:j.description,O].filter(Boolean);for(const Ie of xe)if(Ie.toLowerCase().includes(e)){o.push({pagePath:V,pageName:Ce,selector:O,elementType:C.elementType,matchedField:Ie.substring(0,60),matchContext:((L=(T=C.note)==null?void 0:T.text)==null?void 0:L.substring(0,40))||""});break}}}if(n==="api")for(const[O,C]of Object.entries(N.value))for(const V of C.apis||[])V.endpoint.toLowerCase().includes(e)&&o.push({pagePath:O,pageName:C.name||O,selector:"",elementType:void 0,matchedField:`${V.method} ${V.endpoint}`,matchContext:V.description||"画面API"});return o});function st(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",n=new Set;for(const[a,l]of Object.entries($.value))(!l.pagePath||l.pagePath===e)&&n.add(a);const o=new Set;for(const a of n)try{const l=document.querySelector(a);l&&o.add(l)}catch{}const s=[],r=new Set,h=new Set,c=new Set;function m(a){if(a.closest("[data-dev-inspector]"))return!0;const l=de(a);if(n.has(l)||r.has(l))return!0;for(const v of o)if(v.contains(a)&&v!==a)return!0;return!1}function d(a,l,v,_){const j=de(a);r.add(j),c.add(a),s.push({selector:j,tagName:a.tagName.toLowerCase(),category:l,text:v.substring(0,50),suggestedType:_})}document.querySelectorAll("[data-di-binding]").forEach(a=>{var _;const l=a;if(l.closest("[data-dev-inspector]"))return;const v=l.getAttribute("data-di-binding")||"";h.has(v)||m(l)||(h.add(v),d(l,"binding",((_=l.textContent)==null?void 0:_.trim())||"","datasource"))}),document.querySelectorAll("table").forEach(a=>{if(a.closest("[data-dev-inspector]"))return;const l=window.getComputedStyle(a);if(l.display==="none"||l.visibility==="hidden")return;const v=[];if(a.querySelectorAll("thead th, thead td").forEach(T=>{var L;v.push(((L=T.textContent)==null?void 0:L.trim())||"")}),v.length===0){const T=a.querySelector("tr");T&&T.querySelectorAll("th, td").forEach(L=>{var O;v.push(((O=L.textContent)==null?void 0:O.trim())||"")})}const _=a.querySelector("tbody tr")||a.querySelectorAll("tr")[v.length>0?1:0];if(!_)return;_.querySelectorAll("td").forEach((T,L)=>{var ve;const O=T,C=((ve=O.textContent)==null?void 0:ve.trim())||"";if(!C||O.querySelector("[data-di-binding]")||m(O))return;const V=v[L]||`列${L+1}`;d(O,"binding",`${V}: ${C}`,"datasource")})}),document.querySelectorAll("input, select, textarea").forEach(a=>{var j,T;const l=a;if(l.closest("[data-dev-inspector]")||l.type==="hidden")return;const v=window.getComputedStyle(l);if(v.display==="none"||v.visibility==="hidden"||m(l))return;const _=((T=(j=l.closest("label"))==null?void 0:j.textContent)==null?void 0:T.trim())||l.getAttribute("aria-label")||l.placeholder||l.name||l.tagName.toLowerCase();d(l,"form",_||"","form")});const w=new Set;document.querySelectorAll("table").forEach(a=>{const l=a.querySelector("tbody tr")||a.querySelectorAll("tr")[1];l&&w.add(l)}),document.querySelectorAll('button, a[href], [role="button"]').forEach(a=>{var T;const l=a;if(l.closest("[data-dev-inspector]"))return;const v=((T=l.textContent)==null?void 0:T.trim())||"";if(!v)return;const _=window.getComputedStyle(l);if(_.display==="none"||_.visibility==="hidden")return;const j=l.closest("tr");j&&j.closest("table")&&!w.has(j)||m(l)||d(l,"action",v,"action")});const p=s.filter(a=>{try{const l=document.querySelector(a.selector);if(!l)return!0;for(const v of c)if(v!==l&&v.contains(l))return!1;return!0}catch{return!0}});return Q.value=p,p}function it(e,n){const o={elementType:n,pagePath:typeof window<"u"?window.location.pathname:"/",note:{text:"",type:"todo"}};n==="action"?o.actionInfo={type:"function",description:""}:n==="form"&&(o.formInfo={inputType:"text"}),Ee(e,o),z.value=e,Q.value=Q.value.filter(s=>s.selector!==e)}const at=g.computed(()=>{var c,m,d,w;const e=new Map,n=[],o=new Set;for(const[p,a]of Object.entries(N.value))e.set(p,{path:p,name:a.name||p,annotationCount:Object.values($.value).filter(l=>l.pagePath===p).length});for(const[p,a]of Object.entries($.value))if(((c=a.actionInfo)==null?void 0:c.type)==="navigate"&&a.actionInfo.target){const l=a.pagePath||"/",v=a.actionInfo.target,_=`${l}→${v}`;if(!e.has(l)){const j=N.value[l];e.set(l,{path:l,name:(j==null?void 0:j.name)||l,annotationCount:Object.values($.value).filter(T=>T.pagePath===l).length})}if(!e.has(v)){const j=N.value[v];e.set(v,{path:v,name:(j==null?void 0:j.name)||v,annotationCount:Object.values($.value).filter(T=>T.pagePath===v).length})}if(!o.has(_)){o.add(_);let j=a.actionInfo.description||((m=a.note)==null?void 0:m.text)||"";if(!j&&typeof document<"u")try{const T=document.querySelector(p);T&&(j=((w=(d=T.textContent)==null?void 0:d.trim())==null?void 0:w.substring(0,20))||"")}catch{}n.push({from:l,to:v,label:j,selector:p})}}const s=Array.from(e.values()),r=new Set;for(const p of n)r.add(p.from),r.add(p.to);const h=s.filter(p=>!r.has(p.path));return{nodes:s,edges:n,orphanPages:h}});async function rt(){y.value&&(I.value?(I.value=!1,B.value=!1,z.value=null):await Le())}async function Le(){if(!y.value)return;if(E.value&&!G.value&&b.value.autoApplyAnalysis!==!1){t.value=!0,I.value=!0;try{await new Promise(n=>setTimeout(n,300)),Ue(),G.value=!0}finally{t.value=!1}}else I.value=!0}function ct(){I.value=!1,B.value=!1,z.value=null}function lt(){B.value=!B.value,B.value||(z.value=null),B.value&&(U.value=!1)}function ut(){U.value=!U.value,U.value&&(B.value=!1),J.value=null}function ft(e){J.value=e}function de(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let o=e;for(;o&&o!==document.body;){let s=o.tagName.toLowerCase();if(o.id){s=`#${o.id}`,n.unshift(s);break}const r=Array.from(o.classList).filter(c=>!c.startsWith("hover:")&&!c.startsWith("focus:")&&!c.startsWith("-")&&!/[/\[\]()!@#$%^&*=+{}|\\:'"<>,?.~]/.test(c)).slice(0,2);r.length>0&&(s+="."+r.join("."));const h=o.parentElement;if(h){const c=Array.from(h.children).filter(m=>m.tagName===o.tagName);if(c.length>1){const m=c.indexOf(o)+1;s+=`:nth-of-type(${m})`}}n.unshift(s),o=o.parentElement}return n.join(" > ")}function dt(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys($.value).filter(n=>{const o=$.value[n];return o?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!o.componentPath||o.componentPath.includes(e)||e==="/"):!1})}function pt(e){W.value=e}function ht(){W.value=null}function mt(){X.value?Ae():Ne()}function Oe(){[0,50,100,150,200,250,320].forEach(n=>setTimeout(()=>window.dispatchEvent(new Event("resize")),n))}function Ne(){X.value=!0,typeof document<"u"&&(document.body.style.transition="margin-right 0.3s ease",document.body.style.marginRight="360px",Oe())}function Ae(){X.value=!1,typeof document<"u"&&(document.body.style.transition="margin-right 0.3s ease",document.body.style.marginRight="",Oe())}function gt(e){return $.value[e]}function Ee(e,n){var c;const o=new Date().toISOString(),s=$.value[e],r=typeof window<"u"?window.location.pathname:"/",h={...s,...n,id:e,pagePath:n.pagePath||(s==null?void 0:s.pagePath)||r,componentPath:n.componentPath||((c=W.value)==null?void 0:c.componentPath)||"",createdAt:(s==null?void 0:s.createdAt)||o,updatedAt:o};$.value={...$.value,[e]:h},g.nextTick(()=>ue())}function vt(e){const{[e]:n,...o}=$.value;$.value=o,g.nextTick(()=>ue())}function je(e){var j;const n=((j=e.textContent)==null?void 0:j.trim())||"",o=e.tagName.toUpperCase();if(!n&&o!=="INPUT"&&o!=="SELECT"&&o!=="TEXTAREA")return null;const s=e.__vueParentComponent;if(s){const T=s.props||{},L=s.attrs||{};if("modelValue"in T||"model-value"in L)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(o==="INPUT"||o==="SELECT"||o==="TEXTAREA"){const T=e.type||"text",L=e.placeholder||"";return{type:"v-model",source:`${o.toLowerCase()}[type=${T}]${L?` placeholder="${L}"`:""}`,isStatic:!1}}const r=e.dataset.source||e.dataset.field||e.dataset.bind;if(r)return{type:"prop",source:r,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const h=e.closest('ul, ol, [role="list"]');if(h&&h.children.length>1)return{type:"api",source:"list item",isStatic:!1};const c=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const T of c){const L=e.closest(T);if(L){const O=L.parentElement;if(O&&Array.from(O.children).filter(V=>V!==L&&V.className===L.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const T=e.parentElement,O=Array.from(T.children).filter(C=>C.tagName===e.tagName);if(O.length>=2&&O.filter(V=>V.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const d=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const T of d)if(T.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const w=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const T of w)if(T.test(n))return{type:"api",source:"name pattern",isStatic:!1};const a=["LABEL","TH","LEGEND","FIGCAPTION"].includes(o),v=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(T=>T.test(n)),_=o==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return a||v||_&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function Re(e,n){var l,v,_,j,T;const o={},s=((l=e.textContent)==null?void 0:l.trim())||"",r=e.getAttribute("data-di-binding");e.getAttribute("data-di-db"),e.getAttribute("data-di-component"),e.getAttribute("data-di-db-comment");let h=e;if(!r){const L=e.closest("[data-di-binding]");L&&(h=L)}const c=h.getAttribute("data-di-binding"),m=h.getAttribute("data-di-db"),d=h.getAttribute("data-di-component"),w=h.getAttribute("data-di-db-type"),p=h.getAttribute("data-di-db-comment");if(c||m){if(o.sourceBinding={type:"api",source:c||void 0,isStatic:!1},m){const[L,O]=m.split(".");L&&O&&(o.fieldInfo={table:L,column:O,type:w||void 0,description:p||void 0})}return d&&(o.devMeta={usedComponents:[d]}),o.note={type:"info",text:`【データバインディング】${c}${m?` → ${m}`:""}`},o}const a=je(e);if(a)if(o.sourceBinding=a,a.isStatic)o.note={type:"info",text:`【固定文言】${s}`};else if(a.type==="v-model"){const L=e.tagName.toUpperCase();if(L==="INPUT"||L==="SELECT"||L==="TEXTAREA"){const O=e.placeholder||"",C=((_=(v=e.closest("label"))==null?void 0:v.textContent)==null?void 0:_.trim())||e.getAttribute("aria-label")||((T=(j=document.querySelector(`label[for="${e.id}"]`))==null?void 0:j.textContent)==null?void 0:T.trim())||"";o.note={type:"todo",text:`【フォーム要素】${C||O||L.toLowerCase()}`}}}else a.type==="api"&&(o.note={type:"question",text:`【動的データ】${s.substring(0,100)}${s.length>100?"...":""}`});return o}const ye=g.ref(!1),be=g.ref(0),we=g.ref([]);async function ke(e={}){ye.value=!0,be.value=0,we.value=[];const{rescan:n=!1}=e;if(n){const o=typeof window<"u"?window.location.pathname:"/",s=Object.keys($.value).filter(r=>{const h=$.value[r];return!h.componentPath||h.componentPath.includes(o)});for(const r of s)delete $.value[r];g.nextTick(()=>ue())}try{const o=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),s=document.querySelectorAll(o),r=[];s.forEach(w=>{var L;const p=w;if(p.closest("[data-dev-inspector]"))return;const a=window.getComputedStyle(p);if(a.display==="none"||a.visibility==="hidden"||a.opacity==="0")return;const l=de(p);if($.value[l])return;const v=p.tagName.toUpperCase(),_=((L=p.textContent)==null?void 0:L.trim())||"";if(v==="INPUT"||v==="SELECT"||v==="TEXTAREA"){r.push(p);return}if(_.length>300||_.length===0||v==="DIV"&&(Array.from(p.childNodes).filter(C=>C.nodeType===Node.TEXT_NODE).map(C=>{var V;return((V=C.textContent)==null?void 0:V.trim())||""}).join("").trim().length===0||p.children.length>3))return;const j=Array.from(p.childNodes).some(O=>{var C;return O.nodeType===Node.TEXT_NODE&&(((C=O.textContent)==null?void 0:C.trim())||"").length>0}),T=!Array.from(p.children).some(O=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(O.tagName));(j||p.children.length===0&&_.length>0||T)&&r.push(p)});const h=r.length;let c=0,m=0;const d=20;for(let w=0;w<r.length;w+=d){const p=r.slice(w,w+d);for(const a of p){const l=de(a),v=Re(a,l);v.sourceBinding&&(we.value.push({selector:l,element:a,detected:v}),Ee(l,v),m++),c++,be.value=Math.round(c/h*100)}await new Promise(a=>setTimeout(a,10))}return m}finally{ye.value=!1,be.value=100}}const _e=g.ref([]),Pe=g.ref("");async function yt(e){var o;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];ye.value=!0;const n=[];try{const s=e.getRoutes(),r=[];for(const h of s)h.path.includes(":")&&!h.path.includes("?")||h.redirect||h.path!=="/:pathMatch(.*)*"&&((o=h.meta)!=null&&o.devInspectorSkip||r.push(h.path));_e.value=r;for(const h of r){Pe.value=h;try{await e.push(h),await new Promise(m=>setTimeout(m,500));const c=await ke();n.push({page:h,count:c})}catch(c){console.warn(`[DevInspector] Failed to scan page ${h}:`,c),n.push({page:h,count:0})}}return n}finally{ye.value=!1,Pe.value=""}}function bt(){we.value=[],be.value=0}const re=g.ref([]);async function Ue(){var h;if(!E.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;re.value=[];const e=typeof window<"u"?window.location.pathname:"/",n=c=>{if(!E.value)return null;for(const[m,d]of Object.entries(E.value.components))if(d.componentName===c||d.componentName.toLowerCase()===c.toLowerCase()||m.toLowerCase().includes(`/${c.toLowerCase()}.vue`))return d;return null},o=(c,m=new Set)=>{const d=[];if(m.has(c.componentName))return d;if(m.add(c.componentName),d.push(...c.elements),c.usedComponents)for(const w of c.usedComponents){const p=n(w);p&&d.push(...o(p,m))}return d},s=[],r=new Set;for(const[c,m]of Object.entries(E.value.components)){const d=c.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let w=!1;if((e==="/"&&c.includes("index")||c.includes("pages/")&&e.match(new RegExp(`^${d}$`)))&&(w=!0),w){const p=o(m);s.push(...p),r.add(m.componentName),m.usedComponents&&m.usedComponents.forEach(a=>r.add(a))}}for(const[c,m]of Object.entries(E.value.components))c.includes("components/")&&!r.has(m.componentName)&&s.push(...m.elements);for(const c of s){if(q.value.has(c.selector))continue;let m=!1,d=c.selector;try{document.querySelector(c.selector)&&(m=!0)}catch{}if(!m&&c.text&&!c.binding){const w=c.text.replace(/\[コメント\]\s*/,""),p=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;p.nextNode();){const a=p.currentNode;if((h=a.textContent)!=null&&h.includes(w)){const l=a.parentElement;if(l){m=!0,d=de(l);break}}}}if(!m&&c.selector.includes(".")){const w=c.selector.match(/^(\w+)\.(.+)$/);if(w){const[,p,a]=w;try{const l=document.querySelector(c.selector);l&&(m=!0,d=de(l))}catch{}}}if(!m&&c.binding){const w=`[data-bind="${c.binding}"]`;try{const p=document.querySelector(w);p&&(m=!0,d=de(p))}catch{}}re.value.push({selector:d,element:c,matched:m})}return console.log(`[DevInspector] Applied analysis: ${re.value.filter(c=>c.matched).length}/${re.value.length} elements matched`),re.value.filter(c=>c.matched).length}function $t(){re.value=[]}function St(e){re.value=re.value.filter(n=>n.selector!==e),q.value.add(e),Ct()}function wt(){try{const e=localStorage.getItem(f);e&&(q.value=new Set(JSON.parse(e)))}catch{}}function Ct(){try{localStorage.setItem(f,JSON.stringify([...q.value]))}catch{}}function It(){q.value.clear(),localStorage.removeItem(f)}function qe(){const e={removed:[...q.value],exportedAt:new Date().toISOString()};return JSON.stringify(e,null,2)}function Tt(e="dev-inspector-changes.json"){const n=qe(),o=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}function Be(){if(!E.value)return[];const e=[],n=new Set;for(const o of Object.values(E.value.components))for(const s of o.elements)s.binding&&!n.has(s.binding)&&(n.add(s.binding),e.push({binding:s.binding,db:s.db,api:s.api,component:o.componentName}));return e.sort((o,s)=>o.db&&!s.db?-1:!o.db&&s.db?1:o.binding.localeCompare(s.binding))}function At(e){const n=Be();if(!e)return n;const o=e.toLowerCase();return n.filter(s=>{var r,h;return s.binding.toLowerCase().includes(o)||((r=s.db)==null?void 0:r.table.toLowerCase().includes(o))||((h=s.db)==null?void 0:h.column.toLowerCase().includes(o))||s.component.toLowerCase().includes(o)})}function Fe(){var n,o;if(!((o=(n=E.value)==null?void 0:n.dbSchema)!=null&&o.tables))return[];const e=[];for(const[s,r]of Object.entries(E.value.dbSchema.tables))for(const[h,c]of Object.entries(r.columns))e.push({table:s,column:h,type:c.type,comment:c.comment,fullName:`${s}.${h}`});return e.sort((s,r)=>s.table!==r.table?s.table.localeCompare(r.table):s.column.localeCompare(r.column))}function Et(e){const n=Fe();if(!e)return n;const o=e.toLowerCase();return n.filter(s=>{var r;return s.table.toLowerCase().includes(o)||s.column.toLowerCase().includes(o)||s.fullName.toLowerCase().includes(o)||((r=s.comment)==null?void 0:r.toLowerCase().includes(o))})}function Pt(){var o,s;const e=[],n=[];if(!((o=E.value)!=null&&o.components))return{pageLoad:e,action:n};for(const r of re.value){if(!r.matched)continue;const h=r.element.component;if(h&&((s=E.value.components[h])!=null&&s.apis))for(const c of E.value.components[h].apis)["onMount","useFetch","useAsyncData"].includes(c.loadTrigger)?e.some(m=>m.endpoint===c.endpoint&&m.method===c.method)||e.push(c):c.loadTrigger==="action"&&(n.some(m=>m.endpoint===c.endpoint&&m.method===c.method)||n.push(c))}return{pageLoad:e,action:n}}function xt(e){var n;if(!((n=E.value)!=null&&n.components))return null;for(const o of Object.values(E.value.components))if(o.apis){for(const s of o.apis)if(s.variable&&e.startsWith(s.variable))return s}return null}function Dt(e){const n=e.tagName.toUpperCase();return n==="INPUT"||n==="SELECT"||n==="TEXTAREA"?"form":n==="BUTTON"||n==="A"&&e.hasAttribute("href")||e.getAttribute("role")==="button"||e.closest("button")||e.closest("a[href]")?"action":"datasource"}const ge=g.ref([]),Me=g.ref(null);function Lt(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",n=[];for(const[o,s]of Object.entries($.value))if(!(s.componentPath&&!s.componentPath.includes(e)&&e!=="/"))try{document.querySelector(o)||n.push(o)}catch{n.push(o)}return ge.value=n,n}function Ot(e,n){const o=$.value[e];if(!o)return;const{[e]:s,...r}=$.value;$.value={...r,[n]:{...o,id:n,updatedAt:new Date().toISOString()}},ge.value=ge.value.filter(h=>h!==e),g.nextTick(()=>ue())}function Nt(e){Me.value=e,U.value=!0,B.value=!1,Ae()}function jt(){const e=ge.value;if(e.length===0)return;const n={...$.value};for(const o of e)delete n[o];$.value=n,ge.value=[],g.nextTick(()=>ue())}function Rt(){Z.value=!Z.value}function kt(e){z.value=e}function _t(){z.value=null}function Ut(){return JSON.stringify({elementConfigs:$.value,screenConfigs:N.value},null,2)}function He(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:$.value,screenConfigs:N.value};return JSON.stringify(e,null,2)}function qt(e="dev-annotations.json"){const n=He(),o=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}function Bt(e){try{const n=JSON.parse(e),o=n.annotations||n.elementConfigs||n;$.value={...$.value,...o},n.screenConfigs&&(N.value={...N.value,...n.screenConfigs})}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function Ft(){$.value={}}function Mt(e="screen-spec-sdd.md"){const n=Kt($.value,N.value,H.value,A.value),o=new Blob([n],{type:"text/markdown;charset=utf-8"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}function Ht(e="screen-spec-client.md"){const n=Yt($.value,N.value,H.value,A.value),o=new Blob([n],{type:"text/markdown;charset=utf-8"}),s=URL.createObjectURL(o),r=document.createElement("a");r.href=s,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}return{isEnabled:I,isAvailable:y,isEditMode:B,isPickMode:U,isInitializing:t,hoveredSelector:J,currentScreenSpec:W,isPanelOpen:X,elementConfigs:$,editingElementId:z,screenConfigs:N,editingScreen:se,getScreenConfig:x,setScreenConfig:i,deleteScreenConfig:te,suggestScreenApis:nt,init:pe,toggle:rt,enable:Le,disable:ct,toggleEditMode:lt,togglePickMode:ut,setHoveredSelector:ft,generateSelector:de,getConfiguredSelectors:dt,setScreenSpec:pt,clearScreenSpec:ht,togglePanel:mt,openPanel:Ne,closePanel:Ae,getElementConfig:gt,setElementConfig:Ee,deleteElementConfig:vt,startEditing:kt,stopEditing:_t,exportConfigs:Ut,exportAsFile:He,downloadAnnotations:qt,downloadSddSpec:Mt,downloadClientSpec:Ht,importConfigs:Bt,clearAllConfigs:Ft,detectSourceBinding:je,autoDetectElementInfo:Re,isScanning:ye,scanProgress:be,scanResults:we,scanCurrentPage:ke,scanAllPages:yt,allPagesRoutes:_e,currentScanPage:Pe,clearScanResults:bt,analysisData:E,loadAnalysisData:fe,getAnalyzedElement:he,getAnalyzedElementsForPage:le,analysisResults:re,applyAnalysisToPage:Ue,clearAnalysisResults:$t,removeAnalysisResult:St,clearHiddenSelectors:It,hiddenAnalysisSelectors:q,analysisFilter:ie,exportChangesForCli:qe,downloadChanges:Tt,getAvailableBindings:Be,searchBindings:At,getSchemaColumns:Fe,searchSchemaColumns:Et,getCurrentPageApis:Pt,getApiSourceForBinding:xt,showNoteHighlights:Z,toggleNoteHighlights:Rt,noteHighlightFilter:ce,detectElementType:Dt,masterDefinitions:H,getMasterDefinition:F,setMasterDefinition:k,deleteMasterDefinition:me,getMastersForTable:Ye,getMasterEntries:Xe,batchDefinitions:A,getBatchDefinition:Qe,setBatchDefinition:et,deleteBatchDefinition:tt,brokenAnnotations:ge,remapTargetId:Me,detectBrokenAnnotations:Lt,remapAnnotation:Ot,startRemap:Nt,deleteBrokenAnnotations:jt,showCrossSearch:P,crossSearchQuery:M,crossSearchMode:R,crossSearchResults:ot,showUnannotatedDetection:ae,unannotatedElements:Q,hoveredUnannotatedSelector:ee,detectUnannotatedElements:st,quickAnnotate:it,showScreenFlow:Y,screenFlowData:at}});function Qt(){return Ke()}exports.useDevInspector=Qt;exports.useDevInspectorStore=Ke;
