"use strict";const i=require("vue"),he=require("pinia");var R=typeof document<"u"?document.currentScript:null;const ge={},me="devInspector:elementConfigs",q=he.defineStore("devInspector",()=>{const A=i.ref({}),m=i.ref(!1),g=i.ref(!1),E=i.ref(!1),b=i.ref(null),C=i.ref(!1),s=i.ref({}),y=i.ref(null),P=i.ref(null),_=i.computed(()=>A.value.storageKey||me),x=i.computed(()=>A.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:R&&R.tagName.toUpperCase()==="SCRIPT"&&R.src||new URL("useDevInspector-BQSnFzrE.cjs",document.baseURI).href}<"u"&&ge?!1:process.env.NODE_ENV==="development");function J(e={}){A.value=e,W()}function W(){try{const e=A.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(_.value),t=n?JSON.parse(n):{};s.value={...e,...t}}else s.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function D(){try{if(typeof window<"u"){const e=JSON.stringify(s.value);localStorage.setItem(_.value,e),console.log("[DevInspector] Saved configs:",Object.keys(s.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}i.watch(s,()=>{i.nextTick(()=>{D()})},{deep:!0});function z(){x.value&&(m.value=!m.value,m.value||(g.value=!1,y.value=null))}function V(){x.value&&(m.value=!0)}function Z(){m.value=!1,g.value=!1,y.value=null}function K(){g.value=!g.value,g.value||(y.value=null),g.value&&(E.value=!1)}function G(){E.value=!E.value,E.value&&(g.value=!1),P.value=null}function H(e){P.value=e}function O(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const r=Array.from(t.classList).filter(u=>!u.startsWith("hover:")&&!u.startsWith("focus:")).slice(0,2);r.length>0&&(o+="."+r.join("."));const a=t.parentElement;if(a){const u=Array.from(a.children).filter(f=>f.tagName===t.tagName);if(u.length>1){const f=u.indexOf(t)+1;o+=`:nth-child(${f})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function Y(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(s.value).filter(n=>{const t=s.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function Q(e){b.value=e}function ee(){b.value=null}function te(){C.value=!C.value}function ne(){C.value=!0}function oe(){C.value=!1}function ae(e){return s.value[e]}function $(e,n){var a;const t=new Date().toISOString(),o=s.value[e],r={...o,...n,id:e,componentPath:n.componentPath||((a=b.value)==null?void 0:a.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};s.value={...s.value,[e]:r},i.nextTick(()=>D())}function re(e){const{[e]:n,...t}=s.value;s.value=t,i.nextTick(()=>D())}function U(e){var p;const n=((p=e.textContent)==null?void 0:p.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const l=o.props||{},h=o.attrs||{};if("modelValue"in l||"model-value"in h)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const l=e.type||"text";e.value;const h=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${l}]${h?` placeholder="${h}"`:""}`,isStatic:!1}}const r=e.dataset.source||e.dataset.field||e.dataset.bind;if(r)return{type:"prop",source:r,isStatic:!1};if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null||e.parentElement&&e.parentElement.children.length>3&&Array.from(e.parentElement.children).filter(l=>l.tagName===e.tagName).length>2)return{type:"api",source:"loop item",isStatic:!1};const u=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/];for(const l of u)if(l.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const c=Array.from(e.childNodes).filter(l=>l.nodeType===Node.TEXT_NODE).map(l=>{var h;return((h=l.textContent)==null?void 0:h.trim())||""}).join("").trim().length>0,d=e.children.length===0,v=Array.from(e.children).every(l=>["SPAN","STRONG","EM","B","I","A","BR"].includes(l.tagName));return c||d&&n.length>0||v?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length>0&&n.length<200?{type:"prop",source:"unknown binding",isStatic:!1}:null}function k(e,n){var r,a,u,f,c;const t=U(e),o={};if(t){o.sourceBinding=t;const d=((r=e.textContent)==null?void 0:r.trim())||"";if(t.isStatic)o.note={type:"info",text:`【固定文言】${d}`};else if(t.type==="v-model"){const v=e.tagName.toUpperCase();if(v==="INPUT"||v==="SELECT"||v==="TEXTAREA"){const p=e.placeholder||"",l=((u=(a=e.closest("label"))==null?void 0:a.textContent)==null?void 0:u.trim())||e.getAttribute("aria-label")||((c=(f=document.querySelector(`label[for="${e.id}"]`))==null?void 0:f.textContent)==null?void 0:c.trim())||"";o.note={type:"todo",text:`【フォーム要素】${l||p||v.toLowerCase()}`}}}else t.type==="api"&&(o.note={type:"question",text:`【動的データ】${d.substring(0,100)}${d.length>100?"...":""}`})}return o}const T=i.ref(!1),I=i.ref(0),w=i.ref([]);async function j(){T.value=!0,I.value=0,w.value=[];try{const e=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),n=document.querySelectorAll(e),t=[];n.forEach(f=>{var M;const c=f;if(c.closest("[data-dev-inspector]"))return;const d=window.getComputedStyle(c);if(d.display==="none"||d.visibility==="hidden"||d.opacity==="0")return;const v=O(c);if(s.value[v])return;const p=c.tagName.toUpperCase(),l=((M=c.textContent)==null?void 0:M.trim())||"";if(p==="INPUT"||p==="SELECT"||p==="TEXTAREA"){t.push(c);return}if(l.length>300||l.length===0||p==="DIV"&&(Array.from(c.childNodes).filter(S=>S.nodeType===Node.TEXT_NODE).map(S=>{var X;return((X=S.textContent)==null?void 0:X.trim())||""}).join("").trim().length===0||c.children.length>3))return;const h=Array.from(c.childNodes).some(N=>{var S;return N.nodeType===Node.TEXT_NODE&&(((S=N.textContent)==null?void 0:S.trim())||"").length>0}),ve=!Array.from(c.children).some(N=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(N.tagName));(h||c.children.length===0&&l.length>0||ve)&&t.push(c)});const o=t.length;let r=0,a=0;const u=20;for(let f=0;f<t.length;f+=u){const c=t.slice(f,f+u);for(const d of c){const v=O(d),p=k(d,v);p.sourceBinding&&(w.value.push({selector:v,element:d,detected:p}),$(v,p),a++),r++,I.value=Math.round(r/o*100)}await new Promise(d=>setTimeout(d,10))}return a}finally{T.value=!1,I.value=100}}const B=i.ref([]),L=i.ref("");async function se(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];T.value=!0;const n=[];try{const o=e.getRoutes(),r=[];for(const a of o)a.path.includes(":")&&!a.path.includes("?")||a.redirect||a.path!=="/:pathMatch(.*)*"&&((t=a.meta)!=null&&t.devInspectorSkip||r.push(a.path));B.value=r;for(const a of r){L.value=a;try{await e.push(a),await new Promise(f=>setTimeout(f,500));const u=await j();n.push({page:a,count:u})}catch(u){console.warn(`[DevInspector] Failed to scan page ${a}:`,u),n.push({page:a,count:0})}}return n}finally{T.value=!1,L.value=""}}function ie(){w.value=[],I.value=0}function ce(e){y.value=e}function le(){y.value=null}function ue(){return JSON.stringify(s.value,null,2)}function F(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:s.value};return JSON.stringify(e,null,2)}function fe(e="dev-annotations.json"){const n=F(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function de(e){try{const n=JSON.parse(e),t=n.annotations||n;s.value={...s.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function pe(){s.value={}}return{isEnabled:m,isAvailable:x,isEditMode:g,isPickMode:E,hoveredSelector:P,currentScreenSpec:b,isPanelOpen:C,elementConfigs:s,editingElementId:y,init:J,toggle:z,enable:V,disable:Z,toggleEditMode:K,togglePickMode:G,setHoveredSelector:H,generateSelector:O,getConfiguredSelectors:Y,setScreenSpec:Q,clearScreenSpec:ee,togglePanel:te,openPanel:ne,closePanel:oe,getElementConfig:ae,setElementConfig:$,deleteElementConfig:re,startEditing:ce,stopEditing:le,exportConfigs:ue,exportAsFile:F,downloadAnnotations:fe,importConfigs:de,clearAllConfigs:pe,detectSourceBinding:U,autoDetectElementInfo:k,isScanning:T,scanProgress:I,scanResults:w,scanCurrentPage:j,scanAllPages:se,allPagesRoutes:B,currentScanPage:L,clearScanResults:ie}});function ye(){return q()}exports.useDevInspector=ye;exports.useDevInspectorStore=q;
