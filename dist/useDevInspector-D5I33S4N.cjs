"use strict";const i=require("vue"),Ue=require("pinia");var J=typeof document<"u"?document.currentScript:null;const _e={},Be="devInspector:elementConfigs",oe=Ue.defineStore("devInspector",()=>{const L=i.ref({}),N=i.ref(!1),w=i.ref(!1),P=i.ref(!1),B=i.ref(!1),R=i.ref(null),O=i.ref(!1),d=i.ref({}),T=i.ref(null),F=i.ref(null),H=i.computed(()=>L.value.storageKey||Be),m=i.ref(null),se=i.ref("all"),A=i.ref(new Set),q="devInspector:hiddenAnalysisSelectors",j=i.computed(()=>L.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:J&&J.tagName.toUpperCase()==="SCRIPT"&&J.src||new URL("useDevInspector-D5I33S4N.cjs",document.baseURI).href}<"u"&&_e?!1:process.env.NODE_ENV==="development"),M=i.ref(!1);function ae(e={}){L.value=e,re(),Te(),e.analysisData&&(m.value=e.analysisData);const n=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&j.value&&W(n)}async function W(e){var n;try{const t=await fetch(e);if(t.ok)return m.value=await t.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((n=m.value)==null?void 0:n.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function le(e){if(!m.value)return null;for(const n of Object.values(m.value.components)){const t=n.elements.find(o=>o.selector===e);if(t)return t}return null}function ce(e){if(!m.value)return[];const n=[];for(const[t,o]of Object.entries(m.value.components))(!e||t.includes(e))&&n.push(...o.elements);return n}function re(){try{const e=L.value.initialAnnotations||{};if(typeof window<"u"){const n=localStorage.getItem(H.value),t=n?JSON.parse(n):{};d.value={...e,...t}}else d.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function k(){try{if(typeof window<"u"){const e=JSON.stringify(d.value);localStorage.setItem(H.value,e),console.log("[DevInspector] Saved configs:",Object.keys(d.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}i.watch(d,()=>{i.nextTick(()=>{k()})},{deep:!0});async function ie(){j.value&&(N.value?(N.value=!1,w.value=!1,T.value=null):await X())}async function X(){if(!j.value)return;if(m.value&&!M.value&&L.value.autoApplyAnalysis!==!1){B.value=!0,N.value=!0;try{await new Promise(n=>setTimeout(n,300)),Q(),M.value=!0}finally{B.value=!1}}else N.value=!0}function ue(){N.value=!1,w.value=!1,T.value=null}function de(){w.value=!w.value,w.value||(T.value=null),w.value&&(P.value=!1)}function fe(){P.value=!P.value,P.value&&(w.value=!1),F.value=null}function pe(e){F.value=e}function I(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const n=[];let t=e;for(;t&&t!==document.body;){let o=t.tagName.toLowerCase();if(t.id){o=`#${t.id}`,n.unshift(o);break}const a=Array.from(t.classList).filter(s=>!s.startsWith("hover:")&&!s.startsWith("focus:")).slice(0,2);a.length>0&&(o+="."+a.join("."));const l=t.parentElement;if(l){const s=Array.from(l.children).filter(c=>c.tagName===t.tagName);if(s.length>1){const c=s.indexOf(t)+1;o+=`:nth-child(${c})`}}n.unshift(o),t=t.parentElement}return n.join(" > ")}function me(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(d.value).filter(n=>{const t=d.value[n];return t?(n.includes(">")||n.startsWith("#")||n.startsWith("[")||n.startsWith("."))&&(!t.componentPath||t.componentPath.includes(e)||e==="/"):!1})}function ve(e){R.value=e}function he(){R.value=null}function ge(){O.value=!O.value}function ye(){O.value=!0}function Se(){O.value=!1}function be(e){return d.value[e]}function Z(e,n){var l;const t=new Date().toISOString(),o=d.value[e],a={...o,...n,id:e,componentPath:n.componentPath||((l=R.value)==null?void 0:l.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||t,updatedAt:t};d.value={...d.value,[e]:a},i.nextTick(()=>k())}function Ce(e){const{[e]:n,...t}=d.value;d.value=t,i.nextTick(()=>k())}function K(e){var _;const n=((_=e.textContent)==null?void 0:_.trim())||"",t=e.tagName.toUpperCase();if(!n&&t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const v=o.props||{},g=o.attrs||{};if("modelValue"in v||"model-value"in g)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(t==="INPUT"||t==="SELECT"||t==="TEXTAREA"){const v=e.type||"text",g=e.placeholder||"";return{type:"v-model",source:`${t.toLowerCase()}[type=${v}]${g?` placeholder="${g}"`:""}`,isStatic:!1}}const a=e.dataset.source||e.dataset.field||e.dataset.bind;if(a)return{type:"prop",source:a,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const l=e.closest('ul, ol, [role="list"]');if(l&&l.children.length>1)return{type:"api",source:"list item",isStatic:!1};const s=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const v of s){const g=e.closest(v);if(g){const y=g.parentElement;if(y&&Array.from(y.children).filter(E=>E!==g&&E.className===g.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const v=e.parentElement,y=Array.from(v.children).filter(b=>b.tagName===e.tagName);if(y.length>=2&&y.filter(E=>E.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const f=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const v of f)if(v.test(n))return{type:"api",source:"dynamic data pattern",isStatic:!1};const u=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const v of u)if(v.test(n))return{type:"api",source:"name pattern",isStatic:!1};const p=["LABEL","TH","LEGEND","FIGCAPTION"].includes(t),S=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(v=>v.test(n)),x=t==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return p||S||x&&n.length<20?{type:"static",source:n.substring(0,50)+(n.length>50?"...":""),isStatic:!0}:n.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(n)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:n.length>0&&n.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function G(e,n){var a,l,s,c,f;const t=K(e),o={};if(t){o.sourceBinding=t;const u=((a=e.textContent)==null?void 0:a.trim())||"";if(t.isStatic)o.note={type:"info",text:`【固定文言】${u}`};else if(t.type==="v-model"){const r=e.tagName.toUpperCase();if(r==="INPUT"||r==="SELECT"||r==="TEXTAREA"){const p=e.placeholder||"",h=((s=(l=e.closest("label"))==null?void 0:l.textContent)==null?void 0:s.trim())||e.getAttribute("aria-label")||((f=(c=document.querySelector(`label[for="${e.id}"]`))==null?void 0:c.textContent)==null?void 0:f.trim())||"";o.note={type:"todo",text:`【フォーム要素】${h||p||r.toLowerCase()}`}}}else t.type==="api"&&(o.note={type:"question",text:`【動的データ】${u.substring(0,100)}${u.length>100?"...":""}`})}return o}const $=i.ref(!1),D=i.ref(0),U=i.ref([]);async function V(e={}){$.value=!0,D.value=0,U.value=[];const{rescan:n=!1}=e;if(n){const t=typeof window<"u"?window.location.pathname:"/",o=Object.keys(d.value).filter(a=>{const l=d.value[a];return!l.componentPath||l.componentPath.includes(t)});for(const a of o)delete d.value[a];i.nextTick(()=>k())}try{const t=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),o=document.querySelectorAll(t),a=[];o.forEach(u=>{var g;const r=u;if(r.closest("[data-dev-inspector]"))return;const p=window.getComputedStyle(r);if(p.display==="none"||p.visibility==="hidden"||p.opacity==="0")return;const h=I(r);if(d.value[h])return;const S=r.tagName.toUpperCase(),x=((g=r.textContent)==null?void 0:g.trim())||"";if(S==="INPUT"||S==="SELECT"||S==="TEXTAREA"){a.push(r);return}if(x.length>300||x.length===0||S==="DIV"&&(Array.from(r.childNodes).filter(b=>b.nodeType===Node.TEXT_NODE).map(b=>{var E;return((E=b.textContent)==null?void 0:E.trim())||""}).join("").trim().length===0||r.children.length>3))return;const _=Array.from(r.childNodes).some(y=>{var b;return y.nodeType===Node.TEXT_NODE&&(((b=y.textContent)==null?void 0:b.trim())||"").length>0}),v=!Array.from(r.children).some(y=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(y.tagName));(_||r.children.length===0&&x.length>0||v)&&a.push(r)});const l=a.length;let s=0,c=0;const f=20;for(let u=0;u<a.length;u+=f){const r=a.slice(u,u+f);for(const p of r){const h=I(p),S=G(p,h);S.sourceBinding&&(U.value.push({selector:h,element:p,detected:S}),Z(h,S),c++),s++,D.value=Math.round(s/l*100)}await new Promise(p=>setTimeout(p,10))}return c}finally{$.value=!1,D.value=100}}const Y=i.ref([]),z=i.ref("");async function we(e){var t;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];$.value=!0;const n=[];try{const o=e.getRoutes(),a=[];for(const l of o)l.path.includes(":")&&!l.path.includes("?")||l.redirect||l.path!=="/:pathMatch(.*)*"&&((t=l.meta)!=null&&t.devInspectorSkip||a.push(l.path));Y.value=a;for(const l of a){z.value=l;try{await e.push(l),await new Promise(c=>setTimeout(c,500));const s=await V();n.push({page:l,count:s})}catch(s){console.warn(`[DevInspector] Failed to scan page ${l}:`,s),n.push({page:l,count:0})}}return n}finally{$.value=!1,z.value=""}}function Ae(){U.value=[],D.value=0}const C=i.ref([]);async function Q(){var l;if(!m.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;C.value=[];const e=typeof window<"u"?window.location.pathname:"/",n=s=>{if(!m.value)return null;for(const[c,f]of Object.entries(m.value.components))if(f.componentName===s||f.componentName.toLowerCase()===s.toLowerCase()||c.toLowerCase().includes(`/${s.toLowerCase()}.vue`))return f;return null},t=(s,c=new Set)=>{const f=[];if(c.has(s.componentName))return f;if(c.add(s.componentName),f.push(...s.elements),s.usedComponents)for(const u of s.usedComponents){const r=n(u);r&&f.push(...t(r,c))}return f},o=[],a=new Set;for(const[s,c]of Object.entries(m.value.components)){const f=s.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let u=!1;if((e==="/"&&s.includes("index")||s.includes("pages/")&&e.match(new RegExp(`^${f}$`)))&&(u=!0),u){const r=t(c);o.push(...r),a.add(c.componentName),c.usedComponents&&c.usedComponents.forEach(p=>a.add(p))}}for(const[s,c]of Object.entries(m.value.components))s.includes("components/")&&!a.has(c.componentName)&&o.push(...c.elements);for(const s of o){if(A.value.has(s.selector))continue;let c=!1,f=s.selector;try{document.querySelector(s.selector)&&(c=!0)}catch{}if(!c&&s.type==="static"&&s.text){const u=s.text.replace(/\[コメント\]\s*/,""),r=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;r.nextNode();){const p=r.currentNode;if((l=p.textContent)!=null&&l.includes(u)){const h=p.parentElement;if(h){c=!0,f=I(h);break}}}}if(!c&&s.selector.includes(".")){const u=s.selector.match(/^(\w+)\.(.+)$/);if(u){const[,r,p]=u;try{const h=document.querySelector(s.selector);h&&(c=!0,f=I(h))}catch{}}}if(!c&&s.type==="data"&&s.binding){const u=`[data-bind="${s.binding}"]`;try{const r=document.querySelector(u);r&&(c=!0,f=I(r))}catch{}}C.value.push({selector:f,element:s,matched:c})}return console.log(`[DevInspector] Applied analysis: ${C.value.filter(s=>s.matched).length}/${C.value.length} elements matched`),C.value.filter(s=>s.matched).length}function Ee(){C.value=[]}function Ne(e){C.value=C.value.filter(n=>n.selector!==e),A.value.add(e),Ie()}function Te(){try{const e=localStorage.getItem(q);e&&(A.value=new Set(JSON.parse(e)))}catch{}}function Ie(){try{localStorage.setItem(q,JSON.stringify([...A.value]))}catch{}}function Le(){A.value.clear(),localStorage.removeItem(q)}function ee(){const e={removed:[...A.value],exportedAt:new Date().toISOString()};return JSON.stringify(e,null,2)}function Pe(e="dev-inspector-changes.json"){const n=ee(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function te(){if(!m.value)return[];const e=[],n=new Set;for(const t of Object.values(m.value.components))for(const o of t.elements)o.binding&&!n.has(o.binding)&&(n.add(o.binding),e.push({binding:o.binding,db:o.db,api:o.api,component:t.componentName}));return e.sort((t,o)=>t.db&&!o.db?-1:!t.db&&o.db?1:t.binding.localeCompare(o.binding))}function Oe(e){const n=te();if(!e)return n;const t=e.toLowerCase();return n.filter(o=>{var a,l;return o.binding.toLowerCase().includes(t)||((a=o.db)==null?void 0:a.table.toLowerCase().includes(t))||((l=o.db)==null?void 0:l.column.toLowerCase().includes(t))||o.component.toLowerCase().includes(t)})}function $e(e){T.value=e}function De(){T.value=null}function xe(){return JSON.stringify(d.value,null,2)}function ne(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:d.value};return JSON.stringify(e,null,2)}function Re(e="dev-annotations.json"){const n=ne(),t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function je(e){try{const n=JSON.parse(e),t=n.annotations||n;d.value={...d.value,...t}}catch(n){throw console.error("[DevInspector] Failed to import configs:",n),new Error("Invalid JSON format")}}function ke(){d.value={}}return{isEnabled:N,isAvailable:j,isEditMode:w,isPickMode:P,isInitializing:B,hoveredSelector:F,currentScreenSpec:R,isPanelOpen:O,elementConfigs:d,editingElementId:T,init:ae,toggle:ie,enable:X,disable:ue,toggleEditMode:de,togglePickMode:fe,setHoveredSelector:pe,generateSelector:I,getConfiguredSelectors:me,setScreenSpec:ve,clearScreenSpec:he,togglePanel:ge,openPanel:ye,closePanel:Se,getElementConfig:be,setElementConfig:Z,deleteElementConfig:Ce,startEditing:$e,stopEditing:De,exportConfigs:xe,exportAsFile:ne,downloadAnnotations:Re,importConfigs:je,clearAllConfigs:ke,detectSourceBinding:K,autoDetectElementInfo:G,isScanning:$,scanProgress:D,scanResults:U,scanCurrentPage:V,scanAllPages:we,allPagesRoutes:Y,currentScanPage:z,clearScanResults:Ae,analysisData:m,loadAnalysisData:W,getAnalyzedElement:le,getAnalyzedElementsForPage:ce,analysisResults:C,applyAnalysisToPage:Q,clearAnalysisResults:Ee,removeAnalysisResult:Ne,clearHiddenSelectors:Le,hiddenAnalysisSelectors:A,analysisFilter:se,exportChangesForCli:ee,downloadChanges:Pe,getAvailableBindings:te,searchBindings:Oe}});function Fe(){return oe()}exports.useDevInspector=Fe;exports.useDevInspectorStore=oe;
