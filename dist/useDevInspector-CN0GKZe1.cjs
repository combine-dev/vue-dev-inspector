"use strict";const p=require("vue"),Rt=require("pinia");var we=typeof document<"u"?document.currentScript:null;function E(h){return h.replace(/\|/g,"\\|").replace(/\n/g," ")}function ke(h){const I={};for(const[O,a]of Object.entries(h)){const F=a.pagePath||"/";I[F]||(I[F]=[]),I[F].push({selector:O,config:a})}return I}function Ut(h){var I,O,a,F,B,q;return h.elementType==="form"?"入力":h.elementType==="action"?((I=h.actionInfo)==null?void 0:I.type)==="navigate"?"リンク":(((O=h.actionInfo)==null?void 0:O.type)==="modal","ボタン"):h.fieldInfo||((a=h.note)==null?void 0:a.displayType)==="db_direct"||((F=h.note)==null?void 0:F.displayType)==="db_formatted"?"表示":((B=h.note)==null?void 0:B.displayType)==="calculated"?"表示(計算)":((q=h.note)==null?void 0:q.displayType)==="static"?"表示(固定)":"表示"}function Ft(h){var I,O,a,F;return(I=h.note)!=null&&I.text?h.note.text:(O=h.fieldInfo)!=null&&O.description?h.fieldInfo.description:h.fieldInfo?`${h.fieldInfo.table}.${h.fieldInfo.column}`:(a=h.actionInfo)!=null&&a.description?h.actionInfo.description:(F=h.formInfo)!=null&&F.description?h.formInfo.description:h.id}function qt(h){var O,a;const I=[];if(h.fieldInfo&&I.push(`DBの${h.fieldInfo.table}.${h.fieldInfo.column}を表示`),((O=h.note)==null?void 0:O.displayType)==="calculated"&&h.note.calcDescription&&I.push(h.note.calcDescription),h.actionInfo){const B={navigate:"画面遷移",api:"API呼び出し",modal:"モーダル表示",emit:"イベント発火",function:"関数実行"}[h.actionInfo.type]||h.actionInfo.type;I.push(`${B}${h.actionInfo.target?`: ${h.actionInfo.target}`:""}`)}return(a=h.formInfo)!=null&&a.description&&I.push(h.formInfo.description),I.join(" / ")}function _t(h,I,O){var T,W,D,j,U,K,A,re,X,z,ee,V,Y,te;const a=[];a.push("# 画面仕様（SDD）"),a.push("");const F=ke(h),B=new Set([...Object.keys(I),...Object.keys(F)]);for(const x of B){const w=I[x],J=F[x]||[];if(a.push(`## ${x} — ${(w==null?void 0:w.name)||x}`),a.push(""),a.push("### 画面情報"),w!=null&&w.auth){const C=(T=w.auth.roles)!=null&&T.length?` (${w.auth.roles.join(", ")})`:"";a.push(`- 認証: ${w.auth.required?"必須":"不要"}${C}`)}w!=null&&w.componentPath&&a.push(`- コンポーネント: ${w.componentPath}`),w!=null&&w.description&&a.push(`- 概要: ${w.description}`),a.push("");const G=(w==null?void 0:w.apis)||[];if(G.length>0){a.push("### API"),a.push("| メソッド | エンドポイント | タイミング | 説明 |"),a.push("|---------|-------------|----------|------|");for(const C of G){const k=C.loadTiming||"";a.push(`| ${C.method} | ${E(C.endpoint)} | ${k} | ${E(C.description||"")} |`)}a.push("")}const ne=J.filter(C=>C.config.elementType==="datasource"||!C.config.elementType&&C.config.fieldInfo),Z=J.filter(C=>C.config.elementType==="action"||!C.config.elementType&&C.config.actionInfo&&!C.config.fieldInfo),ce=J.filter(C=>C.config.elementType==="form"||!C.config.elementType&&C.config.formInfo&&!C.config.fieldInfo&&!C.config.actionInfo),de=J.filter(C=>!ne.includes(C)&&!Z.includes(C)&&!ce.includes(C));if(ne.length>0||de.length>0){a.push("### データソース"),a.push("| セレクタ | DB | 型 | NULL時 | 表示形式 | 計算ロジック |"),a.push("|---------|-----|-----|--------|---------|------------|");for(const{selector:C,config:k}of[...ne,...de]){const N=k.fieldInfo,oe=N?`${N.table}.${N.column}`:"",_=(N==null?void 0:N.type)||"",se=((W=k.note)==null?void 0:W.nullDisplay)||"-",ae=((D=k.note)==null?void 0:D.displayFormat)||"";let ie="";((j=k.note)==null?void 0:j.displayType)==="calculated"&&k.note.calcDescription&&(ie=k.note.calcDescription),(U=k.note)!=null&&U.storedCalc&&k.note.storedCalcLogic&&(ie=k.note.storedCalcLogic),a.push(`| ${E(C)} | ${E(oe)} | ${E(_)} | ${E(se)} | ${E(ae)} | ${E(ie)} |`)}a.push("")}if(Z.length>0){a.push("### アクション"),a.push("| セレクタ | タイプ | 遷移先/API | 説明 |"),a.push("|---------|--------|-----------|------|");for(const{selector:C,config:k}of Z){const N=k.actionInfo,oe=(N==null?void 0:N.type)||"";let _=(N==null?void 0:N.target)||"";N!=null&&N.method&&(_=`${N.method} ${_}`);const se=(N==null?void 0:N.description)||((K=k.note)==null?void 0:K.text)||"";a.push(`| ${E(C)} | ${E(oe)} | ${E(_)} | ${E(se)} |`)}a.push("")}if(ce.length>0){a.push("### フォーム"),a.push("| セレクタ | DB | 入力タイプ | 必須 | バリデーション | 初期値 |"),a.push("|---------|-----|----------|------|--------------|--------|");for(const{selector:C,config:k}of ce){const N=k.fieldInfo,oe=N?`${N.table}.${N.column}`:"",_=((A=k.formInfo)==null?void 0:A.inputType)||"",se=(re=k.formInfo)!=null&&re.required?"Yes":"",ae=[...((X=k.formInfo)==null?void 0:X.validation)||[],...(N==null?void 0:N.validation)||[]].join(", "),ie=((z=k.formInfo)==null?void 0:z.defaultValue)||"";a.push(`| ${E(C)} | ${E(oe)} | ${E(_)} | ${se} | ${E(ae)} | ${E(ie)} |`)}a.push("")}a.push("---"),a.push("")}const q=[];for(const[x,w]of Object.entries(h))if(((ee=w.actionInfo)==null?void 0:ee.type)==="navigate"&&w.actionInfo.target){const J=w.pagePath||"/";q.push({from:J,to:w.actionInfo.target,trigger:w.actionInfo.description||((V=w.note)==null?void 0:V.text)||x})}if(q.length>0){a.push("## 画面フロー"),a.push("| 遷移元 | 遷移先 | トリガー |"),a.push("|--------|--------|---------|");for(const x of q){const w=((Y=I[x.from])==null?void 0:Y.name)||x.from,J=((te=I[x.to])==null?void 0:te.name)||x.to;a.push(`| ${E(w)} (${E(x.from)}) | ${E(J)} (${E(x.to)}) | ${E(x.trigger)} |`)}a.push("")}const g=Object.values(O);if(g.length>0){a.push("## マスタ定義"),a.push("");for(const x of g){a.push(`### ${x.id} — ${x.name} (${x.columnType||""})`),x.description&&(a.push(x.description),a.push("")),a.push("| 値 | ラベル | 説明 |"),a.push("|----|--------|------|");for(const w of x.entries)a.push(`| ${E(w.value)} | ${E(w.label)} | ${E(w.description||"")} |`);a.push("")}}return a.join(`
`)}function Bt(h,I,O){var q;const a=[];a.push("# 画面仕様書"),a.push("");const F=ke(h),B=new Set([...Object.keys(I),...Object.keys(F)]);for(const g of B){const T=I[g],W=F[g]||[];if(a.push(`## ${(T==null?void 0:T.name)||g}`),a.push(`**URL:** ${g}`),a.push(""),T!=null&&T.description&&(a.push("### 概要"),a.push(T.description),a.push("")),T!=null&&T.auth){if(a.push("### 認証"),a.push(`- ${T.auth.required?"ログイン必須":"ログイン不要"}`),(q=T.auth.roles)!=null&&q.length){const j=T.auth.roles.map(U=>({admin:"管理者",manager:"マネージャー",user:"ユーザー"})[U]||U);a.push(`- 権限: ${j.join("、")}`)}a.push("")}W.length>0&&(a.push("### 画面項目"),a.push("| No | 項目名 | 種別 | 説明 | 必須 | 備考 |"),a.push("|----|--------|------|------|------|------|"),W.forEach(({config:j},U)=>{var ee,V,Y,te;const K=Ft(j),A=Ut(j),re=qt(j),X=(ee=j.formInfo)!=null&&ee.required?"必須":"",z=[];(V=j.note)!=null&&V.condition&&z.push(j.note.condition),(Y=j.note)!=null&&Y.unit&&z.push(`単位: ${j.note.unit}`),(te=j.note)!=null&&te.nullDisplay&&j.note.nullDisplay!=="-"&&z.push(`空欄時: ${j.note.nullDisplay}`),a.push(`| ${U+1} | ${E(K)} | ${A} | ${E(re)} | ${X} | ${E(z.join(" / "))} |`)}),a.push(""));const D=(T==null?void 0:T.apis)||[];if(D.length>0){a.push("### 使用API"),a.push("| メソッド | エンドポイント | 説明 |"),a.push("|---------|-------------|------|");for(const j of D)a.push(`| ${j.method} | ${E(j.endpoint)} | ${E(j.description||"")} |`);a.push("")}T!=null&&T.notes&&(a.push("### 備考"),a.push(T.notes),a.push("")),a.push("---"),a.push("")}return a.join(`
`)}const Mt={},Jt="devInspector:elementConfigs",Oe="devInspector:screenConfigs",je="devInspector:masterDefinitions",Re=Rt.defineStore("devInspector",()=>{const h=p.ref({}),I=p.ref(!1),O=p.ref(!1),a=p.ref(!1),F=p.ref(!1),B=p.ref(null),q=p.ref(!1),g=p.ref({}),T=p.ref(null),W=p.ref(null),D=p.ref({}),j=p.ref(!1),U=p.ref({}),K=p.computed(()=>h.value.storageKey||Jt),A=p.ref(null),re=p.ref("all"),X=p.ref(!0),z=p.ref("all"),ee=p.ref(!1),V=p.ref(""),Y=p.ref("column"),te=p.ref(!1),x=p.ref([]),w=p.ref(null),J=p.ref(!1),G=p.ref(new Set),ne="devInspector:hiddenAnalysisSelectors",Z=p.computed(()=>h.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:we&&we.tagName.toUpperCase()==="SCRIPT"&&we.src||new URL("useDevInspector-CN0GKZe1.cjs",document.baseURI).href}<"u"&&Mt?!1:process.env.NODE_ENV==="development"),ce=p.ref(!1);function de(e={}){h.value=e,oe(),se(),qe(),pt(),e.analysisData&&(A.value=e.analysisData);const t=e.analysisDataUrl??"/dev-inspector-analysis.json";e.autoLoadAnalysis!==!1&&Z.value&&C(t)}async function C(e){var t;try{const n=await fetch(e);if(n.ok)return A.value=await n.json(),console.log("[DevInspector] Analysis data loaded:",Object.keys(((t=A.value)==null?void 0:t.components)||{}).length,"components"),!0}catch{console.debug("[DevInspector] Analysis data not found at",e)}return!1}function k(e){if(!A.value)return null;for(const t of Object.values(A.value.components)){const n=t.elements.find(o=>o.selector===e);if(n)return n}return null}function N(e){if(!A.value)return[];const t=[];for(const[n,o]of Object.entries(A.value.components))(!e||n.includes(e))&&t.push(...o.elements);return t}function oe(){try{const e=h.value.initialAnnotations||{};if(typeof window<"u"){const t=localStorage.getItem(K.value),n=t?JSON.parse(t):{};g.value={...e,...n}}else g.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function _(){try{if(typeof window<"u"){const e=JSON.stringify(g.value);localStorage.setItem(K.value,e),console.log("[DevInspector] Saved configs:",Object.keys(g.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}p.watch(g,()=>{p.nextTick(()=>{_()})},{deep:!0});function se(){try{if(typeof window<"u"){const e=localStorage.getItem(Oe);e&&(D.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load screen configs:",e)}}function ae(){try{if(typeof window<"u"){const e=JSON.stringify(D.value);localStorage.setItem(Oe,e)}}catch(e){console.error("[DevInspector] Failed to save screen configs:",e)}}p.watch(D,()=>{p.nextTick(()=>{ae()})},{deep:!0});function ie(e){const t=e||(typeof window<"u"?window.location.pathname:"/");return D.value[t]}function Ue(e){D.value={...D.value,[e.path]:e},p.nextTick(()=>ae())}function Fe(e){const{[e]:t,...n}=D.value;D.value=n,p.nextTick(()=>ae())}function qe(){try{if(typeof window<"u"){const e=localStorage.getItem(je);e&&(U.value=JSON.parse(e))}}catch(e){console.error("[DevInspector] Failed to load master definitions:",e)}}function ge(){try{typeof window<"u"&&localStorage.setItem(je,JSON.stringify(U.value))}catch(e){console.error("[DevInspector] Failed to save master definitions:",e)}}p.watch(U,()=>{p.nextTick(()=>{ge()})},{deep:!0});function _e(e){return U.value[e]}function Be(e){U.value={...U.value,[e.id]:{...e,updatedAt:new Date().toISOString()}},p.nextTick(()=>ge())}function Me(e){const{[e]:t,...n}=U.value;U.value=n,p.nextTick(()=>ge())}function Je(e){return Object.values(U.value).filter(t=>t.table===e)}function Ge(e){var t;return((t=U.value[e])==null?void 0:t.entries)||[]}function He(){var o,r,u,c,f;const e=[],t=new Set,n={};for(const l of Object.values(g.value)){const v=l.fieldInfoList||(l.fieldInfo?[l.fieldInfo]:[]),i=((o=l.sourceBinding)==null?void 0:o.type)==="v-model";for(const s of v)s.table&&(n[s.table]||(n[s.table]={read:!1,write:!1,isList:!1}),n[s.table].read=!0,i&&(n[s.table].write=!0));if(((r=l.note)==null?void 0:r.displayType)==="db_direct"||((u=l.note)==null?void 0:u.displayType)==="db_formatted")for(const s of v)s.table&&n[s.table]&&(l.id.includes("tbody")||l.id.includes(" tr")||l.id.includes(" td"))&&(n[s.table].isList=!0);if(((c=l.actionInfo)==null?void 0:c.type)==="api"&&l.actionInfo.target){const s=`${l.actionInfo.method||"GET"}:${l.actionInfo.target}`;t.has(s)||(t.add(s),e.push({method:l.actionInfo.method||"GET",endpoint:l.actionInfo.target,description:l.actionInfo.description||"",loadTiming:"action"}))}}for(const[l,v]of Object.entries(n)){if(v.read){const i=v.isList?`/api/${l}`:`/api/${l}/:id`,s=`GET:${i}`;t.has(s)||(t.add(s),e.push({method:"GET",endpoint:i,description:v.isList?`${l} 一覧取得`:`${l} 詳細取得`,loadTiming:"onMount"}))}if(v.write){const i=`/api/${l}/:id`,s=`PUT:${i}`;t.has(s)||(t.add(s),e.push({method:"PUT",endpoint:i,description:`${l} 更新`,loadTiming:"action"}))}}if((f=A.value)!=null&&f.components){const l=typeof window<"u"?window.location.pathname:"/";for(const[v,i]of Object.entries(A.value.components)){const s=v.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let d=!1;if(l==="/"&&v.includes("index"))d=!0;else if(v.includes("pages/"))try{d=!!l.match(new RegExp(`^${s}$`))}catch{}if(d&&i.apis)for(const m of i.apis){if(!m.endpoint)continue;const P=`${m.method}:${m.endpoint}`;t.has(P)||(t.add(P),e.push({method:m.method,endpoint:m.endpoint,description:m.variable?`→ ${m.variable}`:"",loadTiming:["onMount","useFetch","useAsyncData"].includes(m.loadTrigger)?"onMount":"action"}))}}}return e}const We=p.computed(()=>{var o,r,u,c,f,l,v,i,s,d,m,P,$,b,S;const e=V.value.trim().toLowerCase();if(!e)return[];const t=Y.value,n=[];for(const[L,y]of Object.entries(g.value)){const R=y.pagePath||"/",be=D.value[R],he=(be==null?void 0:be.name)||R;if(t==="column"){const Se=(o=y.fieldInfoList)!=null&&o.length?y.fieldInfoList:y.fieldInfo?[y.fieldInfo]:[];for(const M of Se)(`${M.table}.${M.column}`.toLowerCase().includes(e)||M.table.toLowerCase().includes(e)||M.column.toLowerCase().includes(e))&&n.push({pagePath:R,pageName:he,selector:L,elementType:y.elementType,matchedField:`${M.table}.${M.column}`,matchContext:`${M.type||""} ${M.description||""}`.trim()});const me=((r=y.note)==null?void 0:r.calcSources)||[],kt=((u=y.note)==null?void 0:u.storedCalcSources)||[];for(const M of[...me,...kt])M.toLowerCase().includes(e)&&n.push({pagePath:R,pageName:he,selector:L,elementType:y.elementType,matchedField:M,matchContext:((c=y.note)==null?void 0:c.calcDescription)||((f=y.note)==null?void 0:f.storedCalcLogic)||"参照元"})}else if(t==="api")(v=(l=y.actionInfo)==null?void 0:l.target)!=null&&v.toLowerCase().includes(e)&&n.push({pagePath:R,pageName:he,selector:L,elementType:y.elementType,matchedField:`${y.actionInfo.method||""} ${y.actionInfo.target}`.trim(),matchContext:y.actionInfo.description||y.actionInfo.type});else if(t==="text"){const Se=[(i=y.note)==null?void 0:i.text,(s=y.note)==null?void 0:s.calcDescription,(d=y.note)==null?void 0:d.formatDescription,(m=y.note)==null?void 0:m.condition,(P=y.actionInfo)==null?void 0:P.description,($=y.formInfo)==null?void 0:$.description,L].filter(Boolean);for(const me of Se)if(me.toLowerCase().includes(e)){n.push({pagePath:R,pageName:he,selector:L,elementType:y.elementType,matchedField:me.substring(0,60),matchContext:((S=(b=y.note)==null?void 0:b.text)==null?void 0:S.substring(0,40))||""});break}}}if(t==="api")for(const[L,y]of Object.entries(D.value))for(const R of y.apis||[])R.endpoint.toLowerCase().includes(e)&&n.push({pagePath:L,pageName:y.name||L,selector:"",elementType:void 0,matchedField:`${R.method} ${R.endpoint}`,matchContext:R.description||"画面API"});return n});function ze(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",t=new Set;for(const[i,s]of Object.entries(g.value))(!s.pagePath||s.pagePath===e)&&t.add(i);const n=[],o=new Set,r=new Set,u=new Set;function c(i){if(i.closest("[data-dev-inspector]"))return!0;const s=Q(i);return t.has(s)||o.has(s)}function f(i,s,d,m){const P=Q(i);o.add(P),u.add(i),n.push({selector:P,tagName:i.tagName.toLowerCase(),category:s,text:d.substring(0,50),suggestedType:m})}document.querySelectorAll("[data-di-binding]").forEach(i=>{var m;const s=i;if(s.closest("[data-dev-inspector]"))return;const d=s.getAttribute("data-di-binding")||"";r.has(d)||c(s)||(r.add(d),f(s,"binding",((m=s.textContent)==null?void 0:m.trim())||"","datasource"))}),document.querySelectorAll("table").forEach(i=>{if(i.closest("[data-dev-inspector]"))return;const s=window.getComputedStyle(i);if(s.display==="none"||s.visibility==="hidden")return;const d=[];if(i.querySelectorAll("thead th, thead td").forEach($=>{var b;d.push(((b=$.textContent)==null?void 0:b.trim())||"")}),d.length===0){const $=i.querySelector("tr");$&&$.querySelectorAll("th, td").forEach(b=>{var S;d.push(((S=b.textContent)==null?void 0:S.trim())||"")})}const m=i.querySelector("tbody tr")||i.querySelectorAll("tr")[d.length>0?1:0];if(!m)return;m.querySelectorAll("td").forEach(($,b)=>{var R;const S=$,L=((R=S.textContent)==null?void 0:R.trim())||"";if(!L||S.querySelector("[data-di-binding]")||c(S))return;const y=d[b]||`列${b+1}`;f(S,"binding",`${y}: ${L}`,"datasource")})}),document.querySelectorAll("input, select, textarea").forEach(i=>{var P,$;const s=i;if(s.closest("[data-dev-inspector]")||s.type==="hidden")return;const d=window.getComputedStyle(s);if(d.display==="none"||d.visibility==="hidden"||c(s))return;const m=(($=(P=s.closest("label"))==null?void 0:P.textContent)==null?void 0:$.trim())||s.getAttribute("aria-label")||s.placeholder||s.name||s.tagName.toLowerCase();f(s,"form",m||"","form")});const l=new Set;document.querySelectorAll("table").forEach(i=>{const s=i.querySelector("tbody tr")||i.querySelectorAll("tr")[1];s&&l.add(s)}),document.querySelectorAll('button, a[href], [role="button"]').forEach(i=>{var $;const s=i;if(s.closest("[data-dev-inspector]"))return;const d=(($=s.textContent)==null?void 0:$.trim())||"";if(!d)return;const m=window.getComputedStyle(s);if(m.display==="none"||m.visibility==="hidden")return;const P=s.closest("tr");P&&P.closest("table")&&!l.has(P)||c(s)||f(s,"action",d,"action")});const v=n.filter(i=>{try{const s=document.querySelector(i.selector);if(!s)return!0;for(const d of u)if(d!==s&&d.contains(s))return!1;return!0}catch{return!0}});return x.value=v,v}function Ke(e,t){const n={elementType:t,pagePath:typeof window<"u"?window.location.pathname:"/",note:{text:"",type:"todo"}};t==="action"?n.actionInfo={type:"function",description:""}:t==="form"&&(n.formInfo={inputType:"text"}),ve(e,n),T.value=e,x.value=x.value.filter(o=>o.selector!==e)}const Xe=p.computed(()=>{var c,f,l,v;const e=new Map,t=[],n=new Set;for(const[i,s]of Object.entries(D.value))e.set(i,{path:i,name:s.name||i,annotationCount:Object.values(g.value).filter(d=>d.pagePath===i).length});for(const[i,s]of Object.entries(g.value))if(((c=s.actionInfo)==null?void 0:c.type)==="navigate"&&s.actionInfo.target){const d=s.pagePath||"/",m=s.actionInfo.target,P=`${d}→${m}`;if(!e.has(d)){const $=D.value[d];e.set(d,{path:d,name:($==null?void 0:$.name)||d,annotationCount:Object.values(g.value).filter(b=>b.pagePath===d).length})}if(!e.has(m)){const $=D.value[m];e.set(m,{path:m,name:($==null?void 0:$.name)||m,annotationCount:Object.values(g.value).filter(b=>b.pagePath===m).length})}if(!n.has(P)){n.add(P);let $=s.actionInfo.description||((f=s.note)==null?void 0:f.text)||"";if(!$&&typeof document<"u")try{const b=document.querySelector(i);b&&($=((v=(l=b.textContent)==null?void 0:l.trim())==null?void 0:v.substring(0,20))||"")}catch{}t.push({from:d,to:m,label:$,selector:i})}}const o=Array.from(e.values()),r=new Set;for(const i of t)r.add(i.from),r.add(i.to);const u=o.filter(i=>!r.has(i.path));return{nodes:o,edges:t,orphanPages:u}});async function Ve(){Z.value&&(I.value?(I.value=!1,O.value=!1,T.value=null):await $e())}async function $e(){if(!Z.value)return;if(A.value&&!ce.value&&h.value.autoApplyAnalysis!==!1){F.value=!0,I.value=!0;try{await new Promise(t=>setTimeout(t,300)),Ee(),ce.value=!0}finally{F.value=!1}}else I.value=!0}function Ye(){I.value=!1,O.value=!1,T.value=null}function Ze(){O.value=!O.value,O.value||(T.value=null),O.value&&(a.value=!1)}function Qe(){a.value=!a.value,a.value&&(O.value=!1),W.value=null}function et(e){W.value=e}function Q(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const t=[];let n=e;for(;n&&n!==document.body;){let o=n.tagName.toLowerCase();if(n.id){o=`#${n.id}`,t.unshift(o);break}const r=Array.from(n.classList).filter(c=>!c.startsWith("hover:")&&!c.startsWith("focus:")&&!c.startsWith("-")&&!/[/\[\]()!@#$%^&*=+{}|\\:'"<>,?.~]/.test(c)).slice(0,2);r.length>0&&(o+="."+r.join("."));const u=n.parentElement;if(u){const c=Array.from(u.children).filter(f=>f.tagName===n.tagName);if(c.length>1){const f=c.indexOf(n)+1;o+=`:nth-of-type(${f})`}}t.unshift(o),n=n.parentElement}return t.join(" > ")}function tt(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(g.value).filter(t=>{const n=g.value[t];return n?(t.includes(">")||t.startsWith("#")||t.startsWith("[")||t.startsWith("."))&&(!n.componentPath||n.componentPath.includes(e)||e==="/"):!1})}function nt(e){B.value=e}function ot(){B.value=null}function st(){q.value=!q.value}function at(){q.value=!0}function it(){q.value=!1}function rt(e){return g.value[e]}function ve(e,t){var c;const n=new Date().toISOString(),o=g.value[e],r=typeof window<"u"?window.location.pathname:"/",u={...o,...t,id:e,pagePath:t.pagePath||(o==null?void 0:o.pagePath)||r,componentPath:t.componentPath||((c=B.value)==null?void 0:c.componentPath)||"",createdAt:(o==null?void 0:o.createdAt)||n,updatedAt:n};g.value={...g.value,[e]:u},p.nextTick(()=>_())}function ct(e){const{[e]:t,...n}=g.value;g.value=n,p.nextTick(()=>_())}function Ce(e){var $;const t=(($=e.textContent)==null?void 0:$.trim())||"",n=e.tagName.toUpperCase();if(!t&&n!=="INPUT"&&n!=="SELECT"&&n!=="TEXTAREA")return null;const o=e.__vueParentComponent;if(o){const b=o.props||{},S=o.attrs||{};if("modelValue"in b||"model-value"in S)return{type:"v-model",source:"form binding detected",isStatic:!1}}if(n==="INPUT"||n==="SELECT"||n==="TEXTAREA"){const b=e.type||"text",S=e.placeholder||"";return{type:"v-model",source:`${n.toLowerCase()}[type=${b}]${S?` placeholder="${S}"`:""}`,isStatic:!1}}const r=e.dataset.source||e.dataset.field||e.dataset.bind;if(r)return{type:"prop",source:r,isStatic:!1};if(e.closest("tbody")||e.closest('[role="rowgroup"]'))return{type:"api",source:"table data",isStatic:!1};const u=e.closest('ul, ol, [role="list"]');if(u&&u.children.length>1)return{type:"api",source:"list item",isStatic:!1};const c=['[class*="card"]','[class*="Card"]','[class*="item"]','[class*="Item"]','[class*="row"]','[class*="Row"]','[class*="list"]','[class*="List"]','[class*="grid"]','[class*="Grid"]','[role="listitem"]','[role="row"]','[role="gridcell"]'];for(const b of c){const S=e.closest(b);if(S){const L=S.parentElement;if(L&&Array.from(L.children).filter(R=>R!==S&&R.className===S.className).length>0)return{type:"api",source:"repeated container",isStatic:!1}}}if(e.closest("[v-for]")!==null||e.closest("[data-v-for]")!==null)return{type:"api",source:"loop item",isStatic:!1};if(e.parentElement){const b=e.parentElement,L=Array.from(b.children).filter(y=>y.tagName===e.tagName);if(L.length>=2&&L.filter(R=>R.children.length===e.children.length).length>=2)return{type:"api",source:"repeated element",isStatic:!1}}const l=[/^\d+$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}/,/^\d{1,2}:\d{2}/,/^¥[\d,]+/,/^\$[\d,]+/,/^[\d,]+円$/,/^[a-f0-9]{8}-[a-f0-9]{4}/,/^[A-Z0-9]{6,}$/,/^\d+\.\d+$/,/^https?:\/\//,/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,/^\d+件$/,/^\d+個$/,/^第?\d+/];for(const b of l)if(b.test(t))return{type:"api",source:"dynamic data pattern",isStatic:!1};const v=[/^[\u4e00-\u9faf]{2,4}$/,/^[\u3040-\u309f\u30a0-\u30ff]{2,6}$/,/^[A-Z][a-z]+ [A-Z][a-z]+$/];for(const b of v)if(b.test(t))return{type:"api",source:"name pattern",isStatic:!1};const s=["LABEL","TH","LEGEND","FIGCAPTION"].includes(n),m=[/^(保存|キャンセル|閉じる|開く|編集|削除|追加|検索|送信|確認|戻る|次へ|完了|OK|Yes|No|Cancel|Save|Submit|Close|Open|Edit|Delete|Add|Search|Back|Next|Done)$/,/^[\u30a0-\u30ff]+$/,/項目$/,/一覧$/,/設定$/,/情報$/].some(b=>b.test(t)),P=n==="BUTTON"||e.closest("button")!==null||e.getAttribute("role")==="button";return s||m||P&&t.length<20?{type:"static",source:t.substring(0,50)+(t.length>50?"...":""),isStatic:!0}:t.length<=10&&/^[\u3040-\u30ff\u4e00-\u9faf]+$/.test(t)?{type:"prop",source:"short text (verify manually)",isStatic:!1}:t.length>0&&t.length<200?{type:"api",source:"content (assumed dynamic)",isStatic:!1}:null}function Ie(e,t){var d,m,P,$,b;const n={},o=((d=e.textContent)==null?void 0:d.trim())||"",r=e.getAttribute("data-di-binding");e.getAttribute("data-di-db"),e.getAttribute("data-di-component"),e.getAttribute("data-di-db-comment");let u=e;if(!r){const S=e.closest("[data-di-binding]");S&&(u=S)}const c=u.getAttribute("data-di-binding"),f=u.getAttribute("data-di-db"),l=u.getAttribute("data-di-component"),v=u.getAttribute("data-di-db-type"),i=u.getAttribute("data-di-db-comment");if(c||f){if(n.sourceBinding={type:"api",source:c||void 0,isStatic:!1},f){const[S,L]=f.split(".");S&&L&&(n.fieldInfo={table:S,column:L,type:v||void 0,description:i||void 0})}return l&&(n.devMeta={usedComponents:[l]}),n.note={type:"info",text:`【データバインディング】${c}${f?` → ${f}`:""}`},n}const s=Ce(e);if(s)if(n.sourceBinding=s,s.isStatic)n.note={type:"info",text:`【固定文言】${o}`};else if(s.type==="v-model"){const S=e.tagName.toUpperCase();if(S==="INPUT"||S==="SELECT"||S==="TEXTAREA"){const L=e.placeholder||"",y=((P=(m=e.closest("label"))==null?void 0:m.textContent)==null?void 0:P.trim())||e.getAttribute("aria-label")||((b=($=document.querySelector(`label[for="${e.id}"]`))==null?void 0:$.textContent)==null?void 0:b.trim())||"";n.note={type:"todo",text:`【フォーム要素】${y||L||S.toLowerCase()}`}}}else s.type==="api"&&(n.note={type:"question",text:`【動的データ】${o.substring(0,100)}${o.length>100?"...":""}`});return n}const ue=p.ref(!1),fe=p.ref(0),pe=p.ref([]);async function Te(e={}){ue.value=!0,fe.value=0,pe.value=[];const{rescan:t=!1}=e;if(t){const n=typeof window<"u"?window.location.pathname:"/",o=Object.keys(g.value).filter(r=>{const u=g.value[r];return!u.componentPath||u.componentPath.includes(n)});for(const r of o)delete g.value[r];p.nextTick(()=>_())}try{const n=["h1","h2","h3","h4","h5","h6","p","span","label","a","th","td","li","button","div","input","select","textarea",'[role="button"]','[role="link"]','[role="menuitem"]'].join(","),o=document.querySelectorAll(n),r=[];o.forEach(v=>{var S;const i=v;if(i.closest("[data-dev-inspector]"))return;const s=window.getComputedStyle(i);if(s.display==="none"||s.visibility==="hidden"||s.opacity==="0")return;const d=Q(i);if(g.value[d])return;const m=i.tagName.toUpperCase(),P=((S=i.textContent)==null?void 0:S.trim())||"";if(m==="INPUT"||m==="SELECT"||m==="TEXTAREA"){r.push(i);return}if(P.length>300||P.length===0||m==="DIV"&&(Array.from(i.childNodes).filter(y=>y.nodeType===Node.TEXT_NODE).map(y=>{var R;return((R=y.textContent)==null?void 0:R.trim())||""}).join("").trim().length===0||i.children.length>3))return;const $=Array.from(i.childNodes).some(L=>{var y;return L.nodeType===Node.TEXT_NODE&&(((y=L.textContent)==null?void 0:y.trim())||"").length>0}),b=!Array.from(i.children).some(L=>["DIV","P","UL","OL","TABLE","SECTION","ARTICLE"].includes(L.tagName));($||i.children.length===0&&P.length>0||b)&&r.push(i)});const u=r.length;let c=0,f=0;const l=20;for(let v=0;v<r.length;v+=l){const i=r.slice(v,v+l);for(const s of i){const d=Q(s),m=Ie(s,d);m.sourceBinding&&(pe.value.push({selector:d,element:s,detected:m}),ve(d,m),f++),c++,fe.value=Math.round(c/u*100)}await new Promise(s=>setTimeout(s,10))}return f}finally{ue.value=!1,fe.value=100}}const Ae=p.ref([]),ye=p.ref("");async function lt(e){var n;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];ue.value=!0;const t=[];try{const o=e.getRoutes(),r=[];for(const u of o)u.path.includes(":")&&!u.path.includes("?")||u.redirect||u.path!=="/:pathMatch(.*)*"&&((n=u.meta)!=null&&n.devInspectorSkip||r.push(u.path));Ae.value=r;for(const u of r){ye.value=u;try{await e.push(u),await new Promise(f=>setTimeout(f,500));const c=await Te();t.push({page:u,count:c})}catch(c){console.warn(`[DevInspector] Failed to scan page ${u}:`,c),t.push({page:u,count:0})}}return t}finally{ue.value=!1,ye.value=""}}function ut(){pe.value=[],fe.value=0}const H=p.ref([]);async function Ee(){var u;if(!A.value)return console.warn("[DevInspector] No analysis data loaded. Call loadAnalysisData first."),0;H.value=[];const e=typeof window<"u"?window.location.pathname:"/",t=c=>{if(!A.value)return null;for(const[f,l]of Object.entries(A.value.components))if(l.componentName===c||l.componentName.toLowerCase()===c.toLowerCase()||f.toLowerCase().includes(`/${c.toLowerCase()}.vue`))return l;return null},n=(c,f=new Set)=>{const l=[];if(f.has(c.componentName))return l;if(f.add(c.componentName),l.push(...c.elements),c.usedComponents)for(const v of c.usedComponents){const i=t(v);i&&l.push(...n(i,f))}return l},o=[],r=new Set;for(const[c,f]of Object.entries(A.value.components)){const l=c.replace(/^pages/,"").replace(/\.vue$/,"").replace(/\/index$/,"").replace(/\[.*?\]/g,"[^/]+");let v=!1;if((e==="/"&&c.includes("index")||c.includes("pages/")&&e.match(new RegExp(`^${l}$`)))&&(v=!0),v){const i=n(f);o.push(...i),r.add(f.componentName),f.usedComponents&&f.usedComponents.forEach(s=>r.add(s))}}for(const[c,f]of Object.entries(A.value.components))c.includes("components/")&&!r.has(f.componentName)&&o.push(...f.elements);for(const c of o){if(G.value.has(c.selector))continue;let f=!1,l=c.selector;try{document.querySelector(c.selector)&&(f=!0)}catch{}if(!f&&c.text&&!c.binding){const v=c.text.replace(/\[コメント\]\s*/,""),i=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null);for(;i.nextNode();){const s=i.currentNode;if((u=s.textContent)!=null&&u.includes(v)){const d=s.parentElement;if(d){f=!0,l=Q(d);break}}}}if(!f&&c.selector.includes(".")){const v=c.selector.match(/^(\w+)\.(.+)$/);if(v){const[,i,s]=v;try{const d=document.querySelector(c.selector);d&&(f=!0,l=Q(d))}catch{}}}if(!f&&c.binding){const v=`[data-bind="${c.binding}"]`;try{const i=document.querySelector(v);i&&(f=!0,l=Q(i))}catch{}}H.value.push({selector:l,element:c,matched:f})}return console.log(`[DevInspector] Applied analysis: ${H.value.filter(c=>c.matched).length}/${H.value.length} elements matched`),H.value.filter(c=>c.matched).length}function ft(){H.value=[]}function dt(e){H.value=H.value.filter(t=>t.selector!==e),G.value.add(e),ht()}function pt(){try{const e=localStorage.getItem(ne);e&&(G.value=new Set(JSON.parse(e)))}catch{}}function ht(){try{localStorage.setItem(ne,JSON.stringify([...G.value]))}catch{}}function mt(){G.value.clear(),localStorage.removeItem(ne)}function Ne(){const e={removed:[...G.value],exportedAt:new Date().toISOString()};return JSON.stringify(e,null,2)}function gt(e="dev-inspector-changes.json"){const t=Ne(),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function Pe(){if(!A.value)return[];const e=[],t=new Set;for(const n of Object.values(A.value.components))for(const o of n.elements)o.binding&&!t.has(o.binding)&&(t.add(o.binding),e.push({binding:o.binding,db:o.db,api:o.api,component:n.componentName}));return e.sort((n,o)=>n.db&&!o.db?-1:!n.db&&o.db?1:n.binding.localeCompare(o.binding))}function vt(e){const t=Pe();if(!e)return t;const n=e.toLowerCase();return t.filter(o=>{var r,u;return o.binding.toLowerCase().includes(n)||((r=o.db)==null?void 0:r.table.toLowerCase().includes(n))||((u=o.db)==null?void 0:u.column.toLowerCase().includes(n))||o.component.toLowerCase().includes(n)})}function Le(){var t,n;if(!((n=(t=A.value)==null?void 0:t.dbSchema)!=null&&n.tables))return[];const e=[];for(const[o,r]of Object.entries(A.value.dbSchema.tables))for(const[u,c]of Object.entries(r.columns))e.push({table:o,column:u,type:c.type,comment:c.comment,fullName:`${o}.${u}`});return e.sort((o,r)=>o.table!==r.table?o.table.localeCompare(r.table):o.column.localeCompare(r.column))}function yt(e){const t=Le();if(!e)return t;const n=e.toLowerCase();return t.filter(o=>{var r;return o.table.toLowerCase().includes(n)||o.column.toLowerCase().includes(n)||o.fullName.toLowerCase().includes(n)||((r=o.comment)==null?void 0:r.toLowerCase().includes(n))})}function bt(){var n,o;const e=[],t=[];if(!((n=A.value)!=null&&n.components))return{pageLoad:e,action:t};for(const r of H.value){if(!r.matched)continue;const u=r.element.component;if(u&&((o=A.value.components[u])!=null&&o.apis))for(const c of A.value.components[u].apis)["onMount","useFetch","useAsyncData"].includes(c.loadTrigger)?e.some(f=>f.endpoint===c.endpoint&&f.method===c.method)||e.push(c):c.loadTrigger==="action"&&(t.some(f=>f.endpoint===c.endpoint&&f.method===c.method)||t.push(c))}return{pageLoad:e,action:t}}function St(e){var t;if(!((t=A.value)!=null&&t.components))return null;for(const n of Object.values(A.value.components))if(n.apis){for(const o of n.apis)if(o.variable&&e.startsWith(o.variable))return o}return null}function wt(e){const t=e.tagName.toUpperCase();return t==="INPUT"||t==="SELECT"||t==="TEXTAREA"?"form":t==="BUTTON"||t==="A"&&e.hasAttribute("href")||e.getAttribute("role")==="button"||e.closest("button")||e.closest("a[href]")?"action":"datasource"}const le=p.ref([]),De=p.ref(null);function $t(){if(typeof document>"u")return[];const e=typeof window<"u"?window.location.pathname:"/",t=[];for(const[n,o]of Object.entries(g.value))if(!(o.componentPath&&!o.componentPath.includes(e)&&e!=="/"))try{document.querySelector(n)||t.push(n)}catch{t.push(n)}return le.value=t,t}function Ct(e,t){const n=g.value[e];if(!n)return;const{[e]:o,...r}=g.value;g.value={...r,[t]:{...n,id:t,updatedAt:new Date().toISOString()}},le.value=le.value.filter(u=>u!==e),p.nextTick(()=>_())}function It(e){De.value=e,a.value=!0,O.value=!1,q.value=!1}function Tt(){const e=le.value;if(e.length===0)return;const t={...g.value};for(const n of e)delete t[n];g.value=t,le.value=[],p.nextTick(()=>_())}function At(){X.value=!X.value}function Et(e){T.value=e}function Nt(){T.value=null}function Pt(){return JSON.stringify({elementConfigs:g.value,screenConfigs:D.value},null,2)}function xe(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:g.value,screenConfigs:D.value};return JSON.stringify(e,null,2)}function Lt(e="dev-annotations.json"){const t=xe(),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function Dt(e){try{const t=JSON.parse(e),n=t.annotations||t.elementConfigs||t;g.value={...g.value,...n},t.screenConfigs&&(D.value={...D.value,...t.screenConfigs})}catch(t){throw console.error("[DevInspector] Failed to import configs:",t),new Error("Invalid JSON format")}}function xt(){g.value={}}function Ot(e="screen-spec-sdd.md"){const t=_t(g.value,D.value,U.value),n=new Blob([t],{type:"text/markdown;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}function jt(e="screen-spec-client.md"){const t=Bt(g.value,D.value,U.value),n=new Blob([t],{type:"text/markdown;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}return{isEnabled:I,isAvailable:Z,isEditMode:O,isPickMode:a,isInitializing:F,hoveredSelector:W,currentScreenSpec:B,isPanelOpen:q,elementConfigs:g,editingElementId:T,screenConfigs:D,editingScreen:j,getScreenConfig:ie,setScreenConfig:Ue,deleteScreenConfig:Fe,suggestScreenApis:He,init:de,toggle:Ve,enable:$e,disable:Ye,toggleEditMode:Ze,togglePickMode:Qe,setHoveredSelector:et,generateSelector:Q,getConfiguredSelectors:tt,setScreenSpec:nt,clearScreenSpec:ot,togglePanel:st,openPanel:at,closePanel:it,getElementConfig:rt,setElementConfig:ve,deleteElementConfig:ct,startEditing:Et,stopEditing:Nt,exportConfigs:Pt,exportAsFile:xe,downloadAnnotations:Lt,downloadSddSpec:Ot,downloadClientSpec:jt,importConfigs:Dt,clearAllConfigs:xt,detectSourceBinding:Ce,autoDetectElementInfo:Ie,isScanning:ue,scanProgress:fe,scanResults:pe,scanCurrentPage:Te,scanAllPages:lt,allPagesRoutes:Ae,currentScanPage:ye,clearScanResults:ut,analysisData:A,loadAnalysisData:C,getAnalyzedElement:k,getAnalyzedElementsForPage:N,analysisResults:H,applyAnalysisToPage:Ee,clearAnalysisResults:ft,removeAnalysisResult:dt,clearHiddenSelectors:mt,hiddenAnalysisSelectors:G,analysisFilter:re,exportChangesForCli:Ne,downloadChanges:gt,getAvailableBindings:Pe,searchBindings:vt,getSchemaColumns:Le,searchSchemaColumns:yt,getCurrentPageApis:bt,getApiSourceForBinding:St,showNoteHighlights:X,toggleNoteHighlights:At,noteHighlightFilter:z,detectElementType:wt,masterDefinitions:U,getMasterDefinition:_e,setMasterDefinition:Be,deleteMasterDefinition:Me,getMastersForTable:Je,getMasterEntries:Ge,brokenAnnotations:le,remapTargetId:De,detectBrokenAnnotations:$t,remapAnnotation:Ct,startRemap:It,deleteBrokenAnnotations:Tt,showCrossSearch:ee,crossSearchQuery:V,crossSearchMode:Y,crossSearchResults:We,showUnannotatedDetection:te,unannotatedElements:x,hoveredUnannotatedSelector:w,detectUnannotatedElements:ze,quickAnnotate:Ke,showScreenFlow:J,screenFlowData:Xe}});function Gt(){return Re()}exports.useDevInspector=Gt;exports.useDevInspectorStore=Re;
