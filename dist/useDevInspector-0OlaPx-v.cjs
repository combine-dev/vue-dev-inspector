"use strict";const i=require("vue"),re=require("pinia");var A=typeof document<"u"?document.currentScript:null;const le={},ue="devInspector:elementConfigs",j=re.defineStore("devInspector",()=>{const m=i.ref({}),f=i.ref(!1),u=i.ref(!1),v=i.ref(!1),S=i.ref(null),p=i.ref(!1),c=i.ref({}),d=i.ref(null),I=i.ref(null),D=i.computed(()=>m.value.storageKey||ue),C=i.computed(()=>m.value.enabledInProduction?!0:typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:A&&A.tagName.toUpperCase()==="SCRIPT"&&A.src||new URL("useDevInspector-0OlaPx-v.cjs",document.baseURI).href}<"u"&&le?!1:process.env.NODE_ENV==="development");function F(e={}){m.value=e,$()}function $(){try{const e=m.value.initialAnnotations||{};if(typeof window<"u"){const t=localStorage.getItem(D.value),n=t?JSON.parse(t):{};c.value={...e,...n}}else c.value=e}catch(e){console.error("[DevInspector] Failed to load configs:",e)}}function E(){try{if(typeof window<"u"){const e=JSON.stringify(c.value);localStorage.setItem(D.value,e),console.log("[DevInspector] Saved configs:",Object.keys(c.value).length,"items")}}catch(e){console.error("[DevInspector] Failed to save configs:",e)}}i.watch(c,()=>{i.nextTick(()=>{E()})},{deep:!0});function B(){C.value&&(f.value=!f.value,f.value||(u.value=!1,d.value=null))}function J(){C.value&&(f.value=!0)}function M(){f.value=!1,u.value=!1,d.value=null}function H(){u.value=!u.value,u.value||(d.value=null),u.value&&(v.value=!1)}function W(){v.value=!v.value,v.value&&(u.value=!1),I.value=null}function q(e){I.value=e}function N(e){if(e.id)return`#${e.id}`;if(e.dataset.devId)return`[data-dev-id="${e.dataset.devId}"]`;const t=[];let n=e;for(;n&&n!==document.body;){let a=n.tagName.toLowerCase();if(n.id){a=`#${n.id}`,t.unshift(a);break}const r=Array.from(n.classList).filter(s=>!s.startsWith("hover:")&&!s.startsWith("focus:")).slice(0,2);r.length>0&&(a+="."+r.join("."));const o=n.parentElement;if(o){const s=Array.from(o.children).filter(l=>l.tagName===n.tagName);if(s.length>1){const l=s.indexOf(n)+1;a+=`:nth-child(${l})`}}t.unshift(a),n=n.parentElement}return t.join(" > ")}function K(){const e=typeof window<"u"?window.location.pathname:"/";return Object.keys(c.value).filter(t=>{const n=c.value[t];return n?(t.includes(">")||t.startsWith("#")||t.startsWith("[")||t.startsWith("."))&&(!n.componentPath||n.componentPath.includes(e)||e==="/"):!1})}function V(e){S.value=e}function G(){S.value=null}function X(){p.value=!p.value}function Y(){p.value=!0}function z(){p.value=!1}function Q(e){return c.value[e]}function O(e,t){var o;const n=new Date().toISOString(),a=c.value[e],r={...a,...t,id:e,componentPath:t.componentPath||((o=S.value)==null?void 0:o.componentPath)||"",createdAt:(a==null?void 0:a.createdAt)||n,updatedAt:n};c.value={...c.value,[e]:r},i.nextTick(()=>E())}function Z(e){const{[e]:t,...n}=c.value;c.value=n,i.nextTick(()=>E())}function _(e){var o;const t=((o=e.textContent)==null?void 0:o.trim())||"",n=e.__vueParentComponent;if(n){const s=n.props||{},l=n.attrs||{};if("modelValue"in s||"model-value"in l)return{type:"v-model",source:"form binding detected",isStatic:!1}}const a=e.dataset.source||e.dataset.field||e.dataset.bind;return a?{type:"prop",source:a,isStatic:!1}:t.length>0&&t.length<100&&!t.includes("{{")&&!t.match(/^\d+$/)&&!t.match(/^\d{4}[-/]\d{2}[-/]\d{2}/)&&e.children.length===0&&!e.closest("[v-for]")&&!e.hasAttribute(":")&&(e.tagName==="SPAN"||e.tagName==="LABEL"||e.tagName==="P"||e.tagName==="H1"||e.tagName==="H2"||e.tagName==="H3"||e.tagName==="TH"||e.tagName==="BUTTON")?{type:"static",isStatic:!0}:t.match(/^\d+$/)||t.match(/^\d{4}[-/]\d{2}[-/]\d{2}/)?{type:"api",isStatic:!1}:null}function T(e,t){const n=_(e),a={};return n&&(a.sourceBinding=n,n.isStatic&&(a.note={type:"info",text:"固定文言"})),a}const g=i.ref(!1),h=i.ref(0),y=i.ref([]);async function x(){g.value=!0,h.value=0,y.value=[];try{const e=document.querySelectorAll("body *:not([data-dev-inspector]):not(script):not(style):not(noscript)"),t=[];e.forEach(o=>{var L;const s=o,l=N(s);if(c.value[l])return;const w=((L=s.textContent)==null?void 0:L.trim())||"";w.length>0&&w.length<200&&(Array.from(s.childNodes).filter(b=>b.nodeType===Node.TEXT_NODE).map(b=>{var U;return((U=b.textContent)==null?void 0:U.trim())||""}).join("").length>0||s.children.length===0)&&t.push(s)});const n=t.length;let a=0,r=0;for(const o of t){const s=N(o),l=T(o,s);l.sourceBinding&&(y.value.push({selector:s,element:o,detected:l}),O(s,l),r++),a++,h.value=Math.round(a/n*100),a%10===0&&await new Promise(w=>setTimeout(w,0))}return r}finally{g.value=!1,h.value=100}}const R=i.ref([]),P=i.ref("");async function ee(e){var n;if(!e)return console.warn("[DevInspector] Router not provided for all pages scan"),[];g.value=!0;const t=[];try{const a=e.getRoutes(),r=[];for(const o of a)o.path.includes(":")&&!o.path.includes("?")||o.redirect||o.path!=="/:pathMatch(.*)*"&&((n=o.meta)!=null&&n.devInspectorSkip||r.push(o.path));R.value=r;for(const o of r){P.value=o;try{await e.push(o),await new Promise(l=>setTimeout(l,500));const s=await x();t.push({page:o,count:s})}catch(s){console.warn(`[DevInspector] Failed to scan page ${o}:`,s),t.push({page:o,count:0})}}return t}finally{g.value=!1,P.value=""}}function te(){y.value=[],h.value=0}function ne(e){d.value=e}function oe(){d.value=null}function ae(){return JSON.stringify(c.value,null,2)}function k(){const e={_meta:{version:"1.0.0",description:"Dev Inspector annotations",lastUpdated:new Date().toISOString()},annotations:c.value};return JSON.stringify(e,null,2)}function se(e="dev-annotations.json"){const t=k(),n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),r=document.createElement("a");r.href=a,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}function ce(e){try{const t=JSON.parse(e),n=t.annotations||t;c.value={...c.value,...n}}catch(t){throw console.error("[DevInspector] Failed to import configs:",t),new Error("Invalid JSON format")}}function ie(){c.value={}}return{isEnabled:f,isAvailable:C,isEditMode:u,isPickMode:v,hoveredSelector:I,currentScreenSpec:S,isPanelOpen:p,elementConfigs:c,editingElementId:d,init:F,toggle:B,enable:J,disable:M,toggleEditMode:H,togglePickMode:W,setHoveredSelector:q,generateSelector:N,getConfiguredSelectors:K,setScreenSpec:V,clearScreenSpec:G,togglePanel:X,openPanel:Y,closePanel:z,getElementConfig:Q,setElementConfig:O,deleteElementConfig:Z,startEditing:ne,stopEditing:oe,exportConfigs:ae,exportAsFile:k,downloadAnnotations:se,importConfigs:ce,clearAllConfigs:ie,detectSourceBinding:_,autoDetectElementInfo:T,isScanning:g,scanProgress:h,scanResults:y,scanCurrentPage:x,scanAllPages:ee,allPagesRoutes:R,currentScanPage:P,clearScanResults:te}});function fe(){return j()}exports.useDevInspector=fe;exports.useDevInspectorStore=j;
